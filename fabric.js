/* build: `node build.js modules=ALL exclude=gestures,accessors requirejs minifier=uglifyjs` */
/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"2.3.1"};"undefined"!==typeof exports?exports.fabric=fabric:"function"===typeof define&&define.amd&&define([],function(){return fabric});"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=fabric.document.defaultView,DOMParser=require("xmldom").DOMParser);fabric.isTouchSupported="ontouchstart"in fabric.window;fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;fabric.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width id paint-order instantiated_by_use".split(" ");fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.canvasModule="canvas";fabric.perfLimitSizeTotal=2097152;fabric.maxCacheSideLimit=4096;fabric.minCacheSideLimit=256;fabric.charWidthsCache={};fabric.textureSize=2048;fabric.enableGLFiltering=!0;fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;fabric.browserShadowBlurConstant=1;fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize))return console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize});if(fabric.Canvas2dFilterBackend)return new fabric.Canvas2dFilterBackend};"undefined"!==typeof document&&"undefined"!==typeof window&&(window.fabric=fabric);(function(){function d(a,f){if(this.__eventListeners[a]){var c=this.__eventListeners[a];f?c[c.indexOf(f)]=!1:fabric.util.array.fill(c,!1)}}function b(a,f){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(f);return this}function e(a,f){if(this.__eventListeners){if(0===arguments.length)for(a in this.__eventListeners)d.call(this,a);else if(1===arguments.length&&"object"===typeof arguments[0])for(var c in a)d.call(this,c,a[c]);else d.call(this,a,f);return this}}function a(a,f){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var g=0,b=c.length;g<b;g++)c[g]&&c[g].call(this,f||{});this.__eventListeners[a]=c.filter(function(a){return!1!==a});return this}}}fabric.Observable={observe:b,stopObserving:e,fire:a,on:b,off:e,trigger:a}})();fabric.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded)for(var d=0,b=arguments.length;d<b;d++)this._onObjectAdded(arguments[d]);this.renderOnAddRemove&&this.requestRenderAll();return this},insertAt:function(d,b,e){var a=this.getObjects();e?a[b]=d:a.splice(b,0,d);this._onObjectAdded&&this._onObjectAdded(d);this.renderOnAddRemove&&this.requestRenderAll();return this},remove:function(){for(var d=this.getObjects(),b,e=!1,a=0,c=arguments.length;a<c;a++)b=d.indexOf(arguments[a]),-1!==b&&(e=!0,d.splice(b,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[a]));this.renderOnAddRemove&&e&&this.requestRenderAll();return this},forEachObject:function(d,b){for(var e=this.getObjects(),a=0,c=e.length;a<c;a++)d.call(b,e[a],a,e);return this},getObjects:function(d){return"undefined"===typeof d?this._objects:this._objects.filter(function(b){return b.type===d})},item:function(d){return this.getObjects()[d]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(d){return-1<this.getObjects().indexOf(d)},complexity:function(){return this.getObjects().reduce(function(d,b){return d+=b.complexity?b.complexity():0},0)}};fabric.CommonMethods={_setOptions:function(d){for(var b in d)this.set(b,d[b])},_initGradient:function(d,b){!d||!d.colorStops||d instanceof fabric.Gradient||this.set(b,new fabric.Gradient(d))},_initPattern:function(d,b,e){!d||!d.source||d instanceof fabric.Pattern?e&&e():this.set(b,new fabric.Pattern(d,e))},_initClipping:function(d){d.clipTo&&"string"===typeof d.clipTo&&(d=fabric.util.getFunctionBody(d.clipTo),"undefined"!==typeof d&&(this.clipTo=new Function("ctx",d)))},_setObject:function(d){for(var b in d)this._set(b,d[b])},set:function(d,b){"object"===typeof d?this._setObject(d):"function"===typeof b&&"clipTo"!==d?this._set(d,b(this.get(d))):this._set(d,b);return this},_set:function(d,b){this[d]=b},toggle:function(d){var b=this.get(d);"boolean"===typeof b&&this.set(d,!b);return this},get:function(d){return this[d]}};(function(d){var b=Math.sqrt,e=Math.atan2,a=Math.pow,c=Math.abs,f=Math.PI/180,k=Math.PI/2;fabric.util={cos:function(a){if(0===a)return 1;0>a&&(a=-a);switch(a/k){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},sin:function(a){if(0===a)return 0;var g=a/k,c=1;0>a&&(c=-1);switch(g){case 1:return c;case 2:return 0;case 3:return-c}return Math.sin(a)},removeFromArray:function(a,c){var g=a.indexOf(c);-1!==g&&a.splice(g,1);return a},getRandomInt:function(a,c){return Math.floor(Math.random()*(c-a+1))+a},degreesToRadians:function(a){return a*f},radiansToDegrees:function(a){return a/f},rotatePoint:function(a,c,f){a.subtractEquals(c);a=fabric.util.rotateVector(a,f);return(new fabric.Point(a.x,a.y)).addEquals(c)},rotateVector:function(a,c){var g=fabric.util.sin(c),f=fabric.util.cos(c);return{x:a.x*f-a.y*g,y:a.x*g+a.y*f}},transformPoint:function(a,c,f){return f?new fabric.Point(c[0]*a.x+c[2]*a.y,c[1]*a.x+c[3]*a.y):new fabric.Point(c[0]*a.x+c[2]*a.y+c[4],c[1]*a.x+c[3]*a.y+c[5])},makeBoundingBoxFromPoints:function(a){var g=[a[0].x,a[1].x,a[2].x,a[3].x],c=fabric.util.array.min(g),g=fabric.util.array.max(g)-c,f=[a[0].y,a[1].y,a[2].y,a[3].y];a=fabric.util.array.min(f);f=fabric.util.array.max(f);return{left:c,top:a,width:g,height:f-a}},invertTransform:function(a){var c=1/(a[0]*a[3]-a[1]*a[2]),c=[c*a[3],-c*a[1],-c*a[2],c*a[0]];a=fabric.util.transformPoint({x:a[4],y:a[5]},c,!0);c[4]=-a.x;c[5]=-a.y;return c},toFixed:function(a,c){return parseFloat(Number(a).toFixed(c))},parseUnit:function(a,c){var g=/\D{0,2}$/.exec(a),f=parseFloat(a);c||(c=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(g[0]){case "mm":return f*fabric.DPI/25.4;case "cm":return f*fabric.DPI/2.54;case "in":return f*fabric.DPI;case "pt":return f*fabric.DPI/72;case "pc":return f*fabric.DPI/72*12;case "em":return f*c;default:return f}},falseFunction:function(){return!1},getKlass:function(a,c){a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return fabric.util.resolveNamespace(c)[a]},getSvgAttributes:function(a){var c=["instantiated_by_use","style","id","class"];switch(a){case "linearGradient":c=c.concat("x1 y1 x2 y2 gradientUnits gradientTransform".split(" "));break;case "radialGradient":c=c.concat("gradientUnits gradientTransform cx cy r fx fy fr".split(" "));break;case "stop":c=c.concat(["offset","stop-color","stop-opacity"])}return c},resolveNamespace:function(a){if(!a)return fabric;a=a.split(".");var c=a.length,g,f=d||fabric.window;for(g=0;g<c;++g)f=f[a[g]];return f},loadImage:function(a,c,f,b){if(a){var g=fabric.util.createImage(),h=function(){c&&c.call(f,g);g=g.onload=g.onerror=null};g.onload=h;g.onerror=function(){fabric.log("Error loading "+g.src);c&&c.call(f,null,!0);g=g.onload=g.onerror=null};0!==a.indexOf("data")&&b&&(g.crossOrigin=b);"data:image/svg"===a.substring(0,14)&&(g.onload=null,fabric.util.loadImageInDom(g,h));g.src=a}else c&&c.call(f,a)},loadImageInDom:function(a,c){var g=fabric.document.createElement("div");g.style.width=g.style.height="1px";g.style.left=g.style.top="-100%";g.style.position="absolute";g.appendChild(a);fabric.document.querySelector("body").appendChild(g);a.onload=function(){c();g.parentNode.removeChild(g);g=null}},enlivenObjects:function(a,c,f,b){a=a||[];var g=[],h=0,e=a.length;e?a.forEach(function(a,k){a&&a.type?fabric.util.getKlass(a.type,f).fromObject(a,function(f,d){d||(g[k]=f);b&&b(a,f,d);++h===e&&c&&c(g)}):++h===e&&c&&c(g)}):c&&c(g)},enlivenPatterns:function(a,c){a=a||[];var g=[],f=0,b=a.length;b?a.forEach(function(a,h){a&&a.source?new fabric.Pattern(a,function(a){g[h]=a;++f===b&&c&&c(g)}):(g[h]=a,++f===b&&c&&c(g))}):c&&c(g)},groupSVGElements:function(a,c,f){if(1===a.length)return a[0];c&&(c.width&&c.height?c.centerPoint={x:c.width/2,y:c.height/2}:(delete c.width,delete c.height));a=new fabric.Group(a,c);"undefined"!==typeof f&&(a.sourcePath=f);return a},populateWithProperties:function(a,c,f){if(f&&"[object Array]"===Object.prototype.toString.call(f))for(var g=0,b=f.length;g<b;g++)f[g]in a&&(c[f[g]]=a[f[g]])},drawDashedLine:function(a,c,f,k,d,p){k-=c;var g=d-f;d=b(k*k+g*g);k=e(g,k);var g=p.length,h=0,l=!0;a.save();a.translate(c,f);a.moveTo(0,0);a.rotate(k);for(c=0;d>c;)c+=p[h++%g],c>d&&(c=d),a[l?"lineTo":"moveTo"](c,0),l=!l;a.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},createImage:function(){return fabric.document.createElement("img")},clipContext:function(a,c){c.save();c.beginPath();a.clipTo(c);c.clip()},multiplyTransformMatrices:function(a,c,f){return[a[0]*c[0]+a[2]*c[1],a[1]*c[0]+a[3]*c[1],a[0]*c[2]+a[2]*c[3],a[1]*c[2]+a[3]*c[3],f?0:a[0]*c[4]+a[2]*c[5]+a[4],f?0:a[1]*c[4]+a[3]*c[5]+a[5]]},qrDecompose:function(c){var g=e(c[1],c[0]),k=a(c[0],2)+a(c[1],2),d=b(k),n=(c[0]*c[3]-c[2]*c[1])/d,k=e(c[0]*c[2]+c[1]*c[3],k);return{angle:g/f,scaleX:d,scaleY:n,skewX:k/f,skewY:0,translateX:c[4],translateY:c[5]}},customTransformMatrix:function(a,b,e){e=[1,0,c(Math.tan(e*f)),1];a=[c(a),0,0,c(b)];return fabric.util.multiplyTransformMatrices(a,e,!0)},resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.skewX=0;a.skewY=0;a.flipX=!1;a.flipY=!1;a.rotate(0)},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,c,f,b){0<b&&(c=c>b?c-b:0,f=f>b?f-b:0);var g=!0;c=a.getImageData(c,f,2*b||1,2*b||1);f=c.data.length;for(a=3;a<f&&(g=c.data[a],g=0>=g,!1!==g);a+=4);return g},parsePreserveAspectRatioAttribute:function(a){var c="meet",g;(a=a.split(" "))&&a.length&&(c=a.pop(),"meet"!==c&&"slice"!==c?(g=c,c="meet"):a.length&&(g=a.pop()));a="none"!==g?g.slice(1,4):"none";g="none"!==g?g.slice(5,8):"none";return{meetOrSlice:c,alignX:a,alignY:g}},clearFabricFontCache:function(a){a?fabric.charWidthsCache[a]&&delete fabric.charWidthsCache[a]:fabric.charWidthsCache={}},limitDimsByArea:function(a,c){var g=Math.sqrt(c*a);return{x:Math.floor(g),y:Math.floor(c/g)}},capValue:function(a,c,f){return Math.max(a,Math.min(c,f))},findScaleToFit:function(a,c){return Math.min(c.width/a.width,c.height/a.height)},findScaleToCover:function(a,c){return Math.max(c.width/a.width,c.height/a.height)}}})("undefined"!==typeof exports?exports:this);(function(){function d(a,f,k,d,p,q,r){var h=g.call(arguments);if(c[h])return c[h];var l=Math.PI,m=r*l/180,n=fabric.util.sin(m),m=fabric.util.cos(m),z=0,x=0;k=Math.abs(k);d=Math.abs(d);var v=-m*a*.5-n*f*.5,D=-m*f*.5+n*a*.5,A=k*k,B=d*d,E=D*D,C=v*v,F=A*B-A*E-B*C,G=0;0>F?(A=Math.sqrt(1-F/(A*B)),k*=A,d*=A):G=(p===q?-1:1)*Math.sqrt(F/(A*E+B*C));E=G*k*D/d;C=-G*d*v/k;G=m*E-n*C+.5*a;A=n*E+m*C+.5*f;B=e(1,0,(v-E)/k,(D-C)/d);D=e((v-E)/k,(D-C)/d,(-v-E)/k,(-D-C)/d);0===q&&0<D?D-=2*l:1===q&&0>D&&(D+=2*l);l=Math.ceil(Math.abs(D/l*2));v=[];D/=l;E=8/3*Math.sin(D/4)*Math.sin(D/4)/Math.sin(D/2);C=B+D;for(F=0;F<l;F++)v[F]=b(B,C,m,n,k,d,G,A,E,z,x),z=v[F][4],x=v[F][5],B=C,C+=D;return c[h]=v}function b(a,c,b,e,k,d,r,t,u,y,w){var h=g.call(arguments);if(f[h])return f[h];var l=fabric.util.cos(a),m=fabric.util.sin(a),n=fabric.util.cos(c),p=fabric.util.sin(c),q=b*k*n-e*d*p+r,E=e*k*n+b*d*p+t;f[h]=[y+u*(-b*k*m-e*d*l),w+u*(-e*k*m+b*d*l),q+u*(b*k*p+e*d*n),E+u*(e*k*p-b*d*n),q,E];return f[h]}function e(a,c,g,f){a=Math.atan2(c,a);g=Math.atan2(f,g);return g>=a?g-a:2*Math.PI-(a-g)}function a(a,c,f,b,e,d,r,t){var h=g.call(arguments);if(k[h])return k[h];var l=Math.sqrt,m=Math.min,n=Math.max,p=Math.abs,v=[],q=[[],[]],A,B,E,C,F;B=6*a-12*f+6*e;A=-3*a+9*f-9*e+3*r;E=3*f-3*a;for(var G=0;2>G;++G)0<G&&(B=6*c-12*b+6*d,A=-3*c+9*b-9*d+3*t,E=3*b-3*c),1E-12>p(A)?1E-12>p(B)||(C=-E/B,0<C&&1>C&&v.push(C)):(C=B*B-4*E*A,0>C||(F=l(C),C=(-B+F)/(2*A),0<C&&1>C&&v.push(C),C=(-B-F)/(2*A),0<C&&1>C&&v.push(C)));for(p=l=v.length;l--;)C=v[l],B=1-C,A=B*B*B*a+3*B*B*C*f+3*B*C*C*e+C*C*C*r,q[0][l]=A,A=B*B*B*c+3*B*B*C*b+3*B*C*C*d+C*C*C*t,q[1][l]=A;q[0][p]=a;q[1][p]=c;q[0][p+1]=r;q[1][p+1]=t;m=[{x:m.apply(null,q[0]),y:m.apply(null,q[1])},{x:n.apply(null,q[0]),y:n.apply(null,q[1])}];return k[h]=m}var c={},f={},k={},g=Array.prototype.join;fabric.util.drawArc=function(a,c,g,f){var b=[[],[],[],[]];f=d(f[5]-c,f[6]-g,f[0],f[1],f[3],f[4],f[2]);for(var e=0,h=f.length;e<h;e++)b[e][0]=f[e][0]+c,b[e][1]=f[e][1]+g,b[e][2]=f[e][2]+c,b[e][3]=f[e][3]+g,b[e][4]=f[e][4]+c,b[e][5]=f[e][5]+g,a.bezierCurveTo.apply(a,b[e])};fabric.util.getBoundsOfArc=function(c,g,f,b,e,k,r,t,u){var h=0,l=0,m=[];f=d(t-c,u-g,f,b,k,r,e);b=0;for(e=f.length;b<e;b++)h=a(h,l,f[b][0],f[b][1],f[b][2],f[b][3],f[b][4],f[b][5]),m.push({x:h[0].x+c,y:h[0].y+g}),m.push({x:h[1].x+c,y:h[1].y+g}),h=f[b][4],l=f[b][5];return m};fabric.util.getBoundsOfCurve=a})();(function(){function d(b,a,c){if(b&&0!==b.length){var f=b.length-1,e=a?b[f][a]:b[f];if(a)for(;f--;)c(b[f][a],e)&&(e=b[f][a]);else for(;f--;)c(b[f],e)&&(e=b[f]);return e}}var b=Array.prototype.slice;fabric.util.array={fill:function(b,a){for(var c=b.length;c--;)b[c]=a;return b},invoke:function(e,a){for(var c=b.call(arguments,2),f=[],k=0,g=e.length;k<g;k++)f[k]=c.length?e[k][a].apply(e[k],c):e[k][a].call(e[k]);return f},min:function(b,a){return d(b,a,function(a,f){return a<f})},max:function(b,a){return d(b,a,function(a,f){return a>=f})}}})();(function(){function d(b,e,a){if(a)if(!fabric.isLikelyNode&&e instanceof Element)b=e;else if(e instanceof Array){b=[];for(var c=0,f=e.length;c<f;c++)b[c]=d({},e[c],a)}else if(e&&"object"===typeof e)for(c in e)e.hasOwnProperty(c)&&(b[c]=d({},e[c],a));else b=e;else for(c in e)b[c]=e[c];return b}fabric.util.object={extend:d,clone:function(b,e){return d({},b,e)}};fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function d(b,e){var a=b.charCodeAt(e);if(isNaN(a))return"";if(55296>a||57343<a)return b.charAt(e);if(55296<=a&&56319>=a){if(b.length<=e+1)throw"High surrogate without following low surrogate";a=b.charCodeAt(e+1);if(56320>a||57343<a)throw"High surrogate without following low surrogate";return b.charAt(e)+b.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";a=b.charCodeAt(e-1);if(55296>a||56319<a)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:function(b){return b.replace(/-+(.)?/g,function(b,a){return a?a.toUpperCase():""})},capitalize:function(b,e){return b.charAt(0).toUpperCase()+(e?b.slice(1):b.slice(1).toLowerCase())},escapeXml:function(b){return b.replace(/&/g,"\x26amp;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26apos;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;")},graphemeSplit:function(b){var e,a,c=[];e=0;for(a;e<b.length;e++)!1!==(a=d(b,e))&&c.push(a);return c}}})();(function(){function d(){}function b(a){for(var c=null,f=this;f.constructor.superclass;){var b=f.constructor.superclass.prototype[a];if(f[a]!==b){c=b;break}f=f.constructor.superclass.prototype}return c?1<arguments.length?c.apply(this,e.call(arguments,1)):c.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}var e=Array.prototype.slice,a=function(){},c=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),f=function(a,g,f){for(var b in g)b in a.prototype&&"function"===typeof a.prototype[b]&&-1<(g[b]+"").indexOf("callSuper")?a.prototype[b]=function(a){return function(){var c=this.constructor.superclass;this.constructor.superclass=f;var b=g[a].apply(this,arguments);this.constructor.superclass=c;if("initialize"!==a)return b}}(b):a.prototype[b]=g[b],c&&(g.toString!==Object.prototype.toString&&(a.prototype.toString=g.toString),g.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=g.valueOf))};fabric.util.createClass=function(){function c(){this.initialize.apply(this,arguments)}var g=null,h=e.call(arguments,0);"function"===typeof h[0]&&(g=h.shift());c.superclass=g;c.subclasses=[];g&&(d.prototype=g.prototype,c.prototype=new d,g.subclasses.push(c));for(var l=0,m=h.length;l<m;l++)f(c,h[l],g);c.prototype.initialize||(c.prototype.initialize=a);c.prototype.constructor=c;c.prototype.callSuper=b;return c}})();(function(){function d(a){var c=Array.prototype.slice.call(arguments,1),g,f,b=c.length;for(f=0;f<b;f++)if(g=typeof a[c[f]],!/^(?:function|object|unknown)$/.test(g))return!1;return!0}function b(a,g){return function(f){g.call(c(a),f||fabric.window.event)}}function e(a,c){return function(g){if(m[a]&&m[a][c])for(var f=m[a][c],b=0,e=f.length;b<e;b++)f[b].call(this,g||fabric.window.event)}}function a(a,c,g){var f;(c=a["touchend"===a.type?"changedTouches":"touches"])&&c[0]&&(f=c[0][g]);"undefined"===typeof f&&(f=a[g]);return f}var c,f,k=function(){var a=0;return function(c){return c.__uniqueID||(c.__uniqueID="uniqueID__"+a++)}}();(function(){var a={};c=function(c){return a[c]};f=function(c,g){a[c]=g}})();var g=d(fabric.document.documentElement,"addEventListener","removeEventListener")&&d(fabric.window,"addEventListener","removeEventListener"),h=d(fabric.document.documentElement,"attachEvent","detachEvent")&&d(fabric.window,"attachEvent","detachEvent"),l={},m={},n;g?(g=function(a,c,g,f){a&&a.addEventListener(c,g,h?!1:f)},n=function(a,c,g,f){a&&a.removeEventListener(c,g,h?!1:f)}):h?(g=function(a,c,g){if(a){var e=k(a);f(e,a);l[e]||(l[e]={});l[e][c]||(l[e][c]=[]);g={handler:g,wrappedHandler:b(e,g)};l[e][c].push(g);a.attachEvent("on"+c,g.wrappedHandler)}},n=function(a,c,g){if(a){var f=k(a),b;if(l[f]&&l[f][c])for(var e=0,h=l[f][c].length;e<h;e++)(b=l[f][c][e])&&b.handler===g&&(a.detachEvent("on"+c,b.wrappedHandler),l[f][c][e]=null)}}):(g=function(a,c,g){if(a){var f=k(a);m[f]||(m[f]={});if(!m[f][c]){m[f][c]=[];var b=a["on"+c];b&&m[f][c].push(b);a["on"+c]=e(f,c)}m[f][c].push(g)}},n=function(a,c,g){if(a&&(a=k(a),m[a]&&m[a][c])){c=m[a][c];a=0;for(var f=c.length;a<f;a++)c[a]===g&&c.splice(a,1)}});fabric.util.addListener=g;fabric.util.removeListener=n;var p=function(a){return a.clientX},q=function(a){return a.clientY};fabric.isTouchSupported&&(p=function(c){return a(c,"pageX","clientX")},q=function(c){return a(c,"pageY","clientY")});fabric.util.getPointer=function(a){a||(a=fabric.window.event);var c=fabric.util.getScrollLeftTop(a.target||("unknown"!==typeof a.srcElement?a.srcElement:null));return{x:p(a)+c.left,y:q(a)+c.top}}})();(function(){var d=fabric.document.createElement("div"),b="string"===typeof d.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(a){return a};"string"===typeof d.style.opacity?a=function(a,f){a.style.opacity=f;return a}:b&&(a=function(a,f){var c=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1);e.test(c.filter)?c.filter=c.filter.replace(e,.9999<=f?"":"alpha(opacity\x3d"+100*f+")"):c.filter+=" alpha(opacity\x3d"+100*f+")";return a});fabric.util.setStyle=function(c,f){var b=c.style;if(!b)return c;if("string"===typeof f)return c.style.cssText+=";"+f,-1<f.indexOf("opacity")?a(c,f.match(/opacity:\s*(\d?\.?\d*)/)[1]):c;for(var g in f)"opacity"===g?a(c,f[g]):b["float"===g||"cssFloat"===g?"undefined"===typeof b.styleFloat?"cssFloat":"styleFloat":g]=f[g];return c}})();(function(){function d(a,c){var g=fabric.document.createElement(a),f;for(f in c)"class"===f?g.className=c[f]:"for"===f?g.htmlFor=c[f]:g.setAttribute(f,c[f]);return g}function b(a){for(var c=0,f=0,b=fabric.document.documentElement,e=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===fabric.document?(c=e.scrollLeft||b.scrollLeft||0,f=e.scrollTop||b.scrollTop||0):(c+=a.scrollLeft||0,f+=a.scrollTop||0),1!==a.nodeType||"fixed"!==a.style.position););return{left:c,top:f}}var e=Array.prototype.slice,a,c=function(a){return e.call(a,0)};try{a=c(fabric.document.childNodes)instanceof Array}catch(k){}a||(c=function(a){for(var c=Array(a.length),f=a.length;f--;)c[f]=a[f];return c});var f;f=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,c){var g=fabric.document.defaultView.getComputedStyle(a,null);return g?g[c]:void 0}:function(a,c){var g=a.style[c];!g&&a.currentStyle&&(g=a.currentStyle[c]);return g};(function(){var a=fabric.document.documentElement.style,c="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction);c?a.style[c]="none":"string"===typeof a.unselectable&&(a.unselectable="on");return a};fabric.util.makeElementSelectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=null);c?a.style[c]="":"string"===typeof a.unselectable&&(a.unselectable="");return a}})();(function(){fabric.util.getScript=function(a,c){var g=fabric.document.getElementsByTagName("head")[0],f=fabric.document.createElement("script"),b=!0;f.onload=f.onreadystatechange=function(a){!b||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(b=!1,c(a||fabric.window.event),f=f.onload=f.onreadystatechange=null)};f.src=a;g.appendChild(f)}})();fabric.util.getById=function(a){return"string"===typeof a?fabric.document.getElementById(a):a};fabric.util.toArray=c;fabric.util.makeElement=d;fabric.util.addClass=function(a,c){a&&-1===(" "+a.className+" ").indexOf(" "+c+" ")&&(a.className+=(a.className?" ":"")+c)};fabric.util.wrapElement=function(a,c,f){"string"===typeof c&&(c=d(c,f));a.parentNode&&a.parentNode.replaceChild(c,a);c.appendChild(a);return c};fabric.util.getScrollLeftTop=b;fabric.util.getElementOffset=function(a){var c;c=a&&a.ownerDocument;var e={left:0,top:0},k={left:0,top:0},d={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!c)return k;for(var n in d)k[d[n]]+=parseInt(f(a,n),10)||0;c=c.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(e=a.getBoundingClientRect());a=b(a);return{left:e.left+a.left-(c.clientLeft||0)+k.left,top:e.top+a.top-(c.clientTop||0)+k.top}};fabric.util.getElementStyle=f;fabric.util.getNodeCanvas=function(a){a=fabric.jsdomImplForWrapper(a);return a._canvas||a._image}})();(function(){function d(a,c){return a+(/\?/.test(a)?"\x26":"?")+c}function b(){}var e=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(f){}}();fabric.util.request=function(a,c){c||(c={});var f=c.method?c.method.toUpperCase():"GET",k=c.onComplete||function(){},g=e(),h=c.body||c.parameters;g.onreadystatechange=function(){4===g.readyState&&(k(g),g.onreadystatechange=b)};"GET"===f&&(h=null,"string"===typeof c.parameters&&(a=d(a,c.parameters)));g.open(f,a,!0);"POST"!==f&&"PUT"!==f||g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");g.send(h);return g}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(d){"undefined"!==typeof console[d]&&"function"===typeof console[d].apply&&(fabric[d]=function(){return console[d].apply(console,arguments)})});(function(){function d(){return!1}function b(){return e.apply(fabric.window,arguments)}var e=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){return fabric.window.setTimeout(a,1E3/60)},a=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;fabric.util.animate=function(a){b(function(c){a||(a={});var f=c||+new Date,g=a.duration||500,e=f+g,l,m=a.onChange||d,n=a.abort||d,p=a.onComplete||d,q=a.easing||function(a,c,f,g){return-f*Math.cos(a/g*(Math.PI/2))+f+c},r="startValue"in a?a.startValue:0,t="endValue"in a?a.endValue:100,u=a.byValue||t-r;a.onStart&&a.onStart();(function w(c){if(n())p(t,1,1);else{l=c||+new Date;var h=l>e?g:l-f;c=h/g;h=q(h,r,u,g);m(h,Math.abs((h-r)/u),c);l>e?a.onComplete&&a.onComplete():b(w)}})(f)})};fabric.util.requestAnimFrame=b;fabric.util.cancelAnimFrame=function(){return a.apply(fabric.window,arguments)}})();(function(){fabric.util.animateColor=function(d,b,e,a){d=(new fabric.Color(d)).getSource();b=(new fabric.Color(b)).getSource();a=a||{};fabric.util.animate(fabric.util.object.extend(a,{duration:e||500,startValue:d,endValue:b,byValue:b,easing:function(c,f,b,g){c=a.colorEasing?a.colorEasing(c,g):1-Math.cos(c/g*(Math.PI/2));g="rgba("+parseInt(f[0]+c*(b[0]-f[0]),10)+","+parseInt(f[1]+c*(b[1]-f[1]),10)+","+parseInt(f[2]+c*(b[2]-f[2]),10);g+=","+(f&&b?parseFloat(f[3]+c*(b[3]-f[3])):1);return g+")"}}))}})();(function(){function d(a,f,b,g){a<Math.abs(f)?(a=f,g=b/4):g=0===f&&0===a?b/(2*Math.PI)*Math.asin(1):b/(2*Math.PI)*Math.asin(f/a);return{a:a,c:f,p:b,s:g}}function b(a,f,b){return a.a*Math.pow(2,10*--f)*Math.sin(2*(f*b-a.s)*Math.PI/a.p)}function e(c,f,b,g){return b-a(g-c,0,b,g)+f}function a(a,f,b,g){return(a/=g)<1/2.75?7.5625*b*a*a+f:a<2/2.75?b*(7.5625*(a-=1.5/2.75)*a+.75)+f:a<2.5/2.75?b*(7.5625*(a-=2.25/2.75)*a+.9375)+f:b*(7.5625*(a-=2.625/2.75)*a+.984375)+f}fabric.util.ease={easeInQuad:function(a,f,b,g){return b*(a/=g)*a+f},easeOutQuad:function(a,f,b,g){return-b*(a/=g)*(a-2)+f},easeInOutQuad:function(a,f,b,g){a/=g/2;return 1>a?b/2*a*a+f:-b/2*(--a*(a-2)-1)+f},easeInCubic:function(a,f,b,g){return b*(a/=g)*a*a+f},easeOutCubic:function(a,f,b,g){return b*((a=a/g-1)*a*a+1)+f},easeInOutCubic:function(a,f,b,g){a/=g/2;return 1>a?b/2*a*a*a+f:b/2*((a-=2)*a*a+2)+f},easeInQuart:function(a,f,b,g){return b*(a/=g)*a*a*a+f},easeOutQuart:function(a,f,b,g){return-b*((a=a/g-1)*a*a*a-1)+f},easeInOutQuart:function(a,f,b,g){a/=g/2;return 1>a?b/2*a*a*a*a+f:-b/2*((a-=2)*a*a*a-2)+f},easeInQuint:function(a,f,b,g){return b*(a/=g)*a*a*a*a+f},easeOutQuint:function(a,f,b,g){return b*((a=a/g-1)*a*a*a*a+1)+f},easeInOutQuint:function(a,f,b,g){a/=g/2;return 1>a?b/2*a*a*a*a*a+f:b/2*((a-=2)*a*a*a*a+2)+f},easeInSine:function(a,f,b,g){return-b*Math.cos(a/g*(Math.PI/2))+b+f},easeOutSine:function(a,f,b,g){return b*Math.sin(a/g*(Math.PI/2))+f},easeInOutSine:function(a,f,b,g){return-b/2*(Math.cos(Math.PI*a/g)-1)+f},easeInExpo:function(a,f,b,g){return 0===a?f:b*Math.pow(2,10*(a/g-1))+f},easeOutExpo:function(a,f,b,g){return a===g?f+b:b*(-Math.pow(2,-10*a/g)+1)+f},easeInOutExpo:function(a,f,b,g){if(0===a)return f;if(a===g)return f+b;a/=g/2;return 1>a?b/2*Math.pow(2,10*(a-1))+f:b/2*(-Math.pow(2,-10*--a)+2)+f},easeInCirc:function(a,f,b,g){return-b*(Math.sqrt(1-(a/=g)*a)-1)+f},easeOutCirc:function(a,f,b,g){return b*Math.sqrt(1-(a=a/g-1)*a)+f},easeInOutCirc:function(a,f,b,g){a/=g/2;return 1>a?-b/2*(Math.sqrt(1-a*a)-1)+f:b/2*(Math.sqrt(1-(a-=2)*a)+1)+f},easeInElastic:function(a,f,e,g){var c=0;if(0===a)return f;a/=g;if(1===a)return f+e;c||(c=.3*g);e=d(e,e,c,1.70158);return-b(e,a,g)+f},easeOutElastic:function(a,f,b,g){var c=0;if(0===a)return f;a/=g;if(1===a)return f+b;c||(c=.3*g);b=d(b,b,c,1.70158);return b.a*Math.pow(2,-10*a)*Math.sin(2*(a*g-b.s)*Math.PI/b.p)+b.c+f},easeInOutElastic:function(a,f,e,g){var c=0;if(0===a)return f;a/=g/2;if(2===a)return f+e;c||(c=.3*g*1.5);e=d(e,e,c,1.70158);return 1>a?-.5*b(e,a,g)+f:e.a*Math.pow(2,-10*--a)*Math.sin(2*(a*g-e.s)*Math.PI/e.p)*.5+e.c+f},easeInBack:function(a,f,b,g,e){void 0===e&&(e=1.70158);return b*(a/=g)*a*((e+1)*a-e)+f},easeOutBack:function(a,f,b,g,e){void 0===e&&(e=1.70158);return b*((a=a/g-1)*a*((e+1)*a+e)+1)+f},easeInOutBack:function(a,f,b,g,e){void 0===e&&(e=1.70158);a/=g/2;return 1>a?b/2*a*a*(((e*=1.525)+1)*a-e)+f:b/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+f},easeInBounce:e,easeOutBounce:a,easeInOutBounce:function(c,f,b,g){return c<g/2?.5*e(2*c,0,b,g)+f:.5*a(2*c-g,0,b,g)+.5*b+f}}})();(function(d){function b(a,c,f,g){var b="[object Array]"===Object.prototype.toString.call(c),e;"fill"!==a&&"stroke"!==a||"none"!==c?"strokeDashArray"===a?c="none"===c?null:c.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?c=f&&f.transformMatrix?t(f.transformMatrix,m.parseTransformAttribute(c)):m.parseTransformAttribute(c):"visible"===a?(c="none"!==c&&"hidden"!==c,f&&!1===f.visible&&(c=!1)):"opacity"===a?(c=parseFloat(c),f&&"undefined"!==typeof f.opacity&&(c*=f.opacity)):"textAnchor"===a?c="start"===c?"left":"end"===c?"right":"center":"charSpacing"===a?e=r(c,g)/g*1E3:"paintFirst"===a?(a=c.indexOf("fill"),f=c.indexOf("stroke"),c="fill",-1<a&&-1<f&&f<a?c="stroke":-1===a&&-1<f&&(c="stroke")):e=b?c.map(r):r(c,g):c="";return!b&&isNaN(e)?c:e}function e(a){return new RegExp("^("+a.join("|")+")\\b","i")}function a(a){for(var c in y)if("undefined"!==typeof a[y[c]]&&""!==a[c]){if("undefined"===typeof a[c]){if(!m.Object.prototype[c])continue;a[c]=m.Object.prototype[c]}if(0!==a[c].indexOf("url(")){var f=new m.Color(a[c]);a[c]=f.setAlpha(q(f.getAlpha()*a[y[c]],2)).toRgba()}}return a}function c(a,c){var f,g=[],b,e;b=0;for(e=c.length;b<e;b++)f=c[b],f=a.getElementsByTagName(f),g=g.concat(Array.prototype.slice.call(f));return g}function f(a,c){var f,g;a.replace(/;\s*$/,"").split(";").forEach(function(a){a=a.split(":");f=a[0].trim().toLowerCase();g=a[1].trim();c[f]=g})}function k(a,c){var f={},b;for(b in m.cssRules[c]){var e=a,h=b.split(" "),d,k=!0;if((d=g(e,h.pop()))&&h.length){for(var k=h,l=void 0,n=!0;e.parentNode&&1===e.parentNode.nodeType&&k.length;)n&&(l=k.pop()),e=e.parentNode,n=g(e,l);k=0===k.length}if(d&&k&&0===h.length)for(var p in m.cssRules[c][b])f[p]=m.cssRules[c][b][p]}return f}function g(a,c){var f=a.nodeName,g=a.getAttribute("class"),b=a.getAttribute("id"),f=new RegExp("^"+f,"i");c=c.replace(f,"");b&&c.length&&(f=new RegExp("#"+b+"(?![a-zA-Z\\-]+)","i"),c=c.replace(f,""));if(g&&c.length)for(g=g.split(" "),b=g.length;b--;)f=new RegExp("\\."+g[b]+"(?![a-zA-Z\\-]+)","i"),c=c.replace(f,"");return 0===c.length}function h(a){for(var f=c(a,["use","svg:use"]),g=0;f.length&&g<f.length;){var b=f[g],e=b.getAttribute("xlink:href").substr(1),h=b.getAttribute("x")||0,d=b.getAttribute("y")||0;a:{var k=a,m=void 0;k.getElementById&&(m=k.getElementById(e));if(m)e=m;else{var n,p=k.getElementsByTagName("*"),m=0;for(n=p.length;m<n;m++)if(k=p[m],e===k.getAttribute("id")){e=k;break a}e=void 0}}e=e.cloneNode(!0);h=(e.getAttribute("transform")||"")+" translate("+h+", "+d+")";d=f.length;l(e);if(/^svg$/i.test(e.nodeName)){var r=e.ownerDocument.createElement("g"),m=0;n=e.attributes;for(p=n.length;m<p;m++)k=n.item(m),r.setAttribute(k.nodeName,k.nodeValue);for(;e.firstChild;)r.appendChild(e.firstChild);e=r}m=0;n=b.attributes;for(p=n.length;m<p;m++)k=n.item(m),"x"!==k.nodeName&&"y"!==k.nodeName&&"xlink:href"!==k.nodeName&&("transform"===k.nodeName?h=k.nodeValue+" "+h:e.setAttribute(k.nodeName,k.nodeValue));e.setAttribute("transform",h);e.setAttribute("instantiated_by_use","1");e.removeAttribute("id");b.parentNode.replaceChild(e,b);f.length===d&&g++}}function l(a){var c=a.getAttribute("viewBox"),f=1,g=1,b,e,h,d=a.getAttribute("width"),k=a.getAttribute("height"),l=a.getAttribute("x")||0,n=a.getAttribute("y")||0,p=a.getAttribute("preserveAspectRatio")||"";b=!c||!m.svgViewBoxElementsRegEx.test(a.nodeName)||!(c=c.match(w));var q=!d||!k||"100%"===d||"100%"===k;e=b&&q;var t={},x="",u=0,y=0;t.width=0;t.height=0;if(t.toBeParsed=e)return t;if(b)return t.width=r(d),t.height=r(k),t;b=-parseFloat(c[1]);e=-parseFloat(c[2]);h=parseFloat(c[3]);c=parseFloat(c[4]);q?(t.width=h,t.height=c):(t.width=r(d),t.height=r(k),f=t.width/h,g=t.height/c);p=m.util.parsePreserveAspectRatioAttribute(p);"none"!==p.alignX&&("meet"===p.meetOrSlice&&(g=f=f>g?g:f),"slice"===p.meetOrSlice&&(g=f=f>g?f:g),u=t.width-h*f,y=t.height-c*f,"Mid"===p.alignX&&(u/=2),"Mid"===p.alignY&&(y/=2),"Min"===p.alignX&&(u=0),"Min"===p.alignY&&(y=0));if(1===f&&1===g&&0===b&&0===e&&0===l&&0===n)return t;if(l||n)x=" translate("+r(l)+" "+r(n)+") ";f=x+" matrix("+f+" 0 0 "+g+" "+(b*f+u)+" "+(e*g+y)+") ";if("svg"===a.nodeName){for(g=a.ownerDocument.createElement("g");a.firstChild;)g.appendChild(a.firstChild);a.appendChild(g)}else g=a,f=g.getAttribute("transform")+f;g.setAttribute("transform",f);return t}var m=d.fabric||(d.fabric={}),n=m.util.object.extend,p=m.util.object.clone,q=m.util.toFixed,r=m.util.parseUnit,t=m.util.multiplyTransformMatrices,u={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity"},y={stroke:"strokeOpacity",fill:"fillOpacity"};m.svgValidTagNamesRegEx=e("path circle polygon polyline ellipse rect line image text linearGradient radialGradient stop".split(" "));m.svgViewBoxElementsRegEx=e("symbol image marker pattern view svg".split(" "));m.svgInvalidAncestorsRegEx=e("pattern defs symbol metadata clipPath mask desc".split(" "));m.svgValidParentsRegEx=e(["symbol","g","a","svg"]);m.cssRules={};m.gradientDefs={};m.parseTransformAttribute=function(){function a(a,c){var f=m.util.cos(c[0]),g=m.util.sin(c[0]),b=0,e=0;3===c.length&&(b=c[1],e=c[2]);a[0]=f;a[1]=g;a[2]=-g;a[3]=f;a[4]=b-(f*b-g*e);a[5]=e-(g*b+f*e)}function c(a,c){var f=2===c.length?c[1]:c[0];a[0]=c[0];a[3]=f}function f(a,c){a[4]=c[0];2===c.length&&(a[5]=c[1])}var g=[1,0,0,1,0,0],b=m.reNum,e="(?:"+("(?:(matrix)\\s*\\(\\s*("+b+")(?:\\s+,?\\s*|,\\s*)("+b+")(?:\\s+,?\\s*|,\\s*)("+b+")(?:\\s+,?\\s*|,\\s*)("+b+")(?:\\s+,?\\s*|,\\s*)("+b+")(?:\\s+,?\\s*|,\\s*)("+b+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+b+")(?:(?:\\s+,?\\s*|,\\s*)("+b+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+b+")(?:(?:\\s+,?\\s*|,\\s*)("+b+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+b+")(?:(?:\\s+,?\\s*|,\\s*)("+b+")(?:\\s+,?\\s*|,\\s*)("+b+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+b+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+b+")\\s*\\))")+")",h=new RegExp("^\\s*(?:"+("(?:"+e+"(?:(?:\\s+,?\\s*|,\\s*)*"+e+")*)")+"?)\\s*$"),d=new RegExp(e,"g");return function(b){var k=g.concat(),l=[];if(!b||b&&!h.test(b))return k;b.replace(d,function(b){var h=(new RegExp(e)).exec(b).filter(function(a){return!!a});b=h[1];h=h.slice(2).map(parseFloat);switch(b){case "translate":f(k,h);break;case "rotate":h[0]=m.util.degreesToRadians(h[0]);a(k,h);break;case "scale":c(k,h);break;case "skewX":k[2]=Math.tan(m.util.degreesToRadians(h[0]));break;case "skewY":k[1]=Math.tan(m.util.degreesToRadians(h[0]));break;case "matrix":k=h}l.push(k.concat());k=g.concat()});for(b=l[0];1<l.length;)l.shift(),b=m.util.multiplyTransformMatrices(b,l[0]);return b}}();var w=new RegExp("^\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*,?\\s*("+m.reNum+"+)\\s*$");m.parseSVGDocument=function(a,c,f,g){if(a){h(a);var b=m.Object.__uid++,e,d,k=l(a),n=m.util.toArray(a.getElementsByTagName("*"));k.crossOrigin=g&&g.crossOrigin;k.svgUid=b;if(0===n.length&&m.isLikelyNode){var n=a.selectNodes('//*[name(.)!\x3d"svg"]'),r=[];e=0;for(d=n.length;e<d;e++)r[e]=n[e];n=r}e=n.filter(function(a){l(a);var c;if(c=m.svgValidTagNamesRegEx.test(a.nodeName.replace("svg:",""))){a:{for(c=m.svgInvalidAncestorsRegEx;a&&(a=a.parentNode);)if(a.nodeName&&c.test(a.nodeName.replace("svg:",""))&&!a.getAttribute("instantiated_by_use")){a=!0;break a}a=!1}c=!a}return c});!e||e&&!e.length?c&&c([],{}):(m.gradientDefs[b]=m.getGradientDefs(a),m.cssRules[b]=m.getCSSRules(a),m.parseElements(e,function(a,f){c&&c(a,k,f,n)},p(k),f,g))}};var z=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+m.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+m.reNum+"))?\\s+(.*)");n(m,{parseFontDeclaration:function(a,c){var f=a.match(z);if(f){var g=f[1],b=f[3],e=f[4],h=f[5],f=f[6];g&&(c.fontStyle=g);b&&(c.fontWeight=isNaN(parseFloat(b))?b:parseFloat(b));e&&(c.fontSize=r(e));f&&(c.fontFamily=f);h&&(c.lineHeight="normal"===h?1:h)}},getGradientDefs:function(a){var f=c(a,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),g,b,e,h={},d={};for(g=f.length;g--;)a=f[g],e=a.getAttribute("xlink:href"),b=a.getAttribute("id"),e&&(d[b]=e.substr(1)),h[b]=a;for(b in d)for(f=h[d[b]].cloneNode(!0),a=h[b];f.firstChild;)a.appendChild(f.firstChild);return h},parseAttributes:function(c,f,g){if(c){var e,h={},d;"undefined"===typeof g&&(g=c.getAttribute("svgUid"));c.parentNode&&m.svgValidParentsRegEx.test(c.parentNode.nodeName)&&(h=m.parseAttributes(c.parentNode,f,g));d=h&&h.fontSize||c.getAttribute("font-size")||m.Text.DEFAULT_SVG_FONT_SIZE;f=f.reduce(function(a,f){(e=c.getAttribute(f))&&(a[f]=e);return a},{});f=n(f,n(k(c,g),m.parseStyleAttribute(c)));var l,p={},r;for(r in f)g=r in u?u[r]:r,l=b(g,f[r],h,d),p[g]=l;p&&p.font&&m.parseFontDeclaration(p.font,p);h=n(h,p);return m.svgValidParentsRegEx.test(c.nodeName)?h:a(h)}},parseElements:function(a,c,f,g,b){(new m.ElementsParser(a,c,f,g,b)).parse()},parseStyleAttribute:function(a){var c={};a=a.getAttribute("style");if(!a)return c;if("string"===typeof a)f(a,c);else{var g,b,e;for(e in a)"undefined"!==typeof a[e]&&(g=e.toLowerCase(),b=a[e],c[g]=b)}return c},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim();a=a.split(/\s+/);var c=[],f,g;f=0;for(g=a.length;f<g;f+=2)c.push({x:parseFloat(a[f]),y:parseFloat(a[f+1])});return c},getCSSRules:function(a){a=a.getElementsByTagName("style");var c,f,g={},b;c=0;for(f=a.length;c<f;c++)b=a[c].textContent||a[c].text,b=b.replace(/\/\*[\s\S]*?\*\//g,""),""!==b.trim()&&(b=b.match(/[^{]*\{[\s\S]*?\}/g),b=b.map(function(a){return a.trim()}),b.forEach(function(a){a=a.match(/([\s\S]*?)\s*\{([^}]*)\}/);var b={},e=a[2].trim().replace(/;$/,"").split(/\s*;\s*/);c=0;for(f=e.length;c<f;c++){var h=e[c].split(/\s*:\s*/);b[h[0]]=h[1]}a=a[1];a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim();""!==a&&(g[a]?m.util.object.extend(g[a],b):g[a]=m.util.object.clone(b))})}));return g},loadSVGFromURL:function(a,c,f,g){a=a.replace(/^\n\s*/,"").trim();new m.util.request(a,{method:"get",onComplete:function(a){var b=a.responseXML;b&&!b.documentElement&&m.window.ActiveXObject&&a.responseText&&(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));b&&b.documentElement||c&&c(null);m.parseSVGDocument(b.documentElement,function(a,f,g,b){c&&c(a,f,g,b)},f,g)}})},loadSVGFromString:function(a,c,f,g){a=a.trim();var b;if("undefined"!==typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(b=e.parseFromString(a,"text/xml"))}else m.window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));m.parseSVGDocument(b.documentElement,function(a,f,g,b){c(a,f,g,b)},f,g)}})})("undefined"!==typeof exports?exports:this);fabric.ElementsParser=function(d,b,e,a,c){this.elements=d;this.callback=b;this.options=e;this.reviver=a;this.svgUid=e&&e.svgUid||0;this.parsingOptions=c;this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g};fabric.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var d=0,b=this.elements.length;d<b;d++)this.elements[d].setAttribute("svgUid",this.svgUid),function(b,a){setTimeout(function(){b.createObject(b.elements[a],a)},0)}(this,d)};fabric.ElementsParser.prototype.createObject=function(d,b){var e=fabric[fabric.util.string.capitalize(d.tagName.replace("svg:",""))];if(e&&e.fromElement)try{this._createObject(e,d,b)}catch(a){fabric.log(a)}else this.checkIfDone()};fabric.ElementsParser.prototype._createObject=function(d,b,e){d.fromElement(b,this.createCallback(e,b),this.options)};fabric.ElementsParser.prototype.createCallback=function(d,b){var e=this;return function(a){var c;e.resolveGradient(a,"fill");e.resolveGradient(a,"stroke");a instanceof fabric.Image&&(c=a.parsePreserveAspectRatioAttribute(b));a._removeTransformMatrix(c);e.reviver&&e.reviver(b,a);e.instances[d]=a;e.checkIfDone()}};fabric.ElementsParser.prototype.resolveGradient=function(d,b){var e=d[b];/^url\(/.test(e)&&(e=this.regexUrl.exec(e)[1],this.regexUrl.lastIndex=0,fabric.gradientDefs[this.svgUid][e]&&d.set(b,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][e],d)))};fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(d){return null!=d}),this.callback(this.instances,this.elements))};(function(d){function b(b,a){this.x=b;this.y=a}d=d.fabric||(d.fabric={});d.Point?d.warn("fabric.Point is already defined"):(d.Point=b,b.prototype={type:"point",constructor:b,add:function(e){return new b(this.x+e.x,this.y+e.y)},addEquals:function(b){this.x+=b.x;this.y+=b.y;return this},scalarAdd:function(e){return new b(this.x+e,this.y+e)},scalarAddEquals:function(b){this.x+=b;this.y+=b;return this},subtract:function(e){return new b(this.x-e.x,this.y-e.y)},subtractEquals:function(b){this.x-=b.x;this.y-=b.y;return this},scalarSubtract:function(e){return new b(this.x-e,this.y-e)},scalarSubtractEquals:function(b){this.x-=b;this.y-=b;return this},multiply:function(e){return new b(this.x*e,this.y*e)},multiplyEquals:function(b){this.x*=b;this.y*=b;return this},divide:function(e){return new b(this.x/e,this.y/e)},divideEquals:function(b){this.x/=b;this.y/=b;return this},eq:function(b){return this.x===b.x&&this.y===b.y},lt:function(b){return this.x<b.x&&this.y<b.y},lte:function(b){return this.x<=b.x&&this.y<=b.y},gt:function(b){return this.x>b.x&&this.y>b.y},gte:function(b){return this.x>=b.x&&this.y>=b.y},lerp:function(e,a){"undefined"===typeof a&&(a=.5);a=Math.max(Math.min(1,a),0);return new b(this.x+(e.x-this.x)*a,this.y+(e.y-this.y)*a)},distanceFrom:function(b){var a=this.x-b.x;b=this.y-b.y;return Math.sqrt(a*a+b*b)},midPointFrom:function(b){return this.lerp(b)},min:function(e){return new b(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new b(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(b,a){this.x=b;this.y=a;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setFromPoint:function(b){this.x=b.x;this.y=b.y;return this},swap:function(b){var a=this.x,c=this.y;this.x=b.x;this.y=b.y;b.x=a;b.y=c},clone:function(){return new b(this.x,this.y)}})})("undefined"!==typeof exports?exports:this);(function(d){function b(a){this.status=a;this.points=[]}var e=d.fabric||(d.fabric={});e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=b,e.Intersection.prototype={constructor:b,appendPoint:function(a){this.points.push(a);return this},appendPoints:function(a){this.points=this.points.concat(a);return this}},e.Intersection.intersectLineLine=function(a,c,f,d){var g,h=(d.x-f.x)*(a.y-f.y)-(d.y-f.y)*(a.x-f.x);g=(c.x-a.x)*(a.y-f.y)-(c.y-a.y)*(a.x-f.x);f=(d.y-f.y)*(c.x-a.x)-(d.x-f.x)*(c.y-a.y);0!==f?(h/=f,g/=f,0<=h&&1>=h&&0<=g&&1>=g?(g=new b("Intersection"),g.appendPoint(new e.Point(a.x+h*(c.x-a.x),a.y+h*(c.y-a.y)))):g=new b):g=0===h||0===g?new b("Coincident"):new b("Parallel");return g},e.Intersection.intersectLinePolygon=function(a,c,f){var e=new b,g=f.length,h,d,m;for(m=0;m<g;m++)h=f[m],d=f[(m+1)%g],h=b.intersectLineLine(a,c,h,d),e.appendPoints(h.points);0<e.points.length&&(e.status="Intersection");return e},e.Intersection.intersectPolygonPolygon=function(a,c){var f=new b,e=a.length,g;for(g=0;g<e;g++){var h=b.intersectLinePolygon(a[g],a[(g+1)%e],c);f.appendPoints(h.points)}0<f.points.length&&(f.status="Intersection");return f},e.Intersection.intersectPolygonRectangle=function(a,c,f){var d=c.min(f),g=c.max(f);f=new e.Point(g.x,d.y);var h=new e.Point(d.x,g.y);c=b.intersectLinePolygon(d,f,a);f=b.intersectLinePolygon(f,g,a);g=b.intersectLinePolygon(g,h,a);a=b.intersectLinePolygon(h,d,a);d=new b;d.appendPoints(c.points);d.appendPoints(f.points);d.appendPoints(g.points);d.appendPoints(a.points);0<d.points.length&&(d.status="Intersection");return d})})("undefined"!==typeof exports?exports:this);(function(d){function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function e(a,f,b){0>b&&(b+=1);1<b&&--b;return b<1/6?a+6*(f-a)*b:.5>b?f:b<2/3?a+(f-a)*(2/3-b)*6:a}var a=d.fabric||(d.fabric={});a.Color?a.warn("fabric.Color is already defined."):(a.Color=b,a.Color.prototype={_tryParsingColor:function(a){var c;a in b.colorNameMap&&(a=b.colorNameMap[a]);"transparent"===a&&(c=[255,255,255,0]);c||(c=b.sourceFromHex(a));c||(c=b.sourceFromRgb(a));c||(c=b.sourceFromHsl(a));c||(c=[0,0,0,1]);c&&this.setSource(c)},_rgbToHsl:function(c,f,b){c/=255;f/=255;b/=255;var g,e,d,k=a.util.array.max([c,f,b]);e=a.util.array.min([c,f,b]);d=(k+e)/2;if(k===e)g=e=0;else{var n=k-e;e=.5<d?n/(2-k-e):n/(k+e);switch(k){case c:g=(f-b)/n+(f<b?6:0);break;case f:g=(b-c)/n+2;break;case b:g=(c-f)/n+4}g/=6}return[Math.round(360*g),Math.round(100*e),Math.round(100*d)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),f=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+f[0]+","+f[1]+"%,"+f[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),f,b;f=a[0].toString(16);f=1===f.length?"0"+f:f;b=a[1].toString(16);b=1===b.length?"0"+b:b;a=a[2].toString(16);a=1===a.length?"0"+a:a;return f.toUpperCase()+b.toUpperCase()+a.toUpperCase()},toHexa:function(){var a=this.getSource(),a=Math.round(255*a[3]),a=a.toString(16),a=1===a.length?"0"+a:a;return this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var c=this.getSource();c[3]=a;this.setSource(c);return this},toGrayscale:function(){var a=this.getSource(),f=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([f,f,f,a[3]]);return this},toBlackWhite:function(a){var c=this.getSource(),b=(.3*c[0]+.59*c[1]+.11*c[2]).toFixed(0),c=c[3],b=Number(b)<Number(a||127)?0:255;this.setSource([b,b,b,c]);return this},overlayWith:function(a){a instanceof b||(a=new b(a));var c=[],e=this.getAlpha(),g=this.getSource();a=a.getSource();var h;for(h=0;3>h;h++)c.push(Math.round(.5*g[h]+.5*a[h]));c[3]=e;this.setSource(c);return this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,a.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,a.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},a.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},a.Color.sourceFromRgb=function(a){if(a=a.match(b.reRGBa)){var c=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),e=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),g=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(c,10),parseInt(e,10),parseInt(g,10),a[4]?parseFloat(a[4]):1]}},a.Color.fromRgba=b.fromRgb,a.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},a.Color.sourceFromHsl=function(a){if(a=a.match(b.reHSLa)){var c=(parseFloat(a[1])%360+360)%360/360,d=parseFloat(a[2])/(/%$/.test(a[2])?100:1),g=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===d)g=d=c=g;else var h=.5>=g?g*(d+1):g+d-g*d,l=2*g-h,g=e(l,h,c+1/3),d=e(l,h,c),c=e(l,h,c-1/3);return[Math.round(255*g),Math.round(255*d),Math.round(255*c),a[4]?parseFloat(a[4]):1]}},a.Color.fromHsla=b.fromHsl,a.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},a.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),e=3===c.length||4===c.length,g=8===c.length||4===c.length;a=e?c.charAt(0)+c.charAt(0):c.substring(0,2);var h=e?c.charAt(1)+c.charAt(1):c.substring(2,4),d=e?c.charAt(2)+c.charAt(2):c.substring(4,6),c=g?e?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(a,16),parseInt(h,16),parseInt(d,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},a.Color.fromSource=function(a){var c=new b;c.setSource(a);return c})})("undefined"!==typeof exports?exports:this);(function(){function d(a){var c=a.getAttribute("style"),b=a.getAttribute("offset")||0,e,g,b=parseFloat(b)/(/%$/.test(b)?100:1),b=0>b?0:1<b?1:b;if(c){var h=c.split(/\s*;\s*/);""===h[h.length-1]&&h.pop();for(c=h.length;c--;){var d=h[c].split(/\s*:\s*/),m=d[0].trim(),d=d[1].trim();"stop-color"===m?e=d:"stop-opacity"===m&&(g=d)}}e||(e=a.getAttribute("stop-color")||"rgb(0,0,0)");g||(g=a.getAttribute("stop-opacity"));e=new fabric.Color(e);a=e.getAlpha();g=isNaN(parseFloat(g))?1:parseFloat(g);g*=a;return{offset:b,color:e.toRgb(),opacity:g}}function b(a,c,b){var f,g=0,e,d="",m;for(m in c){"Infinity"===c[m]?c[m]=1:"-Infinity"===c[m]&&(c[m]=0);f=parseFloat(c[m],10);e="string"===typeof c[m]&&/^(\d+\.\d+)%|(\d+)%$/.test(c[m])?.01:1;if("x1"===m||"x2"===m||"r2"===m)e*="objectBoundingBox"===b?a.width:1,g="objectBoundingBox"===b?a.left||0:0;else if("y1"===m||"y2"===m)e*="objectBoundingBox"===b?a.height:1,g="objectBoundingBox"===b?a.top||0:0;c[m]=f*e+g}"ellipse"===a.type&&null!==c.r2&&"objectBoundingBox"===b&&a.rx!==a.ry&&(a=a.ry/a.rx,d=" scale(1, "+a+")",c.y1&&(c.y1/=a),c.y2&&(c.y2/=a));return d}var e=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var c;this.id=fabric.Object.__uid++;this.type=a.type||"linear";c={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0};"radial"===this.type&&(c.r1=a.coords.r1||0,c.r2=a.coords.r2||0);this.coords=c;this.colorStops=a.colorStops.slice();a.gradientTransform&&(this.gradientTransform=a.gradientTransform);this.offsetX=a.offsetX||this.offsetX;this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var c in a){var b=new fabric.Color(a[c]);this.colorStops.push({offset:parseFloat(c),color:b.toRgb(),opacity:b.getAlpha()})}return this},toObject:function(a){var c={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};fabric.util.populateWithProperties(this,c,a);return c},toSVG:function(a){var c=e(this.coords,!0),b,d,g=e(this.colorStops,!0);b=c.r1>c.r2;var h=a.width/2,l=a.height/2;g.sort(function(a,c){return a.offset-c.offset});"path"===a.type&&(h-=a.pathOffset.x,l-=a.pathOffset.y);for(var m in c)if("x1"===m||"x2"===m)c[m]+=this.offsetX-h;else if("y1"===m||"y2"===m)c[m]+=this.offsetY-l;a='id\x3d"SVGID_'+this.id+'" gradientUnits\x3d"userSpaceOnUse"';this.gradientTransform&&(a+=' gradientTransform\x3d"matrix('+this.gradientTransform.join(" ")+')" ');"linear"===this.type?d=["\x3clinearGradient ",a,' x1\x3d"',c.x1,'" y1\x3d"',c.y1,'" x2\x3d"',c.x2,'" y2\x3d"',c.y2,'"\x3e\n']:"radial"===this.type&&(d=["\x3cradialGradient ",a,' cx\x3d"',b?c.x1:c.x2,'" cy\x3d"',b?c.y1:c.y2,'" r\x3d"',b?c.r1:c.r2,'" fx\x3d"',b?c.x2:c.x1,'" fy\x3d"',b?c.y2:c.y1,'"\x3e\n']);if("radial"===this.type){if(b)for(g=g.concat(),g.reverse(),b=0,a=g.length;b<a;b++)g[b].offset=1-g[b].offset;b=Math.min(c.r1,c.r2);if(0<b)for(c=b/Math.max(c.r1,c.r2),b=0,a=g.length;b<a;b++)g[b].offset+=c*(1-g[b].offset)}b=0;for(a=g.length;b<a;b++)c=g[b],d.push("\x3cstop ",'offset\x3d"',100*c.offset+"%",'" style\x3d"stop-color:',c.color,"undefined"!==typeof c.opacity?";stop-opacity: "+c.opacity:";",'"/\x3e\n');d.push("linear"===this.type?"\x3c/linearGradient\x3e\n":"\x3c/radialGradient\x3e\n");return d.join("")},toLive:function(a){var c,b=fabric.util.object.clone(this.coords);if(this.type){"linear"===this.type?c=a.createLinearGradient(b.x1,b.y1,b.x2,b.y2):"radial"===this.type&&(c=a.createRadialGradient(b.x1,b.y1,b.r1,b.x2,b.y2,b.r2));a=0;for(b=this.colorStops.length;a<b;a++){var e=this.colorStops[a].color,g=this.colorStops[a].opacity,h=this.colorStops[a].offset;"undefined"!==typeof g&&(e=(new fabric.Color(e)).setAlpha(g).toRgba());c.addColorStop(h,e)}return c}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(a,c){var f=a.getElementsByTagName("stop"),e,g=a.getAttribute("gradientUnits")||"objectBoundingBox",h=a.getAttribute("gradientTransform"),l=[],m,n;e="linearGradient"===a.nodeName||"LINEARGRADIENT"===a.nodeName?"linear":"radial";"linear"===e?m={x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}:"radial"===e&&(m={x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"});for(n=f.length;n--;)l.push(d(f[n]));f=b(c,m,g);e=new fabric.Gradient({type:e,coords:m,colorStops:l,offsetX:-c.left,offsetY:-c.top});if(h||""!==f)e.gradientTransform=fabric.parseTransformAttribute((h||"")+f);return e},forObject:function(a,c){c||(c={});b(a,c.coords,"userSpaceOnUse");return new fabric.Gradient(c)}})})();(function(){var d=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(b,e){b||(b={});this.id=fabric.Object.__uid++;this.setOptions(b);if(!b.source||b.source&&"string"!==typeof b.source)e&&e(this);else if("undefined"!==typeof fabric.util.getFunctionBody(b.source))this.source=new Function(fabric.util.getFunctionBody(b.source)),e&&e(this);else{var a=this;this.source=fabric.util.createImage();fabric.util.loadImage(b.source,function(c){a.source=c;e&&e(a)},null,this.crossOrigin)}},toObject:function(b){var e=fabric.Object.NUM_FRACTION_DIGITS,a;"function"===typeof this.source?a=String(this.source):"string"===typeof this.source.src?a=this.source.src:"object"===typeof this.source&&this.source.toDataURL&&(a=this.source.toDataURL());e={type:"pattern",source:a,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:d(this.offsetX,e),offsetY:d(this.offsetY,e),patternTransform:this.patternTransform?this.patternTransform.concat():null};fabric.util.populateWithProperties(this,e,b);return e},toSVG:function(b){var e="function"===typeof this.source?this.source():this.source,a=e.width/b.width,c=e.height/b.height,f=this.offsetX/b.width;b=this.offsetY/b.height;var d="";if("repeat-x"===this.repeat||"no-repeat"===this.repeat)c=1;if("repeat-y"===this.repeat||"no-repeat"===this.repeat)a=1;e.src?d=e.src:e.toDataURL&&(d=e.toDataURL());return'\x3cpattern id\x3d"SVGID_'+this.id+'" x\x3d"'+f+'" y\x3d"'+b+'" width\x3d"'+a+'" height\x3d"'+c+'"\x3e\n\x3cimage x\x3d"0" y\x3d"0" width\x3d"'+e.width+'" height\x3d"'+e.height+'" xlink:href\x3d"'+d+'"\x3e\x3c/image\x3e\n\x3c/pattern\x3e\n'},setOptions:function(b){for(var e in b)this[e]=b[e]},toLive:function(b){var e="function"===typeof this.source?this.source():this.source;return e&&("undefined"===typeof e.src||e.complete&&0!==e.naturalWidth&&0!==e.naturalHeight)?b.createPattern(e,this.repeat):""}})})();(function(d){var b=d.fabric||(d.fabric={}),e=b.util.toFixed;b.Shadow?b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"===typeof a&&(a=this._parseShadow(a));for(var c in a)this[c]=a[c];this.id=b.Object.__uid++},_parseShadow:function(a){a=a.trim();var c=b.Shadow.reOffsetsAndBlur.exec(a)||[];return{color:(a.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(c[1],10)||0,offsetY:parseInt(c[2],10)||0,blur:parseInt(c[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var c=40,f=40,d=b.Object.NUM_FRACTION_DIGITS,g=b.util.rotateVector({x:this.offsetX,y:this.offsetY},b.util.degreesToRadians(-a.angle)),h=new b.Color(this.color);a.width&&a.height&&(c=100*e((Math.abs(g.x)+this.blur)/a.width,d)+20,f=100*e((Math.abs(g.y)+this.blur)/a.height,d)+20);a.flipX&&(g.x*=-1);a.flipY&&(g.y*=-1);return'\x3cfilter id\x3d"SVGID_'+this.id+'" y\x3d"-'+f+'%" height\x3d"'+(100+2*f)+'%" x\x3d"-'+c+'%" width\x3d"'+(100+2*c)+'%" \x3e\n\t\x3cfeGaussianBlur in\x3d"SourceAlpha" stdDeviation\x3d"'+e(this.blur?this.blur/2:0,d)+'"\x3e\x3c/feGaussianBlur\x3e\n\t\x3cfeOffset dx\x3d"'+e(g.x,d)+'" dy\x3d"'+e(g.y,d)+'" result\x3d"oBlur" \x3e\x3c/feOffset\x3e\n\t\x3cfeFlood flood-color\x3d"'+h.toRgb()+'" flood-opacity\x3d"'+h.getAlpha()+'"/\x3e\n\t\x3cfeComposite in2\x3d"oBlur" operator\x3d"in" /\x3e\n\t\x3cfeMerge\x3e\n\t\t\x3cfeMergeNode\x3e\x3c/feMergeNode\x3e\n\t\t\x3cfeMergeNode in\x3d"SourceGraphic"\x3e\x3c/feMergeNode\x3e\n\t\x3c/feMerge\x3e\n\x3c/filter\x3e\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var a={},c=b.Shadow.prototype;["color","blur","offsetX","offsetY","affectStroke"].forEach(function(b){this[b]!==c[b]&&(a[b]=this[b])},this);return a}}),b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof exports?exports:this);(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var d=fabric.util.object.extend,b=fabric.util.getElementOffset,e=fabric.util.removeFromArray,a=fabric.util.toFixed,c=fabric.util.transformPoint,f=fabric.util.invertTransform,k=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(a,c){c||(c={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(a,c)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,_initStatic:function(a,c){var b=this.requestRenderAllBound;this._objects=[];this._createLowerCanvas(a);this._initOptions(c);this._setImageSmoothing();this.interactive||this._initRetinaScaling();c.overlayImage&&this.setOverlayImage(c.overlayImage,b);c.backgroundImage&&this.setBackgroundImage(c.backgroundImage,b);c.backgroundColor&&this.setBackgroundColor(c.backgroundColor,b);c.overlayColor&&this.setOverlayColor(c.overlayColor,b);this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){this._offset=b(this.lowerCanvasEl);return this},setOverlayImage:function(a,c,b){return this.__setBgOverlayImage("overlayImage",a,c,b)},setBackgroundImage:function(a,c,b){return this.__setBgOverlayImage("backgroundImage",a,c,b)},setOverlayColor:function(a,c){return this.__setBgOverlayColor("overlayColor",a,c)},setBackgroundColor:function(a,c){return this.__setBgOverlayColor("backgroundColor",a,c)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=a.imageSmoothingEnabled||a.webkitImageSmoothingEnabled||a.mozImageSmoothingEnabled||a.msImageSmoothingEnabled||a.oImageSmoothingEnabled;a.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,c,b,f){"string"===typeof c?fabric.util.loadImage(c,function(c){c&&(this[a]=new fabric.Image(c,f));b&&b(c)},this,f&&f.crossOrigin):(f&&c.setOptions(f),this[a]=c,b&&b(c));return this},__setBgOverlayColor:function(a,c,b){this[a]=c;this._initGradient(c,a);this._initPattern(c,a,b);return this},_createCanvasElement:function(){var a=fabric.util.createCanvasElement();if(!a)throw k;a.style||(a.style={});if("undefined"===typeof a.getContext)throw k;return a},_initOptions:function(a){this._setOptions(a);this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=a&&a.getContext?a:fabric.util.getById(a)||this._createCanvasElement();fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,c){return this.setDimensions({width:a},c)},setHeight:function(a,c){return this.setDimensions({height:a},c)},setDimensions:function(a,c){var b;c=c||{};for(var g in a)b=a[g],c.cssOnly||(this._setBackstoreDimension(g,a[g]),b+="px",this.hasLostContext=!0),c.backstoreOnly||this._setCssDimension(g,b);this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles();this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();c.cssOnly||this.requestRenderAll();return this},_setBackstoreDimension:function(a,c){this.lowerCanvasEl[a]=c;this.upperCanvasEl&&(this.upperCanvasEl[a]=c);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=c);this[a]=c;return this},_setCssDimension:function(a,c){this.lowerCanvasEl.style[a]=c;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=c);this.wrapperEl&&(this.wrapperEl.style[a]=c);return this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var c=this._activeObject,b,g;this.viewportTransform=a;b=0;for(g=this._objects.length;b<g;b++)a=this._objects[b],a.group||a.setCoords(!1,!0);c&&"activeSelection"===c.type&&c.setCoords(!1,!0);this.calcViewportBoundaries();this.renderOnAddRemove&&this.requestRenderAll();return this},zoomToPoint:function(a,b){var g=a,e=this.viewportTransform.slice(0);a=c(a,f(this.viewportTransform));e[0]=b;e[3]=b;var h=c(a,e);e[4]+=g.x-h.x;e[5]+=g.y-h.y;return this.setViewportTransform(e)},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(a){var c=this.viewportTransform.slice(0);c[4]=-a.x;c[5]=-a.y;return this.setViewportTransform(c)},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(a){this.stateful&&a.setupState();a._set("canvas",this);a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a});a.fire("removed");delete a.canvas},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.overlayImage=this.backgroundImage=null;this.overlayColor=this.backgroundColor="";this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1);this.clearContext(this.contextContainer);this.fire("canvas:cleared");this.renderOnAddRemove&&this.requestRenderAll();return this},renderAll:function(){this.renderCanvas(this.contextContainer,this._objects);return this},renderAndReset:function(){this.isRendering=0;this.renderAll()},requestRenderAll:function(){this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound));return this},calcViewportBoundaries:function(){var a={},b=this.width,e=this.height,d=f(this.viewportTransform);a.tl=c({x:0,y:0},d);a.br=c({x:b,y:e},d);a.tr=new fabric.Point(a.br.x,a.tl.y);a.bl=new fabric.Point(a.tl.x,a.br.y);return this.vptCoords=a},renderCanvas:function(a,c){var b=this.viewportTransform;this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0);this.calcViewportBoundaries();this.clearContext(a);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,a);this._renderBackground(a);a.save();a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);this._renderObjects(a,c);a.restore();!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.clipTo&&a.restore();this._renderOverlay(a);this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render")},_renderObjects:function(a,c){var b,f;b=0;for(f=c.length;b<f;++b)c[b]&&c[b].render(a)},_renderBackgroundOrOverlay:function(a,c){var b=this[c+"Color"],f;b&&(a.fillStyle=b.toLive?b.toLive(a,this):b,a.fillRect(b.offsetX||0,b.offsetY||0,this.width,this.height));if(b=this[c+"Image"])this[c+"Vpt"]&&(f=this.viewportTransform,a.save(),a.transform(f[0],f[1],f[2],f[3],f[4],f[5])),b.render(a),this[c+"Vpt"]&&a.restore()},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y))},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top))},centerObject:function(a){var c=this.getCenter();return this._centerObject(a,new fabric.Point(c.left,c.top))},viewportCenterObject:function(a){var c=this.getVpCenter();return this._centerObject(a,c)},viewportCenterObjectH:function(a){var c=this.getVpCenter();this._centerObject(a,new fabric.Point(c.x,a.getCenterPoint().y));return this},viewportCenterObjectV:function(a){var c=this.getVpCenter();return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,c.y))},getVpCenter:function(){var a=this.getCenter(),b=f(this.viewportTransform);return c({x:a.left,y:a.top},b)},_centerObject:function(a,c){a.setPositionByOrigin(c,"center","center");a.setCoords();this.renderOnAddRemove&&this.requestRenderAll();return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,c){var b={version:fabric.version,objects:this._toObjects(a,c)};d(b,this.__serializeBgOverlay(a,c));fabric.util.populateWithProperties(this,b,c);return b},_toObjects:function(a,c){return this.getObjects().filter(function(a){return!a.excludeFromExport}).map(function(b){return this._toObject(b,a,c)},this)},_toObject:function(a,c,b){var f;this.includeDefaultValues||(f=a.includeDefaultValues,a.includeDefaultValues=!1);c=a[c](b);this.includeDefaultValues||(a.includeDefaultValues=f);return c},__serializeBgOverlay:function(a,c){var b={},f=this.backgroundImage,g=this.overlayImage;this.backgroundColor&&(b.background=this.backgroundColor.toObject?this.backgroundColor.toObject(c):this.backgroundColor);this.overlayColor&&(b.overlay=this.overlayColor.toObject?this.overlayColor.toObject(c):this.overlayColor);f&&!f.excludeFromExport&&(b.backgroundImage=this._toObject(f,a,c));g&&!g.excludeFromExport&&(b.overlayImage=this._toObject(g,a,c));return b},svgViewportTransformation:!0,toSVG:function(a,c){a||(a={});var b=[];this._setSVGPreamble(b,a);this._setSVGHeader(b,a);this._setSVGBgOverlayColor(b,"backgroundColor");this._setSVGBgOverlayImage(b,"backgroundImage",c);this._setSVGObjects(b,c);this._setSVGBgOverlayColor(b,"overlayColor");this._setSVGBgOverlayImage(b,"overlayImage",c);b.push("\x3c/svg\x3e");return b.join("")},_setSVGPreamble:function(a,c){c.suppressPreamble||a.push('\x3c?xml version\x3d"1.0" encoding\x3d"',c.encoding||"UTF-8",'" standalone\x3d"no" ?\x3e\n','\x3c!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"\x3e\n')},_setSVGHeader:function(c,b){var f=b.width||this.width,g=b.height||this.height,e;e='viewBox\x3d"0 0 '+this.width+" "+this.height+'" ';var d=fabric.Object.NUM_FRACTION_DIGITS;b.viewBox?e='viewBox\x3d"'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':this.svgViewportTransformation&&(e=this.viewportTransform,e='viewBox\x3d"'+a(-e[4]/e[0],d)+" "+a(-e[5]/e[3],d)+" "+a(this.width/e[0],d)+" "+a(this.height/e[3],d)+'" ');c.push("\x3csvg ",'xmlns\x3d"http://www.w3.org/2000/svg" ','xmlns:xlink\x3d"http://www.w3.org/1999/xlink" ','version\x3d"1.1" ','width\x3d"',f,'" ','height\x3d"',g,'" ',e,'xml:space\x3d"preserve"\x3e\n',"\x3cdesc\x3eCreated with Fabric.js ",fabric.version,"\x3c/desc\x3e\n","\x3cdefs\x3e\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),"\x3c/defs\x3e\n")},createSVGRefElementsMarkup:function(){var a=this;return["backgroundColor","overlayColor"].map(function(c){if((c=a[c])&&c.toLive)return c.toSVG(a,!1)}).join("")},createSVGFontFacesMarkup:function(){var a="",c={},b,f,e,d,k,r,t,u=fabric.fontPaths,y=this.getObjects();r=0;for(t=y.length;r<t;r++)if(b=y[r],f=b.fontFamily,-1!==b.type.indexOf("text")&&!c[f]&&u[f]&&(c[f]=!0,b.styles))for(d in b=b.styles,b)for(k in e=b[d],e)f=e[k],f=f.fontFamily,!c[f]&&u[f]&&(c[f]=!0);for(var w in c)a+=["\t\t@font-face {\n\t\t\tfont-family: '",w,"';\n\t\t\tsrc: url('",u[w],"');\n\t\t}\n"].join("");a&&(a=['\t\x3cstyle type\x3d"text/css"\x3e\x3c![CDATA[\n',a,"]]\x3e\x3c/style\x3e\n"].join(""));return a},_setSVGObjects:function(a,c){var b,f,g,e=this.getObjects();f=0;for(g=e.length;f<g;f++)b=e[f],b.excludeFromExport||this._setSVGObject(a,b,c)},_setSVGObject:function(a,c,b){a.push(c.toSVG(b))},_setSVGBgOverlayImage:function(a,c,b){this[c]&&this[c].toSVG&&a.push(this[c].toSVG(b))},_setSVGBgOverlayColor:function(a,c){var b=this[c],f=this.viewportTransform,g=this.width/f[0],f=this.height/f[3];if(b)if(b.toLive){var e=b.repeat;a.push('\x3crect transform\x3d"translate(',g/2,",",f/2,')"',' x\x3d"',b.offsetX-g/2,'" y\x3d"',b.offsetY-f/2,'" ','width\x3d"',"repeat-y"===e||"no-repeat"===e?b.source.width:g,'" height\x3d"',"repeat-x"===e||"no-repeat"===e?b.source.height:f,'" fill\x3d"url(#SVGID_'+b.id+')"',"\x3e\x3c/rect\x3e\n")}else a.push('\x3crect x\x3d"0" y\x3d"0" width\x3d"100%" height\x3d"100%" ','fill\x3d"',this[c],'"',"\x3e\x3c/rect\x3e\n")},sendToBack:function(a){if(!a)return this;var c=this._activeObject,b;if(a===c&&"activeSelection"===a.type)for(b=c._objects,a=b.length;a--;)c=b[a],e(this._objects,c),this._objects.unshift(c);else e(this._objects,a),this._objects.unshift(a);this.renderOnAddRemove&&this.requestRenderAll();return this},bringToFront:function(a){if(!a)return this;var c=this._activeObject,b;if(a===c&&"activeSelection"===a.type)for(b=c._objects,a=0;a<b.length;a++)c=b[a],e(this._objects,c),this._objects.push(c);else e(this._objects,a),this._objects.push(a);this.renderOnAddRemove&&this.requestRenderAll();return this},sendBackwards:function(a,c){if(!a)return this;var b=this._activeObject,f,g,d,h=0;if(a===b&&"activeSelection"===a.type)for(d=b._objects,b=0;b<d.length;b++)f=d[b],g=this._objects.indexOf(f),g>0+h&&(--g,e(this._objects,f),this._objects.splice(g,0,f)),h++;else g=this._objects.indexOf(a),0!==g&&(g=this._findNewLowerIndex(a,g,c),e(this._objects,a),this._objects.splice(g,0,a));this.renderOnAddRemove&&this.requestRenderAll();return this},_findNewLowerIndex:function(a,c,b){if(b)for(b=c,--c;0<=c;--c){if(a.intersectsWithObject(this._objects[c])||a.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(a)){b=c;break}}else b=c-1;return b},bringForward:function(a,c){if(!a)return this;var b=this._activeObject,f,g,d,h=0;if(a===b&&"activeSelection"===a.type)for(d=b._objects,b=d.length;b--;)f=d[b],g=this._objects.indexOf(f),g<this._objects.length-1-h&&(g+=1,e(this._objects,f),this._objects.splice(g,0,f)),h++;else g=this._objects.indexOf(a),g!==this._objects.length-1&&(g=this._findNewUpperIndex(a,g,c),e(this._objects,a),this._objects.splice(g,0,a));this.renderOnAddRemove&&this.requestRenderAll();return this},_findNewUpperIndex:function(a,c,b){var f;if(b)for(b=c,c+=1,f=this._objects.length;c<f;++c){if(a.intersectsWithObject(this._objects[c])||a.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(a)){b=c;break}}else b=c+1;return b},moveTo:function(a,c){e(this._objects,a);this._objects.splice(c,0,a);return this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0);this.forEachObject(function(a){a.dispose&&a.dispose()});this._objects=[];this.contextContainer=this.lowerCanvasEl=this._iTextInstances=this.overlayImage=this.backgroundImage=null;return this},toString:function(){return"#\x3cfabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }\x3e"}});d(fabric.StaticCanvas.prototype,fabric.Observable);d(fabric.StaticCanvas.prototype,fabric.Collection);d(fabric.StaticCanvas.prototype,fabric.DataURLExporter);d(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var c=fabric.util.createCanvasElement();if(!c||!c.getContext)return null;var b=c.getContext("2d");if(!b)return null;switch(a){case "getImageData":return"undefined"!==typeof b.getImageData;case "setLineDash":return"undefined"!==typeof b.setLineDash;case "toDataURL":return"undefined"!==typeof c.toDataURL;case "toDataURLWithQuality":try{return c.toDataURL("image/jpeg",0),!0}catch(m){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject;fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var a=fabric.util.getNodeCanvas(this.lowerCanvasEl);return a&&a.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(a){var c=fabric.util.getNodeCanvas(this.lowerCanvasEl);return c&&c.createJPEGStream(a)})}})();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(d){this.shadow=new fabric.Shadow(d);return this},_setBrushStyles:function(){var d=this.canvas.contextTop;d.strokeStyle=this.color;d.lineWidth=this.width;d.lineCap=this.strokeLineCap;d.miterLimit=this.strokeMiterLimit;d.lineJoin=this.strokeLineJoin;fabric.StaticCanvas.supports("setLineDash")&&d.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(d){var b=this.canvas.viewportTransform;d.save();d.transform(b[0],b[1],b[2],b[3],b[4],b[5])},_setShadow:function(){if(this.shadow){var d=this.canvas.contextTop,b=this.canvas.getZoom();d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur*b;d.shadowOffsetX=this.shadow.offsetX*b;d.shadowOffsetY=this.shadow.offsetY*b}},_resetShadow:function(){var d=this.canvas.contextTop;d.shadowColor="";d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}});(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(d){this.canvas=d;this._points=[]},_drawSegment:function(d,b,e){e=b.midPointFrom(e);d.quadraticCurveTo(b.x,b.y,e.x,e.y);return e},onMouseDown:function(d){this._prepareForDrawing(d);this._captureDrawingPath(d);this._render()},onMouseMove:function(d){if(this._captureDrawingPath(d)&&1<this._points.length)if(this.needsFullRender)this.canvas.clearContext(this.canvas.contextTop),this._render();else{d=this._points;var b=d.length,e=this.canvas.contextTop;this._saveAndTransform(e);this.oldEnd&&(e.beginPath(),e.moveTo(this.oldEnd.x,this.oldEnd.y));this.oldEnd=this._drawSegment(e,d[b-2],d[b-1],!0);e.stroke();e.restore()}},onMouseUp:function(){this.oldEnd=void 0;this._finalizeAndAddPath()},_prepareForDrawing:function(d){d=new fabric.Point(d.x,d.y);this._reset();this._addPoint(d);this.canvas.contextTop.moveTo(d.x,d.y)},_addPoint:function(d){if(1<this._points.length&&d.eq(this._points[this._points.length-1]))return!1;this._points.push(d);return!0},_reset:function(){this._points.length=0;this._setBrushStyles();this.needsFullRender=1>(new fabric.Color(this.color)).getAlpha();this._setShadow()},_captureDrawingPath:function(d){d=new fabric.Point(d.x,d.y);return this._addPoint(d)},_render:function(){var d=this.canvas.contextTop,b,e,a=this._points[0],c=this._points[1];this._saveAndTransform(d);d.beginPath();2===this._points.length&&a.x===c.x&&a.y===c.y&&(b=this.width/1E3,a=new fabric.Point(a.x,a.y),c=new fabric.Point(c.x,c.y),a.x-=b,c.x+=b);d.moveTo(a.x,a.y);b=1;for(e=this._points.length;b<e;b++)this._drawSegment(d,a,c),a=this._points[b],c=this._points[b+1];d.lineTo(a.x,a.y);d.stroke();d.restore()},convertPointsToSVGPath:function(d){var b=[],e,a=this.width/1E3,c=new fabric.Point(d[0].x,d[0].y),f=new fabric.Point(d[1].x,d[1].y),k=d.length,g=1,h=1,l=2<k;l&&(g=d[2].x<f.x?-1:d[2].x===f.x?0:1,h=d[2].y<f.y?-1:d[2].y===f.y?0:1);b.push("M ",c.x-g*a," ",c.y-h*a," ");for(e=1;e<k;e++){if(!c.eq(f)){var m=c.midPointFrom(f);b.push("Q ",c.x," ",c.y," ",m.x," ",m.y," ")}c=d[e];e+1<d.length&&(f=d[e+1])}l&&(g=c.x>d[e-2].x?1:c.x===d[e-2].x?0:-1,h=c.y>d[e-2].y?1:c.y===d[e-2].y?0:-1);b.push("L ",c.x+g*a," ",c.y+h*a);return b},createPath:function(d){d=new fabric.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});var b=new fabric.Point(d.left+d.width/2,d.top+d.height/2),b=d.translateToGivenOrigin(b,"center","center",d.originX,d.originY);d.top=b.y;d.left=b.x;this.shadow&&(this.shadow.affectStroke=!0,d.setShadow(this.shadow));return d},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var d=this.convertPointsToSVGPath(this._points).join("");"M 0 0 Q 0 0 0 0 L 0 0"===d?this.canvas.requestRenderAll():(d=this.createPath(d),this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(d),this.canvas.renderAll(),d.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:d}))}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(d){this.canvas=d;this.points=[]},drawDot:function(d){d=this.addPoint(d);var b=this.canvas.contextTop;this._saveAndTransform(b);b.fillStyle=d.fill;b.beginPath();b.arc(d.x,d.y,d.radius,0,2*Math.PI,!1);b.closePath();b.fill();b.restore()},onMouseDown:function(d){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(d)},_render:function(){var d=this.canvas.contextTop,b,e,a=this.points,c;this._saveAndTransform(d);b=0;for(e=a.length;b<e;b++)c=a[b],d.fillStyle=c.fill,d.beginPath(),d.arc(c.x,c.y,c.radius,0,2*Math.PI,!1),d.closePath(),d.fill();d.restore()},onMouseMove:function(d){this.drawDot(d)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove,b,e;this.canvas.renderOnAddRemove=!1;var a=[];b=0;for(e=this.points.length;b<e;b++){var c=this.points[b],c=new fabric.Circle({radius:c.radius,left:c.x,top:c.y,originX:"center",originY:"center",fill:c.fill});this.shadow&&c.setShadow(this.shadow);a.push(c)}b=new fabric.Group(a,{originX:"center",originY:"center"});b.canvas=this.canvas;this.canvas.add(b);this.canvas.fire("path:created",{path:b});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.requestRenderAll()},addPoint:function(d){d=new fabric.Point(d.x,d.y);var b=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,e=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();d.radius=b;d.fill=e;this.points.push(d);return d}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d;this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(d);this.render(this.sprayChunkPoints)},onMouseMove:function(d){this.addSprayChunk(d);this.render(this.sprayChunkPoints)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],e=0,a=this.sprayChunks.length;e<a;e++)for(var c=this.sprayChunks[e],f=0,k=c.length;f<k;f++){var g=new fabric.Rect({width:c[f].width,height:c[f].width,left:c[f].x+1,top:c[f].y+1,originX:"center",originY:"center",fill:this.color});b.push(g)}this.optimizeOverlapping&&(b=this._getOptimizedRects(b));b=new fabric.Group(b,{originX:"center",originY:"center"});this.shadow&&b.setShadow(this.shadow);this.canvas.add(b);this.canvas.fire("path:created",{path:b});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.requestRenderAll()},_getOptimizedRects:function(d){var b={},e,a,c;a=0;for(c=d.length;a<c;a++)e=d[a].left+""+d[a].top,b[e]||(b[e]=d[a]);d=[];for(e in b)d.push(b[e]);return d},render:function(d){var b=this.canvas.contextTop,e,a;b.fillStyle=this.color;this._saveAndTransform(b);e=0;for(a=d.length;e<a;e++){var c=d[e];"undefined"!==typeof c.opacity&&(b.globalAlpha=c.opacity);b.fillRect(c.x,c.y,c.width,c.width)}b.restore()},_render:function(){var d=this.canvas.contextTop,b,e;d.fillStyle=this.color;this._saveAndTransform(d);b=0;for(e=this.sprayChunks.length;b<e;b++)this.render(this.sprayChunks[b]);d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];var b,e,a,c=this.width/2,f;for(f=0;f<this.density;f++)b=fabric.util.getRandomInt(d.x-c,d.x+c),e=fabric.util.getRandomInt(d.y-c,d.y+c),a=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,b=new fabric.Point(b,e),b.width=a,this.randomOpacity&&(b.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(b);this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=fabric.document.createElement("canvas"),b=d.getContext("2d");d.width=d.height=25;b.fillStyle=this.color;b.beginPath();b.arc(10,10,10,0,2*Math.PI,!1);b.closePath();b.fill();return d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(d){d=this.callSuper("createPath",d);var b=d._getLeftTopCoords().scalarAdd(d.strokeWidth/2);d.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-b.x,offsetY:-b.y});return d}});(function(){var d=fabric.util.getPointer,b=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees,a=Math.atan2,c=Math.abs,f=fabric.StaticCanvas.supports("setLineDash");fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,c){c||(c={});this.renderAndResetBound=this.renderAndReset.bind(this);this._initStatic(a,c);this._initInteractive();this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_chooseObjectsToRender:function(){var a=this.getActiveObjects(),c,b,f;if(0<a.length&&!this.preserveObjectStacking){b=[];f=[];for(var e=0,d=this._objects.length;e<d;e++)c=this._objects[e],-1===a.indexOf(c)?b.push(c):f.push(c);1<a.length&&(this._activeObject._objects=f);b.push.apply(b,f)}else b=this._objects;return b},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);this.hasLostContext&&this.renderTopLayer(this.contextTop);this.renderCanvas(this.contextContainer,this._chooseObjectsToRender());return this},renderTopLayer:function(a){this.isDrawingMode&&this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._render();this.selection&&this._groupSelector&&this._drawSelection(a)},renderTop:function(){var a=this.contextTop;this.clearContext(a);this.renderTopLayer(a);this.fire("after:render");this.contextTopDirty=!0;return this},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top});this._shouldCenterTransform(a.target)?("center"!==a.originX&&(a.mouseXSign="right"===a.originX?-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,c,b){a=b||this.getPointer(a,!0);b=c.group&&c.group===this._activeObject&&"activeSelection"===c.group.type?this._normalizePointer(c.group,a):{x:a.x,y:a.y};return c.containsPoint(b)||c._findTargetCorner(a)},_normalizePointer:function(a,c){var b=a.calcTransformMatrix(),b=fabric.util.invertTransform(b),f=this.restorePointerVpt(c);return fabric.util.transformPoint(f,b)},isTargetTransparent:function(a,c,b){if(a.shouldCache()&&a._cacheCanvas)return c=this._normalizePointer(a,{x:c,y:b}),a=fabric.util.isTransparent(a._cacheContext,a.cacheTranslationX+c.x*a.zoomX,a.cacheTranslationY+c.y*a.zoomY,this.targetFindTolerance);var f=this.contextCache,g=a.selectionBackgroundColor,e=this.viewportTransform;a.selectionBackgroundColor="";this.clearContext(f);f.save();f.transform(e[0],e[1],e[2],e[3],e[4],e[5]);a.render(f);f.restore();a===this._activeObject&&a._renderControls(f,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1});a.selectionBackgroundColor=g;return a=fabric.util.isTransparent(f,c,b,this.targetFindTolerance)},_isSelectionKeyPressed:function(a){var c=!1;return c="[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(c){return!0===a[c]}):a[this.selectionKey]},_shouldClearSelection:function(a,c){var b=this.getActiveObjects(),f=this._activeObject;return!c||c&&f&&1<b.length&&-1===b.indexOf(c)&&f!==c&&!this._isSelectionKeyPressed(a)||c&&!c.evented||c&&!c.selectable&&f&&f!==c},_shouldCenterTransform:function(a){if(a){var c=this._currentTransform,b;"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?b=this.centeredScaling||a.centeredScaling:"rotate"===c.action&&(b=this.centeredRotation||a.centeredRotation);return b?!c.altKey:c.altKey}},_getOriginFromCorner:function(a,c){var b={x:a.originX,y:a.originY};if("ml"===c||"tl"===c||"bl"===c)b.x="right";else if("mr"===c||"tr"===c||"br"===c)b.x="left";if("tl"===c||"mt"===c||"tr"===c)b.y="bottom";else if("bl"===c||"mb"===c||"br"===c)b.y="top";return b},_getActionFromCorner:function(a,c,b){if(!c)return"drag";switch(c){case "mtr":return"rotate";case "ml":case "mr":return b[this.altActionKey]?"skewY":"scaleX";case "mt":case "mb":return b[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,c){if(c){var f=this.getPointer(a),g=c._findTargetCorner(this.getPointer(a,!0)),e=this._getActionFromCorner(c,g,a),d=this._getOriginFromCorner(c,g);this._currentTransform={target:c,action:e,corner:g,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:f.x-c.left,offsetY:f.y-c.top,originX:d.x,originY:d.y,ex:f.x,ey:f.y,lastX:f.x,lastY:f.y,theta:b(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a[this.centeredKey]};this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,originX:d.x,originY:d.y};this._resetCurrentTransform();this._beforeTransform(a)}},_translateObject:function(a,c){var b=this._currentTransform,f=b.target,g=a-b.offsetX,b=c-b.offsetY,e=!f.get("lockMovementX")&&f.left!==g,d=!f.get("lockMovementY")&&f.top!==b;e&&f.set("left",g);d&&f.set("top",b);return e||d},_changeSkewTransformOrigin:function(a,c,b){var f="originX",g={0:"center"},e=c.target.skewX,d="left",k="right",h="mt"===c.corner||"ml"===c.corner?1:-1,l=1;a=0<a?1:-1;"y"===b&&(e=c.target.skewY,d="top",k="bottom",f="originY");g[-1]=d;g[1]=k;c.target.flipX&&(l*=-1);c.target.flipY&&(l*=-1);0===e?(c.skewSign=-h*a*l,c[f]=g[-a]):(e=0<e?1:-1,c.skewSign=e,c[f]=g[e*h*l])},_skewObject:function(a,c,b){var f=this._currentTransform,g=f.target,e=g.get("lockSkewingX"),d=g.get("lockSkewingY");if(e&&"x"===b||d&&"y"===b)return!1;var d=g.getCenterPoint(),k=g.toLocalPoint(new fabric.Point(a,c),"center","center")[b],h=g.toLocalPoint(new fabric.Point(f.lastX,f.lastY),"center","center")[b],e=g._getTransformedDimensions();this._changeSkewTransformOrigin(k-h,f,b);k=g.toLocalPoint(new fabric.Point(a,c),f.originX,f.originY)[b];d=g.translateToOriginPoint(d,f.originX,f.originY);b=this._setObjectSkew(k,f,b,e);f.lastX=a;f.lastY=c;g.setPositionByOrigin(d,f.originX,f.originY);return b},_setObjectSkew:function(a,c,b,f){var g=c.target,e=c.skewSign,d,k,h,m;"x"===b?(c="y",h="Y",d="X",k=0,m=g.skewY):(c="x",h="X",d="Y",k=g.skewX,m=0);k=g._getTransformedDimensions(k,m);a=2*Math.abs(a)-k[b];2>=a?b=0:(b=e*Math.atan(a/g["scale"+d]/(k[c]/g["scale"+h])),b=fabric.util.radiansToDegrees(b));a=g["skew"+d]!==b;g.set("skew"+d,b);0!==g["skew"+h]&&(d=g._getTransformedDimensions(),b=f[c]/d[c]*g["scale"+h],g.set("scale"+h,b));return a},_scaleObject:function(a,c,b){var f=this._currentTransform,g=f.target,e=g.lockScalingX,d=g.lockScalingY,k=g.lockScalingFlip;if(e&&d)return!1;var h=g.translateToOriginPoint(g.getCenterPoint(),f.originX,f.originY);a=g.toLocalPoint(new fabric.Point(a,c),f.originX,f.originY);c=g._getTransformedDimensions();this._setLocalMouse(a,f);b=this._setObjectScale(a,f,e,d,b,k,c);g.setPositionByOrigin(h,f.originX,f.originY);return b},_setObjectScale:function(a,c,b,f,e,d,k){var g=c.target,h=!1,m=!1,l=!1,n,p,q,v;q=a.x*g.scaleX/k.x;v=a.y*g.scaleY/k.y;n=g.scaleX!==q;p=g.scaleY!==v;d&&0>=q&&q<g.scaleX&&(h=!0,a.x=0);d&&0>=v&&v<g.scaleY&&(m=!0,a.y=0);"equally"!==e||b||f?e?"x"!==e||g.get("lockUniScaling")?"y"!==e||g.get("lockUniScaling")||m||f||g.set("scaleY",v)&&(l=l||p):h||b||g.set("scaleX",q)&&(l=l||n):(h||b||g.set("scaleX",q)&&(l=l||n),m||f||g.set("scaleY",v)&&(l=l||p)):l=this._scaleObjectEqually(a,g,c,k);c.newScaleX=q;c.newScaleY=v;h||m||this._flipObject(c,e);return l},_scaleObjectEqually:function(a,c,b,f){var g=a.y+a.x;f=f.y*b.original.scaleY/c.scaleY+f.x*b.original.scaleX/c.scaleX;var e=0>a.y?-1:1;b.newScaleX=(0>a.x?-1:1)*Math.abs(b.original.scaleX*g/f);b.newScaleY=e*Math.abs(b.original.scaleY*g/f);a=b.newScaleX!==c.scaleX||b.newScaleY!==c.scaleY;c.set("scaleX",b.newScaleX);c.set("scaleY",b.newScaleY);return a},_flipObject:function(a,c){0>a.newScaleX&&"y"!==c&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&"x"!==c&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var f=b.target,e=this.getZoom(),f=f.padding/e;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x=2*a.x*b.mouseXSign,0>a.x&&(b.mouseXSign=-b.mouseXSign));"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y=2*a.y*b.mouseYSign,0>a.y&&(b.mouseYSign=-b.mouseYSign));c(a.x)>f?a.x=0>a.x?a.x+f:a.x-f:a.x=0;c(a.y)>f?a.y=0>a.y?a.y+f:a.y-f:a.y=0},_rotateObject:function(c,b){var f=this._currentTransform,g=f.target,d;d=g.translateToOriginPoint(g.getCenterPoint(),f.originX,f.originY);if(g.lockRotation)return!1;var k=a(f.ey-d.y,f.ex-d.x),h=a(b-d.y,c-d.x),k=e(h-k+f.theta),h=!0;if(0<g.snapAngle){var r=g.snapAngle,t=g.snapThreshold||r,u=Math.ceil(k/r)*r,r=Math.floor(k/r)*r;Math.abs(k-r)<t?k=r:Math.abs(k-u)<t&&(k=u)}0>k&&(k=360+k);k%=360;g.angle===k?h=!1:(g.angle=k,g.setPositionByOrigin(d,f.originX,f.originY));return h},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.skewX=0;a.skewY=0;a.rotate(0)},_drawSelection:function(a){var b=this._groupSelector,e=b.left,g=b.top,d=c(e),k=c(g);this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(0<e?0:-e),b.ey-(0<g?0:-g),d,k));this.selectionLineWidth&&this.selectionBorderColor&&(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!f?(e=b.ex+.5-(0<e?0:d),b=b.ey+.5-(0<g?0:k),a.beginPath(),fabric.util.drawDashedLine(a,e,b,e+d,b,this.selectionDashArray),fabric.util.drawDashedLine(a,e,b+k-1,e+d,b+k-1,this.selectionDashArray),fabric.util.drawDashedLine(a,e,b,e,b+k,this.selectionDashArray),fabric.util.drawDashedLine(a,e+d-1,b,e+d-1,b+k,this.selectionDashArray),a.closePath(),a.stroke()):(fabric.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(b.ex+.5-(0<e?0:d),b.ey+.5-(0<g?0:k),d,k)))},findTarget:function(a,c){if(!this.skipTargetFind){var b=this.getPointer(a,!0),f=this._activeObject,e=this.getActiveObjects(),g,d;this.targets=[];if(1<e.length&&!c&&f===this._searchPossibleTargets([f],b)||1===e.length&&f._findTargetCorner(b))return f;if(1===e.length&&f===this._searchPossibleTargets([f],b))if(this.preserveObjectStacking)g=f,d=this.targets,this.targets=[];else return f;b=this._searchPossibleTargets(this._objects,b);a[this.altSelectionKey]&&b&&g&&b!==g&&(b=g,this.targets=d);return b}},_checkTarget:function(a,c){if(c&&c.visible&&c.evented&&this.containsPoint(null,c,a)&&(!this.perPixelTargetFind&&!c.perPixelTargetFind||c.isEditing||!this.isTargetTransparent(c,a.x,a.y)))return!0},_searchPossibleTargets:function(a,c){for(var b,f=a.length;f--;)if(this._checkTarget(c,a[f])){b=a[f];b.subTargetCheck&&b instanceof fabric.Group&&(f=this._normalizePointer(b,c),(f=this._searchPossibleTargets(b._objects,f))&&this.targets.push(f));break}return b},restorePointerVpt:function(a){return fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(a,c){var b,f;if(this._absolutePointer&&!c)return this._absolutePointer;if(this._pointer&&c)return this._pointer;var e=d(a);f=this.upperCanvasEl;b=f.getBoundingClientRect();var g=b.width||0,k=b.height||0;g&&k||("top"in b&&"bottom"in b&&(k=Math.abs(b.top-b.bottom)),"right"in b&&"left"in b&&(g=Math.abs(b.right-b.left)));this.calcOffset();e.x-=this._offset.left;e.y-=this._offset.top;c||(e=this.restorePointerVpt(e));0===g||0===k?f=b=1:(b=f.width/g,f=f.height/k);return{x:e.x*b,y:e.y*f}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var c=this.width||a.width,b=this.height||a.height;fabric.util.setStyle(a,{position:"absolute",width:c+"px",height:b+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none"});a.width=c;a.height=b;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,c){c.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var a=this._activeObject;return a?"activeSelection"===a.type&&a._objects?a._objects.slice(0):[a]:[]},_onObjectRemoved:function(a){a===this._activeObject&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected"));this._hoveredTarget===a&&(this._hoveredTarget=null);this.callSuper("_onObjectRemoved",a)},_fireSelectionEvents:function(a,c){var b=!1,f=this.getActiveObjects(),e=[],g=[],d={e:c};a.forEach(function(a){-1===f.indexOf(a)&&(b=!0,a.fire("deselected",d),g.push(a))});f.forEach(function(c){-1===a.indexOf(c)&&(b=!0,c.fire("selected",d),e.push(c))});0<a.length&&0<f.length?(d.selected=e,d.deselected=g,d.updated=e[0]||g[0],d.target=this._activeObject,b&&this.fire("selection:updated",d)):0<f.length?(1===f.length&&(d.target=e[0],this.fire("object:selected",d)),d.selected=e,d.target=this._activeObject,this.fire("selection:created",d)):0<a.length&&(d.deselected=g,this.fire("selection:cleared",d))},setActiveObject:function(a,c){var b=this.getActiveObjects();this._setActiveObject(a,c);this._fireSelectionEvents(b,c);return this},_setActiveObject:function(a,c){if(this._activeObject===a||!this._discardActiveObject(c,a)||a.onSelect({e:c}))return!1;this._activeObject=a;return!0},_discardActiveObject:function(a,c){var b=this._activeObject;if(b){if(b.onDeselect({e:a,object:c}))return!1;this._activeObject=null}return!0},discardActiveObject:function(a){var c=this.getActiveObjects();c.length&&this.fire("before:selection:cleared",{target:c[0],e:a});this._discardActiveObject(a);this._fireSelectionEvents(c,a);return this},dispose:function(){var a=this.wrapperEl;this.removeListeners();a.removeChild(this.upperCanvasEl);a.removeChild(this.lowerCanvasEl);this.contextTop=this.contextCache=this.cacheCanvasEl=this.upperCanvasEl=null;a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl);delete this.wrapperEl;fabric.StaticCanvas.prototype.dispose.call(this);return this},clear:function(){this.discardActiveObject();this.clearContext(this.contextTop);return this.callSuper("clear")},drawControls:function(a){var c=this._activeObject;c&&c._renderControls(a)},_toObject:function(a,c,b){var f=this._realizeGroupTransformOnObject(a);c=this.callSuper("_toObject",a,c,b);this._unwindGroupTransformOnObject(a,f);return c},_realizeGroupTransformOnObject:function(a){if(a.group&&"activeSelection"===a.group.type&&this._activeObject===a.group){var c={};"angle flipX flipY left scaleX scaleY skewX skewY top".split(" ").forEach(function(b){c[b]=a[b]});this._activeObject.realizeTransform(a);return c}return null},_unwindGroupTransformOnObject:function(a,c){c&&a.set(c)},_setSVGObject:function(a,c,b){var f=this._realizeGroupTransformOnObject(c);this.callSuper("_setSVGObject",a,c,b);this._unwindGroupTransformOnObject(c,f)}});for(var k in fabric.StaticCanvas)"prototype"!==k&&(fabric.Canvas[k]=fabric.StaticCanvas[k]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})})();(function(){function d(a,c){return"which"in a?a.which===c:a.button===c-1}var b={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,a=fabric.util.removeListener,c={passive:!1};fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this.removeListeners();this._bindEvents();e(fabric.window,"resize",this._onResize);e(this.upperCanvasEl,"mousedown",this._onMouseDown);e(this.upperCanvasEl,"dblclick",this._onDoubleClick);e(this.upperCanvasEl,"mousemove",this._onMouseMove,c);e(this.upperCanvasEl,"mouseout",this._onMouseOut);e(this.upperCanvasEl,"mouseenter",this._onMouseEnter);e(this.upperCanvasEl,"wheel",this._onMouseWheel);e(this.upperCanvasEl,"contextmenu",this._onContextMenu);e(this.upperCanvasEl,"dragover",this._onDragOver);e(this.upperCanvasEl,"dragenter",this._onDragEnter);e(this.upperCanvasEl,"dragleave",this._onDragLeave);e(this.upperCanvasEl,"drop",this._onDrop);e(this.upperCanvasEl,"touchstart",this._onMouseDown,c);e(this.upperCanvasEl,"touchmove",this._onMouseMove,c);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},removeListeners:function(){a(fabric.window,"resize",this._onResize);a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"mouseout",this._onMouseOut);a(this.upperCanvasEl,"mouseenter",this._onMouseEnter);a(this.upperCanvasEl,"wheel",this._onMouseWheel);a(this.upperCanvasEl,"contextmenu",this._onContextMenu);a(this.upperCanvasEl,"doubleclick",this._onDoubleClick);a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);a(this.upperCanvasEl,"dragover",this._onDragOver);a(this.upperCanvasEl,"dragenter",this._onDragEnter);a(this.upperCanvasEl,"dragleave",this._onDragLeave);a(this.upperCanvasEl,"drop",this._onDrop);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,c){this.__onTransformGesture&&this.__onTransformGesture(a,c)},_onDrag:function(a,c){this.__onDrag&&this.__onDrag(a,c)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var c=this._hoveredTarget;this.fire("mouse:out",{target:c,e:a});this._hoveredTarget=null;c&&c.fire("mouseout",{e:a});this._iTextInstances&&this._iTextInstances.forEach(function(a){a.isEditing&&a.hiddenTextarea.focus()})},_onMouseEnter:function(a){this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null)},_onOrientationChange:function(a,c){this.__onOrientationChange&&this.__onOrientationChange(a,c)},_onShake:function(a,c){this.__onShake&&this.__onShake(a,c)},_onLongPress:function(a,c){this.__onLongPress&&this.__onLongPress(a,c)},_onDragOver:function(a){a.preventDefault();var c=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(c,a)},_onContextMenu:function(a){this.stopContextMenu&&(a.stopPropagation(),a.preventDefault());return!1},_onDoubleClick:function(a){this._cacheTransformEventData(a);this._handleEvent(a,"dblclick");this._resetTransformEventData(a)},_onMouseDown:function(b){this.__onMouseDown(b);this._resetTransformEventData();e(fabric.document,"touchend",this._onMouseUp,c);e(fabric.document,"touchmove",this._onMouseMove,c);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===b.type?a(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(fabric.document,"mouseup",this._onMouseUp),e(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(b){this.__onMouseUp(b);this._resetTransformEventData();a(fabric.document,"mouseup",this._onMouseUp);a(fabric.document,"touchend",this._onMouseUp,c);a(fabric.document,"mousemove",this._onMouseMove);a(fabric.document,"touchmove",this._onMouseMove);e(this.upperCanvasEl,"mousemove",this._onMouseMove,c);e(this.upperCanvasEl,"touchmove",this._onMouseMove,c);if("touchend"===b.type){var f=this;setTimeout(function(){e(f.upperCanvasEl,"mousedown",f._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,c){var b=this._activeObject;return b&&b.isEditing&&a===b?!1:!!(a&&(a.isMoving||a!==b)||!a&&b||!a&&!b&&!this._groupSelector||c&&this._previousPointer&&this.selection&&(c.x!==this._previousPointer.x||c.y!==this._previousPointer.y))},__onMouseUp:function(a){var c,b=this._currentTransform;c=this._groupSelector;var f=!c||0===c.left&&0===c.top;this._cacheTransformEventData(a);c=this._target;this._handleEvent(a,"up:before");d(a,3)?this.fireRightClick&&this._handleEvent(a,"up",3,f):d(a,2)?(this.fireMiddleClick&&this._handleEvent(a,"up",2,f),this._resetTransformEventData()):this.isDrawingMode&&this._isCurrentlyDrawing?this._onMouseUpInDrawingMode(a):(b&&this._finalizeCurrentTransform(a),b=this._shouldRender(c,this._absolutePointer),!c&&f||this._maybeGroupObjects(a),c&&(c.isMoving=!1),this._setCursorFromEvent(a,c),this._handleEvent(a,"up",1,f),this._currentTransform=this._groupSelector=null,c&&(c.__corner=0),b&&this.requestRenderAll())},_simpleEventHandler:function(a,c){var b=this.findTarget(c),f=this.targets,e={e:c,target:b,subTargets:f};this.fire(a,e);b&&b.fire(a,e);if(!f)return b;for(var d=0;d<f.length;d++)f[d].fire(a,e);return b},_handleEvent:function(a,c,b,e){var f=this._target,g=this.targets||[];a={e:a,target:f,subTargets:g,button:b||1,isClick:e||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+c,a);f&&f.fire("mouse"+c,a);for(f=0;f<g.length;f++)g[f].fire("mouse"+c,a)},_finalizeCurrentTransform:function(a){var c=this._currentTransform,b=c.target;a={e:a,target:b,transform:c};b._scaling&&(b._scaling=!1);b.setCoords();if(c.actionPerformed||this.stateful&&b.hasStateChanged())c.actionPerformed&&(c=this._addEventOptions(a,c),this._fire(c,a)),this._fire("modified",a)},_addEventOptions:function(a,c){var b,f;switch(c.action){case "scaleX":b="scaled";f="x";break;case "scaleY":b="scaled";f="y";break;case "skewX":b="skewed";f="x";break;case "skewY":b="skewed";f="y";break;case "scale":b="scaled";f="equally";break;case "rotate":b="rotated";break;case "drag":b="moved"}a.by=f;return b},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);var c=this.getPointer(a);this.freeDrawingBrush.onMouseDown(c);this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var c=this.getPointer(a);this.freeDrawingBrush.onMouseMove(c)}this.setCursor(this.freeDrawingCursor);this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a);this._handleEvent(a,"down:before");var c=this._target;if(d(a,3))this.fireRightClick&&this._handleEvent(a,"down",3);else if(d(a,2))this.fireMiddleClick&&this._handleEvent(a,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var b=this._pointer;this._previousPointer=b;var f=this._shouldRender(c,b),e=this._shouldGroup(a,c);this._shouldClearSelection(a,c)?this.discardActiveObject(a):e&&(this._handleGrouping(a,c),c=this._activeObject);!this.selection||c&&(c.selectable||c.isEditing||c===this._activeObject)||(this._groupSelector={ex:b.x,ey:b.y,top:0,left:0});c&&(c.selectable&&this.setActiveObject(c,a),c!==this._activeObject||!c.__corner&&e||this._setupCurrentTransform(a,c));this._handleEvent(a,"down");f&&this.requestRenderAll()}},_resetTransformEventData:function(){this._absolutePointer=this._pointer=this._target=null},_cacheTransformEventData:function(a){this._resetTransformEventData();this._pointer=this.getPointer(a,!0);this._absolutePointer=this.restorePointerVpt(this._pointer);this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var c=this._currentTransform;this.stateful&&c.target.saveState();this.fire("before:transform",{e:a,transform:c});if(c.corner)this.onBeforeScaleRotate(c.target)},__onMouseMove:function(a){this._handleEvent(a,"move:before");this._cacheTransformEventData(a);var c;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(!("undefined"!==typeof a.touches&&1<a.touches.length)){var b=this._groupSelector;b?(c=this._pointer,b.left=c.x-b.ex,b.top=c.y-b.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(c=this.findTarget(a)||null,this._setCursorFromEvent(a,c),this._fireOverOutEvents(c,a));this._handleEvent(a,"move");this._resetTransformEventData()}},_fireOverOutEvents:function(a,c){this.fireSynteticInOutEvents(a,c,{targetName:"_hoveredTarget",canvasEvtOut:"mouse:out",evtOut:"mouseout",canvasEvtIn:"mouse:over",evtIn:"mouseover"})},_fireEnterLeaveEvents:function(a,c){this.fireSynteticInOutEvents(a,c,{targetName:"_draggedoverTarget",evtOut:"dragleave",evtIn:"dragenter"})},fireSynteticInOutEvents:function(a,c,b){var f,e,g=this[b.targetName],d=g!==a,k=b.canvasEvtIn,q=b.canvasEvtOut;d&&(f={e:c,target:a,previousTarget:g},e={e:c,target:g,nextTarget:a},this[b.targetName]=a);c=a&&d;g&&d&&(q&&this.fire(q,e),g.fire(b.evtOut,e));c&&(k&&this.fire(k,f),a.fire(b.evtIn,f))},__onMouseWheel:function(a){this._cacheTransformEventData(a);this._handleEvent(a,"wheel");this._resetTransformEventData()},_transformObject:function(a){var c=this.getPointer(a),b=this._currentTransform;b.reset=!1;b.target.isMoving=!0;b.shiftKey=a.shiftKey;b.altKey=a[this.centeredKey];this._beforeScaleTransform(a,b);this._performTransformAction(a,b,c);b.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,c,b){var f=b.x,e=b.y,g=c.action;b={target:c.target,e:a,transform:c,pointer:b};if("rotate"===g)(a=this._rotateObject(f,e))&&this._fire("rotating",b);else if("scale"===g)(a=this._onScale(a,c,f,e))&&this._fire("scaling",b);else if("scaleX"===g)(a=this._scaleObject(f,e,"x"))&&this._fire("scaling",b);else if("scaleY"===g)(a=this._scaleObject(f,e,"y"))&&this._fire("scaling",b);else if("skewX"===g)(a=this._skewObject(f,e,"x"))&&this._fire("skewing",b);else if("skewY"===g)(a=this._skewObject(f,e,"y"))&&this._fire("skewing",b);else if(a=this._translateObject(f,e))this._fire("moving",b),this.setCursor(b.target.moveCursor||this.moveCursor);c.actionPerformed=c.actionPerformed||a},_fire:function(a,c){this.fire("object:"+a,c);c.target.fire(a,c)},_beforeScaleTransform:function(a,c){if("scale"===c.action||"scaleX"===c.action||"scaleY"===c.action){var b=this._shouldCenterTransform(c.target);if(b&&("center"!==c.originX||"center"!==c.originY)||!b&&"center"===c.originX&&"center"===c.originY)this._resetCurrentTransform(),c.reset=!0}},_onScale:function(a,c,b,e){if(this._isUniscalePossible(a,c.target))return c.currentAction="scale",this._scaleObject(b,e);c.reset||"scale"!==c.currentAction||this._resetCurrentTransform();c.currentAction="scaleEqually";return this._scaleObject(b,e,"equally")},_isUniscalePossible:function(a,c){return(a[this.uniScaleKey]||this.uniScaleTransform)&&!c.get("lockUniScaling")},_setCursorFromEvent:function(a,c){if(!c)return this.setCursor(this.defaultCursor),!1;var b=c.hoverCursor||this.hoverCursor,f=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null;(f=(!f||!f.contains(c))&&c._findTargetCorner(this.getPointer(a,!0)))?this.setCursor(this.getCornerCursor(f,c,a)):this.setCursor(b)},getCornerCursor:function(a,c,e){return this.actionIsDisabled(a,c,e)?this.notAllowedCursor:a in b?this._getRotatedCornerCursor(a,c,e):"mtr"===a&&c.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(a,c,b){return"mt"===a||"mb"===a?b[this.altActionKey]?c.lockSkewingX:c.lockScalingY:"ml"===a||"mr"===a?b[this.altActionKey]?c.lockSkewingY:c.lockScalingX:"mtr"===a?c.lockRotation:this._isUniscalePossible(b,c)?c.lockScalingX&&c.lockScalingY:c.lockScalingX||c.lockScalingY},_getRotatedCornerCursor:function(a,c,e){c=Math.round(c.angle%360/45);0>c&&(c+=8);c+=b[a];e[this.altActionKey]&&0===b[a]%2&&(c+=2);return this.cursorMap[c%8]}})})();(function(){var d=Math.min,b=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(b,a){var c=this._activeObject;return c&&this._isSelectionKeyPressed(b)&&a&&a.selectable&&this.selection&&(c!==a||"activeSelection"===c.type)},_handleGrouping:function(b,a){var c=this._activeObject;if(!c.__corner){if(a===c&&(a=this.findTarget(b,!0),!a))return;c&&"activeSelection"===c.type?this._updateActiveSelection(a,b):this._createActiveSelection(a,b)}},_updateActiveSelection:function(b,a){var c=this._activeObject,f=c._objects.slice(0);c.contains(b)?(c.removeWithUpdate(b),this._hoveredTarget=b,1===c.size()&&this._setActiveObject(c.item(0),a)):(c.addWithUpdate(b),this._hoveredTarget=c);this._fireSelectionEvents(f,a)},_createActiveSelection:function(b,a){var c=this.getActiveObjects(),f=this._createGroup(b);this._hoveredTarget=f;this._setActiveObject(f,a);this._fireSelectionEvents(c,a)},_createGroup:function(b){var a=this.getObjects();b=a.indexOf(this._activeObject)<a.indexOf(b)?[this._activeObject,b]:[b,this._activeObject];this._activeObject.isEditing&&this._activeObject.exitEditing();return new fabric.ActiveSelection(b,{canvas:this})},_groupSelectedObjects:function(b){var a=this._collectObjects();1===a.length?this.setActiveObject(a[0],b):1<a.length&&(a=new fabric.ActiveSelection(a.reverse(),{canvas:this}),this.setActiveObject(a,b))},_collectObjects:function(){var e=[],a;a=this._groupSelector.ex;for(var c=this._groupSelector.ey,f=a+this._groupSelector.left,k=c+this._groupSelector.top,g=new fabric.Point(d(a,f),d(c,k)),h=new fabric.Point(b(a,f),b(c,k)),l=!this.selectionFullyContained,c=a===f&&c===k,f=this._objects.length;f--&&!((a=this._objects[f])&&a.selectable&&a.visible&&(l&&a.intersectsWithRect(g,h)||a.isContainedWithinRect(g,h)||l&&a.containsPoint(g)||l&&a.containsPoint(h))&&(e.push(a),c)););return e},_maybeGroupObjects:function(b){this.selection&&this._groupSelector&&this._groupSelectedObjects(b);this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();(function(){var d=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(b){b||(b={});var e=b.format||"png",a=b.quality||1,c=(b.multiplier||1)*(b.enableRetinaScaling?1:1/this.getRetinaScaling());return this.__toDataURLWithMultiplier(e,a,{left:b.left||0,top:b.top||0,width:b.width||0,height:b.height||0},c)},__toDataURLWithMultiplier:function(b,e,a,c){var f=this.width,d=this.height,g=(a.width||this.width)*c,h=(a.height||this.height)*c,l=this.getZoom()*c,m=this.viewportTransform,n=this.interactive,p=this.skipOffscreen,q=f!==g||d!==h;this.viewportTransform=[l,0,0,l,(m[4]-a.left)*c,(m[5]-a.top)*c];this.interactive=this.skipOffscreen=!1;q&&this.setDimensions({width:g,height:h},{backstoreOnly:!0});this.renderAll();b=this.__toDataURL(b,e,a);this.interactive=n;this.skipOffscreen=p;this.viewportTransform=m;q&&this.setDimensions({width:f,height:d},{backstoreOnly:!0});this.renderAll();return b},__toDataURL:function(b,e){var a=this.contextContainer.canvas;"jpg"===b&&(b="jpeg");return d?a.toDataURL("image/"+b,e):a.toDataURL("image/"+b)}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,b,e){return this.loadFromJSON(d,b,e)},loadFromJSON:function(d,b,e){if(d){var a="string"===typeof d?JSON.parse(d):fabric.util.object.clone(d),c=this,f=this.renderOnAddRemove;this.renderOnAddRemove=!1;this._enlivenObjects(a.objects,function(e){c.clear();c._setBgOverlay(a,function(){e.forEach(function(a,b){c.insertAt(a,b)});c.renderOnAddRemove=f;delete a.objects;delete a.backgroundImage;delete a.overlayImage;delete a.background;delete a.overlay;c._setOptions(a);c.renderAll();b&&b()})},e);return this}},_setBgOverlay:function(d,b){var e={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(d.backgroundImage||d.overlayImage||d.background||d.overlay){var a=function(){e.backgroundImage&&e.overlayImage&&e.backgroundColor&&e.overlayColor&&b&&b()};this.__setBgOverlay("backgroundImage",d.backgroundImage,e,a);this.__setBgOverlay("overlayImage",d.overlayImage,e,a);this.__setBgOverlay("backgroundColor",d.background,e,a);this.__setBgOverlay("overlayColor",d.overlay,e,a)}else b&&b()},__setBgOverlay:function(d,b,e,a){var c=this;if(b)if("backgroundImage"===d||"overlayImage"===d)fabric.util.enlivenObjects([b],function(b){c[d]=b[0];e[d]=!0;a&&a()});else this["set"+fabric.util.string.capitalize(d,!0)](b,function(){e[d]=!0;a&&a()});else e[d]=!0,a&&a()},_enlivenObjects:function(d,b,e){d&&0!==d.length?fabric.util.enlivenObjects(d,function(a){b&&b(a)},null,e):b&&b([])},_toDataURL:function(d,b){this.clone(function(e){b(e.toDataURL(d))})},_toDataURLWithMultiplier:function(d,b,e){this.clone(function(a){e(a.toDataURLWithMultiplier(d,b))})},clone:function(d,b){var e=JSON.stringify(this.toJSON(b));this.cloneWithoutData(function(a){a.loadFromJSON(e,function(){d&&d(a)})})},cloneWithoutData:function(d){var b=fabric.document.createElement("canvas");b.width=this.width;b.height=this.height;var e=new fabric.Canvas(b);e.clipTo=this.clipTo;this.backgroundImage?(e.setBackgroundImage(this.backgroundImage.src,function(){e.renderAll();d&&d(e)}),e.backgroundImageOpacity=this.backgroundImageOpacity,e.backgroundImageStretch=this.backgroundImageStretch):d&&d(e)}});(function(d){var b=d.fabric||(d.fabric={});d=b.util.object.extend;var e=b.util.object.clone,a=b.util.toFixed,c=b.util.string.capitalize,f=b.util.degreesToRadians,k=b.StaticCanvas.supports("setLineDash");b.Object||(b.Object=b.util.createClass(b.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!b.isLikelyNode,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=b.document.createElement("canvas");this._cacheContext=this._cacheCanvas.getContext("2d");this._updateCacheCanvas()},_limitCacheSize:function(a){var c=b.perfLimitSizeTotal,f=a.width,e=a.height,g=b.maxCacheSideLimit,d=b.minCacheSideLimit;if(f<=g&&e<=g&&f*e<=c)return f<d&&(a.width=d),e<d&&(a.height=d),a;var k=b.util.limitDimsByArea(f/e,c),r=b.util.capValue,c=r(d,k.x,g),g=r(d,k.y,g);f>c&&(a.zoomX/=f/c,a.width=c,a.capped=!0);e>g&&(a.zoomY/=e/g,a.height=g,a.capped=!0);return a},_getCacheCanvasDimensions:function(){var a=this.canvas&&this.canvas.getZoom()||1,c=this.getObjectScaling(),f=this.canvas&&this.canvas._isRetinaScaling()?b.devicePixelRatio:1,e=this._getNonTransformedDimensions(),d=c.scaleX*a*f,a=c.scaleY*a*f;return{width:e.x*d+2,height:e.y*a+2,zoomX:d,zoomY:a,x:e.x,y:e.y}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var a=this.canvas._currentTransform.action;if(this===this.canvas._currentTransform.target&&a.slice&&"scale"===a.slice(0,5))return!1}var a=this._cacheCanvas,c=this._limitCacheSize(this._getCacheCanvasDimensions()),f=b.minCacheSideLimit,e=c.width,d=c.height,k=c.zoomX,q=c.zoomY,r=e!==this.cacheWidth||d!==this.cacheHeight,t=this.zoomX!==k||this.zoomY!==q,u=0,y=0,w=!1;if(r){var w=this._cacheCanvas.width,z=this._cacheCanvas.height,x=e>w||d>z,w=x||(e<.9*w||d<.9*z)&&w>f&&z>f;x&&!c.capped&&(e>f||d>f)&&(u=.1*e,y=.1*d)}return r||t?(w?(a.width=Math.ceil(e+u),a.height=Math.ceil(d+y)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,a.width,a.height)),f=c.x*k/2,c=c.y*q/2,this.cacheTranslationX=Math.round(a.width/2-f)+f,this.cacheTranslationY=Math.round(a.height/2-c)+c,this.cacheWidth=e,this.cacheHeight=d,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(k,q),this.zoomX=k,this.zoomY=q,!0):!1},setOptions:function(a){this._setOptions(a);this._initGradient(a.fill,"fill");this._initGradient(a.stroke,"stroke");this._initClipping(a);this._initPattern(a.fill,"fill");this._initPattern(a.stroke,"stroke")},transform:function(a){var c;c=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix();a.transform(c[0],c[1],c[2],c[3],c[4],c[5])},toObject:function(c){var f=b.Object.NUM_FRACTION_DIGITS,f={type:this.type,version:b.version,originX:this.originX,originY:this.originY,left:a(this.left,f),top:a(this.top,f),width:a(this.width,f),height:a(this.height,f),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,f),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,f),scaleX:a(this.scaleX,f),scaleY:a(this.scaleY,f),angle:a(this.angle,f),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:a(this.skewX,f),skewY:a(this.skewY,f)};b.util.populateWithProperties(this,f,c);this.includeDefaultValues||(f=this._removeDefaultValues(f));return f},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype;c.stateProperties.forEach(function(b){a[b]===c[b]&&delete a[b];"[object Array]"===Object.prototype.toString.call(a[b])&&"[object Array]"===Object.prototype.toString.call(c[b])&&0===a[b].length&&0===c[b].length&&delete a[b]});return a},toString:function(){return"#\x3cfabric."+c(this.type)+"\x3e"},getObjectScaling:function(){var a=this.scaleX,c=this.scaleY;if(this.group)var b=this.group.getObjectScaling(),a=a*b.scaleX,c=c*b.scaleY;return{scaleX:a,scaleY:c}},getObjectOpacity:function(){var a=this.opacity;this.group&&(a*=this.group.getObjectOpacity());return a},_set:function(a,c){var f=this[a]!==c;if("scaleX"===a||"scaleY"===a)c=this._constrainScale(c);"scaleX"===a&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&0>c?(this.flipY=!this.flipY,c*=-1):"shadow"!==a||!c||c instanceof b.Shadow?"dirty"===a&&this.group&&this.group.set("dirty",c):c=new b.Shadow(c);this[a]=c;f&&(f=this.group&&this.group.isOnACache(),-1<this.cacheProperties.indexOf(a)?(this.dirty=!0,f&&this.group.set("dirty",!0)):f&&-1<this.stateProperties.indexOf(a)&&this.group.set("dirty",!0));return this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:b.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(a){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),this.transform(a),this._setOpacity(a),this._setShadow(a,this),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.clipTo&&b.util.clipContext(this,a),this.shouldCache()?(this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext),this.dirty=!1),this.drawCacheOnCanvas(a)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(a),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&a.restore(),a.restore())},_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheHeight=this.cacheWidth=0},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&"object"===typeof this.shadow?!0:!1},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache())},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawObject:function(a){this._renderBackground(a);this._setStrokeStyles(a,this);this._setFillStyles(a,this);this._render(a)},drawCacheOnCanvas:function(a){a.scale(1/this.zoomX,1/this.zoomY);a.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(a){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!a&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!a){a=this.cacheWidth/this.zoomX;var c=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-a/2,-c/2,a,c)}return!0}return!1},_renderBackground:function(a){if(this.backgroundColor){var c=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor;a.fillRect(-c.x/2,-c.y/2,c.x,c.y);this._removeShadow(a)}},_setOpacity:function(a){a.globalAlpha=this.group&&!this.group._transformDone?this.getObjectOpacity():a.globalAlpha*this.opacity},_setStrokeStyles:function(a,c){c.stroke&&(a.lineWidth=c.strokeWidth,a.lineCap=c.strokeLineCap,a.lineJoin=c.strokeLineJoin,a.miterLimit=c.strokeMiterLimit,a.strokeStyle=c.stroke.toLive?c.stroke.toLive(a,this):c.stroke)},_setFillStyles:function(a,c){c.fill&&(a.fillStyle=c.fill.toLive?c.fill.toLive(a,this):c.fill)},_setLineDash:function(a,c,b){c&&(1&c.length&&c.push.apply(c,c),k?a.setLineDash(c):b&&b(a))},_renderControls:function(a,c){var e=this.getViewportTransform(),d=this.calcTransformMatrix(),g,k;c=c||{};g="undefined"!==typeof c.hasBorders?c.hasBorders:this.hasBorders;k="undefined"!==typeof c.hasControls?c.hasControls:this.hasControls;d=b.util.multiplyTransformMatrices(e,d);e=b.util.qrDecompose(d);a.save();a.translate(e.translateX,e.translateY);a.lineWidth=1*this.borderScaleFactor;this.group||(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1);c.forActiveSelection?(a.rotate(f(e.angle)),g&&this.drawBordersInGroup(a,e,c)):(a.rotate(f(this.angle)),g&&this.drawBorders(a,c));k&&this.drawControls(a,c);a.restore()},_setShadow:function(a){if(this.shadow){var c=this.canvas&&this.canvas.viewportTransform[0]||1,f=this.canvas&&this.canvas.viewportTransform[3]||1,e=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(c*=b.devicePixelRatio,f*=b.devicePixelRatio);a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*b.browserShadowBlurConstant*(c+f)*(e.scaleX+e.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*c*e.scaleX;a.shadowOffsetY=this.shadow.offsetY*f*e.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_applyPatternGradientTransform:function(a,c){if(!c||!c.toLive)return{offsetX:0,offsetY:0};var b=c.gradientTransform||c.patternTransform,f=-this.width/2+c.offsetX||0,e=-this.height/2+c.offsetY||0;a.translate(f,e);b&&a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);return{offsetX:f,offsetY:e}},_renderPaintInOrder:function(a){"stroke"===this.paintFirst?(this._renderStroke(a),this._renderFill(a)):(this._renderFill(a),this._renderStroke(a))},_renderFill:function(a){this.fill&&(a.save(),this._applyPatternGradientTransform(a,this.fill),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(a,this.stroke),a.stroke(),a.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var a=b.util.qrDecompose(this.transformMatrix);this.flipY=this.flipX=!1;this.set("scaleX",a.scaleX);this.set("scaleY",a.scaleY);this.angle=a.angle;this.skewX=a.skewX;this.skewY=0}},_removeTransformMatrix:function(a){var c=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),c=b.util.transformPoint(c,this.transformMatrix));this.transformMatrix=null;a&&(this.scaleX*=a.scaleX,this.scaleY*=a.scaleY,this.cropX=a.cropX,this.cropY=a.cropY,c.x+=a.offsetLeft,c.y+=a.offsetTop,this.width=a.width,this.height=a.height);this.setPositionByOrigin(c,"center","center")},clone:function(a,c){var f=this.toObject(c);this.constructor.fromObject?this.constructor.fromObject(f,a):b.Object._fromObject("Object",f,a)},cloneAsImage:function(a,c){var f=this.toDataURL(c);b.util.loadImage(f,function(c){a&&a(new b.Image(c))});return this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement(),f=this.getBoundingRect();c.width=f.width;c.height=f.height;b.util.wrapElement(c,"div");c=new b.StaticCanvas(c,{enableRetinaScaling:a.enableRetinaScaling,renderOnAddRemove:!1,skipOffscreen:!1});"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(c.backgroundColor="#fff");f={left:this.left,top:this.top};this.setPositionByOrigin(new b.Point(c.width/2,c.height/2),"center","center");var e=this.canvas;c.add(this);a=c.toDataURL(a);this.set(f).setCoords();this.canvas=e;c._objects=[];c.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 1},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var f={colorStops:[]};f.type=c.type||(c.r1||c.r2?"radial":"linear");f.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)f.coords.r1=c.r1,f.coords.r2=c.r2;f.gradientTransform=c.gradientTransform;b.Gradient.prototype.addColorStop.call(f,c.colorStops);return this.set(a,b.Gradient.forObject(this,f))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},rotate:function(a){var c=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;c&&this._setOriginToCenter();this.set("angle",a);c&&this._resetOrigin();return this},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&&this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this},getLocalPointer:function(a,c){c=c||this.canvas.getPointer(a);var e=new b.Point(c.x,c.y),d=this._getLeftTopCoords();this.angle&&(e=b.util.rotatePoint(e,d,f(-this.angle)));return{x:e.x-d.x,y:e.y-d.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),b.util.createAccessors&&b.util.createAccessors(b.Object),d(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object._fromObject=function(a,c,f,d){var g=b[a];c=e(c,!0);b.util.enlivenPatterns([c.fill,c.stroke],function(a){"undefined"!==typeof a[0]&&(c.fill=a[0]);"undefined"!==typeof a[1]&&(c.stroke=a[1]);a=d?new g(c[d],c):new g(c);f&&f(a)})},b.Object.__uid=0)})("undefined"!==typeof exports?exports:this);(function(){var d=fabric.util.degreesToRadians,b={left:-.5,center:0,right:.5},e={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(a,c,f,d,g){var k=a.x,l=a.y;c="string"===typeof c?b[c]:c-.5;d="string"===typeof d?b[d]:d-.5;c=d-c;f="string"===typeof f?e[f]:f-.5;g="string"===typeof g?e[g]:g-.5;f=g-f;if(c||f)l=this._getTransformedDimensions(),k=a.x+c*l.x,l=a.y+f*l.y;return new fabric.Point(k,l)},translateToCenterPoint:function(a,c,b){c=this.translateToGivenOrigin(a,c,b,"center","center");return this.angle?fabric.util.rotatePoint(c,a,d(this.angle)):c},translateToOriginPoint:function(a,c,b){c=this.translateToGivenOrigin(a,"center","center",c,b);return this.angle?fabric.util.rotatePoint(c,a,d(this.angle)):c},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,c){var b=this.getCenterPoint();return this.translateToOriginPoint(b,a,c)},toLocalPoint:function(a,c,b){var f=this.getCenterPoint();c="undefined"!==typeof c&&"undefined"!==typeof b?this.translateToGivenOrigin(f,"center","center",c,b):new fabric.Point(this.left,this.top);a=new fabric.Point(a.x,a.y);this.angle&&(a=fabric.util.rotatePoint(a,f,-d(this.angle)));return a.subtractEquals(c)},setPositionByOrigin:function(a,c,b){a=this.translateToCenterPoint(a,c,b);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(a){var c=d(this.angle),f=this.getScaledWidth(),e=fabric.util.cos(c)*f,c=fabric.util.sin(c)*f,g,f="string"===typeof this.originX?b[this.originX]:this.originX-.5;g="string"===typeof a?b[a]:a-.5;this.left+=e*(g-f);this.top+=c*(g-f);this.setCoords();this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")},onDeselect:function(){}})})();(function(){var d=fabric.util.degreesToRadians,b=fabric.util.multiplyTransformMatrices,e=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(a,c){this.oCoords||this.setCoords();var b=a?this.aCoords:this.oCoords,b=c?this.calcCoords(a):b;return[new fabric.Point(b.tl.x,b.tl.y),new fabric.Point(b.tr.x,b.tr.y),new fabric.Point(b.br.x,b.br.y),new fabric.Point(b.bl.x,b.bl.y)]},intersectsWithRect:function(a,c,b,e){b=this.getCoords(b,e);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(b,a,c).status},intersectsWithObject:function(a,c,b){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(this.getCoords(c,b),a.getCoords(c,b)).status||a.isContainedWithinObject(this,c,b)||this.isContainedWithinObject(a,c,b)},isContainedWithinObject:function(a,c,b){var f=this.getCoords(c,b),e=0;for(c=a._getImageLines(b?a.calcCoords(c):c?a.aCoords:a.oCoords);4>e;e++)if(!a.containsPoint(f[e],c))return!1;return!0},isContainedWithinRect:function(a,c,b,e){b=this.getBoundingRect(b,e);return b.left>=a.x&&b.left+b.width<=c.x&&b.top>=a.y&&b.top+b.height<=c.y},containsPoint:function(a,c,b,e){c=c||this._getImageLines(e?this.calcCoords(b):b?this.aCoords:this.oCoords);a=this._findCrossPoints(a,c);return 0!==a&&1===a%2},isOnScreen:function(a){if(!this.canvas)return!1;for(var c=this.canvas.vptCoords.tl,b=this.canvas.vptCoords.br,e=this.getCoords(!0,a),d,h=0;4>h;h++)if(d=e[h],d.x<=b.x&&d.x>=c.x&&d.y<=b.y&&d.y>=c.y)return!0;return this.intersectsWithRect(c,b,!0,a)?!0:this._containsCenterOfCanvas(c,b,a)},_containsCenterOfCanvas:function(a,c,b){return this.containsPoint({x:(a.x+c.x)/2,y:(a.y+c.y)/2},null,!0,b)?!0:!1},isPartiallyOnScreen:function(a){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,b=this.canvas.vptCoords.br;return this.intersectsWithRect(c,b,!0,a)?!0:this._containsCenterOfCanvas(c,b,a)},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,c){var b,e,d,h=0,l;for(l in c)if(d=c[l],!(d.o.y<a.y&&d.d.y<a.y||d.o.y>=a.y&&d.d.y>=a.y)&&(d.o.x===d.d.x&&d.o.x>=a.x?b=d.o.x:(b=(d.d.y-d.o.y)/(d.d.x-d.o.x),e=a.y-0*a.x,d=d.o.y-b*d.o.x,b=-(e-d)/(0-b)),b>=a.x&&(h+=1),2===h))break;return h},getBoundingRect:function(a,c){var b=this.getCoords(a,c);return fabric.util.makeBoundingBoxFromPoints(b)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:0===a?1E-4:a},scale:function(a){this._set("scaleX",a);this._set("scaleY",a);return this.setCoords()},scaleToWidth:function(a,c){var b=this.getBoundingRect(c).width/this.getScaledWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a,c){var b=this.getBoundingRect(c).height/this.getScaledHeight();return this.scale(a/this.height/b)},calcCoords:function(a){var c=this._calcRotateMatrix(),f=this._calcTranslateMatrix(),c=b(f,c),f=this.getViewportTransform(),k=a?c:b(f,c),c=this._getTransformedDimensions(),g=c.x/2,h=c.y/2,c=e({x:-g,y:-h},k),f=e({x:g,y:-h},k),l=e({x:-g,y:h},k),k=e({x:g,y:h},k);if(!a){var m=this.padding,n=d(this.angle),p=fabric.util.cos(n),g=fabric.util.sin(n),q=p*m,r=g*m,n=q+r,q=q-r;m&&(c.x-=q,c.y-=n,f.x+=n,f.y-=q,l.x-=n,l.y+=q,k.x+=q,k.y+=n);m=new fabric.Point((c.x+l.x)/2,(c.y+l.y)/2);n=new fabric.Point((f.x+c.x)/2,(f.y+c.y)/2);q=new fabric.Point((k.x+f.x)/2,(k.y+f.y)/2);r=new fabric.Point((k.x+l.x)/2,(k.y+l.y)/2);p=new fabric.Point(n.x+g*this.rotatingPointOffset,n.y-p*this.rotatingPointOffset)}c={tl:c,tr:f,br:k,bl:l};a||(c.ml=m,c.mt=n,c.mr=q,c.mb=r,c.mtr=p);return c},setCoords:function(a,c){this.oCoords=this.calcCoords(a);c||(this.aCoords=this.calcCoords(!0));a||this._setCornerCoords&&this._setCornerCoords();return this},_calcRotateMatrix:function(){if(this.angle){var a=d(this.angle),c=fabric.util.cos(a),a=fabric.util.sin(a);return[c,a,-a,c,0,0]}return fabric.iMatrix.concat()},_calcTranslateMatrix:function(){var a=this.getCenterPoint();return[1,0,0,1,a.x,a.y]},transformMatrixKey:function(a){var c="";!a&&this.group&&(c=this.group.transformMatrixKey(a)+"_");return c+this.top+"_"+this.left+"_"+this.scaleX+"_"+this.scaleY+"_"+this.skewX+"_"+this.skewY+"_"+this.angle+"_"+this.originX+"_"+this.originY+"_"+this.width+"_"+this.height+"_"+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(a){if(a)return this.calcOwnMatrix();a=this.transformMatrixKey();var c=this.matrixCache||(this.matrixCache={});if(c.key===a)return c.value;var f=this.calcOwnMatrix();this.group&&(f=b(this.group.calcTransformMatrix(),f));c.key=a;return c.value=f},calcOwnMatrix:function(){var a=this.transformMatrixKey(!0),c=this.ownMatrixCache||(this.ownMatrixCache={});if(c.key===a)return c.value;var f=this._calcTranslateMatrix(),e,d=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);this.angle&&(e=this._calcRotateMatrix(),f=b(f,e));f=b(f,d);c.key=a;return c.value=f},_calcDimensionsTransformMatrix:function(a,c,f){f=[this.scaleX*(f&&this.flipX?-1:1),0,0,this.scaleY*(f&&this.flipY?-1:1),0,0];a&&(a=[1,0,Math.tan(d(a)),1],f=b(f,a,!0));c&&(a=[1,Math.tan(d(c)),0,1],f=b(f,a,!0));return f},_getNonTransformedDimensions:function(){var a=this.strokeWidth;return{x:this.width+a,y:this.height+a}},_getTransformedDimensions:function(a,c){"undefined"===typeof a&&(a=this.skewX);"undefined"===typeof c&&(c=this.skewY);var b=this._getNonTransformedDimensions();if(0===a&&0===c)return{x:b.x*this.scaleX,y:b.y*this.scaleY};for(var e=b.x/2,b=b.y/2,e=[{x:-e,y:-b},{x:e,y:-b},{x:-e,y:b},{x:e,y:b}],d=this._calcDimensionsTransformMatrix(a,c,!1),b=0;b<e.length;b++)e[b]=fabric.util.transformPoint(e[b],d);e=fabric.util.makeBoundingBoxFromPoints(e);return{x:e.width,y:e.height}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),c=this._getTransformedDimensions();return fabric.util.transformPoint(c,a,!0).scalarAdd(2*this.padding)}})})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(d){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas.sendBackwards(this,d);return this},bringForward:function(d){this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,d):this.canvas.bringForward(this,d);return this},moveTo:function(d){this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas.moveTo(this,d);return this}});(function(){function d(b,a){if(a){if(a.toLive)return b+": url(#SVGID_"+a.id+"); ";var c=new fabric.Color(a),f=b+": "+c.toRgb()+"; ",c=c.getAlpha();1!==c&&(f+=b+"-opacity: "+c.toString()+"; ");return f}return b+": none; "}var b=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(b){var a=this.fillRule,c=this.strokeWidth?this.strokeWidth:"0",f=this.strokeDashArray?this.strokeDashArray.join(" "):"none",e=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",l="undefined"!==typeof this.opacity?this.opacity:"1",m=this.visible?"":" visibility: hidden;";b=b?"":this.getSvgFilter();var n=d("fill",this.fill);return[d("stroke",this.stroke),"stroke-width: ",c,"; stroke-dasharray: ",f,"; stroke-linecap: ",e,"; stroke-linejoin: ",g,"; stroke-miterlimit: ",h,"; ",n,"fill-rule: ",a,"; opacity: ",l,";",b,m].join("")},getSvgSpanStyles:function(b,a){var c=b.fontFamily?"font-family: "+(-1===b.fontFamily.indexOf("'")&&-1===b.fontFamily.indexOf('"')?"'"+b.fontFamily+"'":b.fontFamily)+"; ":"",f=b.strokeWidth?"stroke-width: "+b.strokeWidth+"; ":"",e=b.fontSize?"font-size: "+b.fontSize+"px; ":"",g=b.fontStyle?"font-style: "+b.fontStyle+"; ":"",h=b.fontWeight?"font-weight: "+b.fontWeight+"; ":"",l=b.fill?d("fill",b.fill):"",m=b.stroke?d("stroke",b.stroke):"",n=this.getSvgTextDecoration(b),p=b.deltaY?"baseline-shift: "+-b.deltaY+"; ":"";n&&(n="text-decoration: "+n+"; ");return[m,f,c,e,g,h,n,l,p,a?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(b){return"overline"in b||"underline"in b||"linethrough"in b?(b.overline?"overline ":"")+(b.underline?"underline ":"")+(b.linethrough?"line-through ":""):""},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id\x3d"'+this.id+'" ':""},getSvgTransform:function(){var e=this.angle,a=this.skewX%360,c=this.skewY%360,f=this.getCenterPoint(),d=fabric.Object.NUM_FRACTION_DIGITS,f="translate("+b(f.x,d)+" "+b(f.y,d)+")",e=0!==e?" rotate("+b(e,d)+")":"",g=1===this.scaleX&&1===this.scaleY?"":" scale("+b(this.scaleX,d)+" "+b(this.scaleY,d)+")",a=0!==a?" skewX("+b(a,d)+")":"",c=0!==c?" skewY("+b(c,d)+")":"";return[f,e,g,this.flipX?" matrix(-1 0 0 1 0 0) ":"",this.flipY?" matrix(1 0 0 -1 0 0)":"",a,c].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_setSVGBg:function(e){if(this.backgroundColor){var a=fabric.Object.NUM_FRACTION_DIGITS;e.push("\t\t\x3crect ",this._getFillAttributes(this.backgroundColor),' x\x3d"',b(-this.width/2,a),'" y\x3d"',b(-this.height/2,a),'" width\x3d"',b(this.width,a),'" height\x3d"',b(this.height,a),'"\x3e\x3c/rect\x3e\n')}},_createBaseSVGMarkup:function(){var b=[];this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,!1));this.shadow&&b.push(this.shadow.toSVG(this));return b},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order\x3d"'+this.paintFirst+'" ':""}})})();(function(){function d(a,c,b){var f={};b.forEach(function(c){f[c]=a[c]});e(a[c],f,!0)}function b(a,c,f){if(a===c)return!0;if(Array.isArray(a)){if(!Array.isArray(c)||a.length!==c.length)return!1;f=0;for(var e=a.length;f<e;f++)if(!b(a[f],c[f]))return!1;return!0}if(a&&"object"===typeof a){var d=Object.keys(a),h;if(!c||"object"!==typeof c||!f&&d.length!==Object.keys(c).length)return!1;f=0;for(e=d.length;f<e;f++)if(h=d[f],!b(a[h],c[h]))return!1;return!0}}var e=fabric.util.object.extend;fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(a){a=a||"stateProperties";var c="_"+a;return Object.keys(this[c]).length<this[a].length?!0:!b(this[c],this,!0)},saveState:function(a){var c=a&&a.propertySet||"stateProperties",b="_"+c;if(!this[b])return this.setupState(a);d(this,b,this[c]);a&&a.stateProperties&&d(this,b,a.stateProperties);return this},setupState:function(a){a=a||{};var c=a.propertySet||"stateProperties";a.propertySet=c;this["_"+c]={};this.saveState(a);return this}})})();(function(){var d=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(b){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var e=b.x;b=b.y;var a;this.__corner=0;for(var c in this.oCoords)if(this.isControlVisible(c)&&("mtr"!==c||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==c&&"mr"!==c&&"mb"!==c&&"ml"!==c)&&(a=this._getImageLines(this.oCoords[c].corner),a=this._findCrossPoints({x:e,y:b},a),0!==a&&1===a%2))return this.__corner=c;return!1},_setCornerCoords:function(){var b=this.oCoords,e=d(45-this.angle),a=.707106*this.cornerSize,c=a*fabric.util.cos(e),e=a*fabric.util.sin(e),f,k;for(k in b)a=b[k].x,f=b[k].y,b[k].corner={tl:{x:a-e,y:f-c},tr:{x:a+c,y:f-e},bl:{x:a-c,y:f+e},br:{x:a+e,y:f+c}}},drawSelectionBackground:function(b){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;b.save();var e=this.getCenterPoint(),a=this._calculateCurrentDimensions(),c=this.canvas.viewportTransform;b.translate(e.x,e.y);b.scale(1/c[0],1/c[3]);b.rotate(d(this.angle));b.fillStyle=this.selectionBackgroundColor;b.fillRect(-a.x/2,-a.y/2,a.x,a.y);b.restore();return this},drawBorders:function(b,e){e=e||{};var a=this._calculateCurrentDimensions(),c=1/this.borderScaleFactor,f=a.x+c,c=a.y+c,d="undefined"!==typeof e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,g="undefined"!==typeof e.hasControls?e.hasControls:this.hasControls,a="undefined"!==typeof e.rotatingPointOffset?e.rotatingPointOffset:this.rotatingPointOffset;b.save();b.strokeStyle=e.borderColor||this.borderColor;this._setLineDash(b,e.borderDashArray||this.borderDashArray,null);b.strokeRect(-f/2,-c/2,f,c);d&&this.isControlVisible("mtr")&&g&&(f=-c/2,b.beginPath(),b.moveTo(0,f),b.lineTo(0,f-a),b.stroke());b.restore();return this},drawBordersInGroup:function(b,e,a){a=a||{};var c=this._getNonTransformedDimensions();e=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX);e=fabric.util.transformPoint(c,e);var f=1/this.borderScaleFactor,c=e.x+f;e=e.y+f;b.save();this._setLineDash(b,a.borderDashArray||this.borderDashArray,null);b.strokeStyle=a.borderColor||this.borderColor;b.strokeRect(-c/2,-e/2,c,e);b.restore();return this},drawControls:function(b,e){e=e||{};var a=this._calculateCurrentDimensions(),c=a.x,a=a.y,f=e.cornerSize||this.cornerSize,d=-(c+f)/2,f=-(a+f)/2,g="undefined"!==typeof e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,h=("undefined"!==typeof e.transparentCorners?e.transparentCorners:this.transparentCorners)?"stroke":"fill";b.save();b.strokeStyle=b.fillStyle=e.cornerColor||this.cornerColor;this.transparentCorners||(b.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor);this._setLineDash(b,e.cornerDashArray||this.cornerDashArray,null);this._drawControl("tl",b,h,d,f,e);this._drawControl("tr",b,h,d+c,f,e);this._drawControl("bl",b,h,d,f+a,e);this._drawControl("br",b,h,d+c,f+a,e);this.get("lockUniScaling")||(this._drawControl("mt",b,h,d+c/2,f,e),this._drawControl("mb",b,h,d+c/2,f+a,e),this._drawControl("mr",b,h,d+c,f+a/2,e),this._drawControl("ml",b,h,d,f+a/2,e));g&&this._drawControl("mtr",b,h,d+c/2,f-this.rotatingPointOffset,e);b.restore();return this},_drawControl:function(b,e,a,c,f,d){d=d||{};if(this.isControlVisible(b)){b=this.cornerSize;var g=!this.transparentCorners&&this.cornerStrokeColor;switch(d.cornerStyle||this.cornerStyle){case "circle":e.beginPath();e.arc(c+b/2,f+b/2,b/2,0,2*Math.PI,!1);e[a]();g&&e.stroke();break;default:this.transparentCorners||e.clearRect(c,f,b,b),e[a+"Rect"](c,f,b,b),g&&e.strokeRect(c,f,b,b)}}},isControlVisible:function(b){return this._getControlsVisibility()[b]},setControlVisible:function(b,e){this._getControlsVisibility()[b]=e;return this},setControlsVisibility:function(b){b||(b={});for(var e in b)this.setControlVisible(e,b[e]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,b){b=b||{};var e=function(){},a=b.onComplete||e,c=b.onChange||e,f=this;fabric.util.animate({startValue:d.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){d.set("left",a);f.requestRenderAll();c()},onComplete:function(){d.setCoords();a()}});return this},fxCenterObjectV:function(d,b){b=b||{};var e=function(){},a=b.onComplete||e,c=b.onChange||e,f=this;fabric.util.animate({startValue:d.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){d.set("top",a);f.requestRenderAll();c()},onComplete:function(){d.setCoords();a()}});return this},fxRemove:function(d,b){b=b||{};var e=function(){},a=b.onComplete||e,c=b.onChange||e,f=this;fabric.util.animate({startValue:d.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(a){d.set("opacity",a);f.requestRenderAll();c()},onComplete:function(){f.remove(d);a()}});return this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"===typeof arguments[0]){var d=[],b,e;for(b in arguments[0])d.push(b);for(var a=0,c=d.length;a<c;a++)b=d[a],e=a!==c-1,this._animate(b,arguments[0][b],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(d,b,e,a){var c=this,f;b=b.toString();e=e?fabric.util.object.clone(e):{};~d.indexOf(".")&&(f=d.split("."));var k=f?this.get(f[0])[f[1]]:this.get(d);"from"in e||(e.from=k);b=~b.indexOf("\x3d")?k+parseFloat(b.replace("\x3d","")):parseFloat(b);fabric.util.animate({startValue:e.from,endValue:b,byValue:e.by,easing:e.easing,duration:e.duration,abort:e.abort&&function(){return e.abort.call(c)},onChange:function(b,k,l){f?c[f[0]][f[1]]=b:c.set(d,b);a||e.onChange&&e.onChange(b,k,l)},onComplete:function(b,f,d){a||(c.setCoords(),e.onComplete&&e.onComplete(b,f,d))}})}});(function(d){function b(a,c){var b=a.origin,f=a.axis1,e=a.axis2,d=a.dimension,g=c.nearest,k=c.center,h=c.farthest;return function(){switch(this.get(b)){case g:return Math.min(this.get(f),this.get(e));case k:return Math.min(this.get(f),this.get(e))+.5*this.get(d);case h:return Math.max(this.get(f),this.get(e))}}}var e=d.fabric||(d.fabric={}),a=e.util.object.extend,c=e.util.object.clone,f={x1:1,x2:1,y1:1,y2:1},k=e.StaticCanvas.supports("setLineDash");e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(a,c){a||(a=[0,0,0,0]);this.callSuper("initialize",c);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(c)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,c){this.callSuper("_set",a,c);"undefined"!==typeof f[a]&&this._setWidthHeight();return this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){a.beginPath();if(!this.strokeDashArray||this.strokeDashArray&&k){var c=this.calcLinePoints();a.moveTo(c.x1,c.y1);a.lineTo(c.x2,c.y2)}a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var c=this.calcLinePoints();a.beginPath();e.util.drawDashedLine(a,c.x1,c.y1,c.x2,c.y2,this.strokeDashArray);a.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return a(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");"butt"===this.strokeLineCap&&(0===this.width&&(a.y-=this.strokeWidth),0===this.height&&(a.x-=this.strokeWidth));return a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,c=this.y1<=this.y2?-1:1;return{x1:a*this.width*.5,x2:a*this.width*-.5,y1:c*this.height*.5,y2:c*this.height*-.5}},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=this.calcLinePoints();c.push("\x3cline ",this.getSvgId(),'x1\x3d"',b.x1,'" y1\x3d"',b.y1,'" x2\x3d"',b.x2,'" y2\x3d"',b.y2,'" style\x3d"',this.getSvgStyles(),'" transform\x3d"',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/\x3e\n');return a?a(c.join("")):c.join("")}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),e.Line.fromElement=function(c,b,f){f=f||{};c=e.parseAttributes(c,e.Line.ATTRIBUTE_NAMES);b(new e.Line([c.x1||0,c.y1||0,c.x2||0,c.y2||0],a(c,f)))},e.Line.fromObject=function(a,b){var f=c(a,!0);f.points=[a.x1,a.y1,a.x2,a.y2];e.Object._fromObject("Line",f,function(a){delete a.points;b&&b(a)},"points")})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=Math.PI;b.Circle?b.warn("fabric.Circle is already defined."):(b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*e,cacheProperties:b.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(a,c){this.callSuper("_set",a,c);"radius"===a&&this.setRadius(c);return this},toObject:function(a){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(a))},toSVG:function(a){var c=this._createBaseSVGMarkup(),f=(this.endAngle-this.startAngle)%(2*e);if(0===f)c.push("\x3ccircle ",this.getSvgId(),'cx\x3d"0" cy\x3d"0" ','r\x3d"',this.radius,'" style\x3d"',this.getSvgStyles(),'" transform\x3d"',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/\x3e\n");else{var d=b.util.cos(this.startAngle)*this.radius,g=b.util.sin(this.startAngle)*this.radius,h=b.util.cos(this.endAngle)*this.radius,l=b.util.sin(this.endAngle)*this.radius;c.push('\x3cpath d\x3d"M '+d+" "+g," A "+this.radius+" "+this.radius," 0 ",+(f>e?1:0)+" 1"," "+h+" "+l,'" style\x3d"',this.getSvgStyles(),'" transform\x3d"',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"',this.addPaintOrder(),'"/\x3e\n')}return a?a(c.join("")):c.join("")},_render:function(a){a.beginPath();a.arc(0,0,this.radius,this.startAngle,this.endAngle,!1);this._renderPaintInOrder(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;return this.set("width",2*a).set("height",2*a)}}),b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),b.Circle.fromElement=function(a,c){var f=b.parseAttributes(a,b.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&0<=f.radius))throw Error("value of `r` attribute is required and can not be negative");f.left=(f.left||0)-f.radius;f.top=(f.top||0)-f.radius;c(new b.Circle(f))},b.Circle.fromObject=function(a,c){return b.Object._fromObject("Circle",a,c)})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={});b.Triangle?b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",width:100,height:100,_render:function(b){var a=this.width/2,c=this.height/2;b.beginPath();b.moveTo(-a,c);b.lineTo(0,-c);b.lineTo(a,c);b.closePath();this._renderPaintInOrder(b)},_renderDashedStroke:function(e){var a=this.width/2,c=this.height/2;e.beginPath();b.util.drawDashedLine(e,-a,c,0,-c,this.strokeDashArray);b.util.drawDashedLine(e,0,-c,a,c,this.strokeDashArray);b.util.drawDashedLine(e,a,c,-a,c,this.strokeDashArray);e.closePath()},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=this.width/2,f=this.height/2,c=[-c+" "+f,"0 "+-f,c+" "+f].join();a.push("\x3cpolygon ",this.getSvgId(),'points\x3d"',c,'" style\x3d"',this.getSvgStyles(),'" transform\x3d"',this.getSvgTransform(),'"',this.addPaintOrder(),"/\x3e");return b?b(a.join("")):a.join("")}}),b.Triangle.fromObject=function(e,a){return b.Object._fromObject("Triangle",e,a)})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=2*Math.PI;b.Ellipse?b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(a){this.callSuper("initialize",a);this.set("rx",a&&a.rx||0);this.set("ry",a&&a.ry||0)},_set:function(a,c){this.callSuper("_set",a,c);switch(a){case "rx":this.rx=c;this.set("width",2*c);break;case "ry":this.ry=c,this.set("height",2*c)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var c=this._createBaseSVGMarkup();c.push("\x3cellipse ",this.getSvgId(),'cx\x3d"0" cy\x3d"0" ','rx\x3d"',this.rx,'" ry\x3d"',this.ry,'" style\x3d"',this.getSvgStyles(),'" transform\x3d"',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/\x3e\n");return a?a(c.join("")):c.join("")},_render:function(a){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(0,0,this.rx,0,e,!1);a.restore();this._renderPaintInOrder(a)}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),b.Ellipse.fromElement=function(a,c){var f=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);f.left=(f.left||0)-f.rx;f.top=(f.top||0)-f.ry;c(new b.Ellipse(f))},b.Ellipse.fromObject=function(a,c){return b.Object._fromObject("Ellipse",a,c)})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=b.util.object.extend;b.Rect?b.warn("fabric.Rect is already defined"):(b.Rect=b.util.createClass(b.Object,{stateProperties:b.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(a){this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a){if(1===this.width&&1===this.height)a.fillRect(-.5,-.5,1,1);else{var c=this.rx?Math.min(this.rx,this.width/2):0,b=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,d=this.height,h=-this.width/2,l=-this.height/2,m=0!==c||0!==b;a.beginPath();a.moveTo(h+c,l);a.lineTo(h+e-c,l);m&&a.bezierCurveTo(h+e-.4477152502*c,l,h+e,l+.4477152502*b,h+e,l+b);a.lineTo(h+e,l+d-b);m&&a.bezierCurveTo(h+e,l+d-.4477152502*b,h+e-.4477152502*c,l+d,h+e-c,l+d);a.lineTo(h+c,l+d);m&&a.bezierCurveTo(h+.4477152502*c,l+d,h,l+d-.4477152502*b,h,l+d-b);a.lineTo(h,l+b);m&&a.bezierCurveTo(h,l+.4477152502*b,h+.4477152502*c,l,h+c,l);a.closePath();this._renderPaintInOrder(a)}},_renderDashedStroke:function(a){var c=-this.width/2,f=-this.height/2,e=this.width,d=this.height;a.beginPath();b.util.drawDashedLine(a,c,f,c+e,f,this.strokeDashArray);b.util.drawDashedLine(a,c+e,f,c+e,f+d,this.strokeDashArray);b.util.drawDashedLine(a,c+e,f+d,c,f+d,this.strokeDashArray);b.util.drawDashedLine(a,c,f+d,c,f,this.strokeDashArray);a.closePath()},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=-this.width/2,e=-this.height/2;c.push("\x3crect ",this.getSvgId(),'x\x3d"',b,'" y\x3d"',e,'" rx\x3d"',this.get("rx"),'" ry\x3d"',this.get("ry"),'" width\x3d"',this.width,'" height\x3d"',this.height,'" style\x3d"',this.getSvgStyles(),'" transform\x3d"',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/\x3e\n");return a?a(c.join("")):c.join("")}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,c,f){if(!a)return c(null);f=f||{};a=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);a.left=a.left||0;a.top=a.top||0;f=new b.Rect(e(f?b.util.object.clone(f):{},a));f.visible=f.visible&&0<f.width&&0<f.height;c(f)},b.Rect.fromObject=function(a,c){return b.Object._fromObject("Rect",a,c)})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=b.util.object.extend,a=b.util.array.min,c=b.util.array.max,f=b.util.toFixed;b.Polyline?b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,cacheProperties:b.Object.prototype.cacheProperties.concat("points"),initialize:function(a,c){c=c||{};this.points=a||[];this.callSuper("initialize",c);var b=this._calcDimensions();"undefined"===typeof c.left&&(this.left=b.left);"undefined"===typeof c.top&&(this.top=b.top);this.width=b.width;this.height=b.height;this.pathOffset={x:b.left+this.width/2,y:b.top+this.height/2}},_calcDimensions:function(){var b=this.points,f=a(b,"x")||0,e=a(b,"y")||0,d=c(b,"x")||0,b=c(b,"y")||0;return{left:f,top:e,width:d-f,height:b-e}},toObject:function(a){return e(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var c=[],e=this.pathOffset.x,d=this.pathOffset.y,k=this._createBaseSVGMarkup(),n=b.Object.NUM_FRACTION_DIGITS,p=0,q=this.points.length;p<q;p++)c.push(f(this.points[p].x-e,n),",",f(this.points[p].y-d,n)," ");k.push("\x3c",this.type," ",this.getSvgId(),'points\x3d"',c.join(""),'" style\x3d"',this.getSvgStyles(),'" transform\x3d"',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/\x3e\n");return a?a(k.join("")):k.join("")},commonRender:function(a){var c,b=this.points.length,f=this.pathOffset.x,e=this.pathOffset.y;if(!b||isNaN(this.points[b-1].y))return!1;a.beginPath();a.moveTo(this.points[0].x-f,this.points[0].y-e);for(var d=0;d<b;d++)c=this.points[d],a.lineTo(c.x-f,c.y-e);return!0},_render:function(a){this.commonRender(a)&&this._renderPaintInOrder(a)},_renderDashedStroke:function(a){var c,f;a.beginPath();for(var e=0,d=this.points.length;e<d;e++)c=this.points[e],f=this.points[e+1]||c,b.util.drawDashedLine(a,c.x,c.y,f.x,f.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,c,f){if(!a)return c(null);f||(f={});var e=b.parsePointsAttribute(a.getAttribute("points"));a=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);c(new b.Polyline(e,b.util.object.extend(a,f)))},b.Polyline.fromObject=function(a,c){return b.Object._fromObject("Polyline",a,c,"points")})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=b.util.object.extend;b.Polygon?b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Polyline,{type:"polygon",_render:function(a){this.commonRender(a)&&(a.closePath(),this._renderPaintInOrder(a))},_renderDashedStroke:function(a){this.callSuper("_renderDashedStroke",a);a.closePath()}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,c,f){if(!a)return c(null);f||(f={});var d=b.parsePointsAttribute(a.getAttribute("points"));a=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);c(new b.Polygon(d,e(a,f)))},b.Polygon.fromObject=function(a,c){return b.Object._fromObject("Polygon",a,c,"points")})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=b.util.array.min,a=b.util.array.max,c=b.util.object.extend,f=Object.prototype.toString,k=b.util.drawArc,g={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"};b.Path?b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,cacheProperties:b.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:b.Object.prototype.stateProperties.concat("path"),initialize:function(a,c){c=c||{};this.callSuper("initialize",c);a||(a=[]);var b="[object Array]"===f.call(a);if(this.path=b?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))b||(this.path=this._parsePath()),this._setPositionDimensions(c)},_setPositionDimensions:function(a){var c=this._parseDimensions();this.width=c.width;this.height=c.height;"undefined"===typeof a.left&&(this.left=c.left);"undefined"===typeof a.top&&(this.top=c.top);this.pathOffset=this.pathOffset||{x:c.left+this.width/2,y:c.top+this.height/2}},_renderPathCommands:function(a){var c,b=null,f=0,e=0,d=0,g=0,h=0,l=0,w,z,x=-this.pathOffset.x,v=-this.pathOffset.y;a.beginPath();for(var D=0,A=this.path.length;D<A;++D){c=this.path[D];switch(c[0]){case "l":d+=c[1];g+=c[2];a.lineTo(d+x,g+v);break;case "L":d=c[1];g=c[2];a.lineTo(d+x,g+v);break;case "h":d+=c[1];a.lineTo(d+x,g+v);break;case "H":d=c[1];a.lineTo(d+x,g+v);break;case "v":g+=c[1];a.lineTo(d+x,g+v);break;case "V":g=c[1];a.lineTo(d+x,g+v);break;case "m":d+=c[1];g+=c[2];f=d;e=g;a.moveTo(d+x,g+v);break;case "M":d=c[1];g=c[2];f=d;e=g;a.moveTo(d+x,g+v);break;case "c":w=d+c[5];z=g+c[6];h=d+c[3];l=g+c[4];a.bezierCurveTo(d+c[1]+x,g+c[2]+v,h+x,l+v,w+x,z+v);d=w;g=z;break;case "C":d=c[5];g=c[6];h=c[3];l=c[4];a.bezierCurveTo(c[1]+x,c[2]+v,h+x,l+v,d+x,g+v);break;case "s":w=d+c[3];z=g+c[4];null===b[0].match(/[CcSs]/)?(h=d,l=g):(h=2*d-h,l=2*g-l);a.bezierCurveTo(h+x,l+v,d+c[1]+x,g+c[2]+v,w+x,z+v);h=d+c[1];l=g+c[2];d=w;g=z;break;case "S":w=c[3];z=c[4];null===b[0].match(/[CcSs]/)?(h=d,l=g):(h=2*d-h,l=2*g-l);a.bezierCurveTo(h+x,l+v,c[1]+x,c[2]+v,w+x,z+v);d=w;g=z;h=c[1];l=c[2];break;case "q":w=d+c[3];z=g+c[4];h=d+c[1];l=g+c[2];a.quadraticCurveTo(h+x,l+v,w+x,z+v);d=w;g=z;break;case "Q":w=c[3];z=c[4];a.quadraticCurveTo(c[1]+x,c[2]+v,w+x,z+v);d=w;g=z;h=c[1];l=c[2];break;case "t":w=d+c[1];z=g+c[2];null===b[0].match(/[QqTt]/)?(h=d,l=g):(h=2*d-h,l=2*g-l);a.quadraticCurveTo(h+x,l+v,w+x,z+v);d=w;g=z;break;case "T":w=c[1];z=c[2];null===b[0].match(/[QqTt]/)?(h=d,l=g):(h=2*d-h,l=2*g-l);a.quadraticCurveTo(h+x,l+v,w+x,z+v);d=w;g=z;break;case "a":k(a,d+x,g+v,[c[1],c[2],c[3],c[4],c[5],c[6]+d+x,c[7]+g+v]);d+=c[6];g+=c[7];break;case "A":k(a,d+x,g+v,[c[1],c[2],c[3],c[4],c[5],c[6]+x,c[7]+v]);d=c[6];g=c[7];break;case "z":case "Z":d=f,g=e,a.closePath()}b=c}},_render:function(a){this._renderPathCommands(a);this._renderPaintInOrder(a)},toString:function(){return"#\x3cfabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }\x3e"},toObject:function(a){return c(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),top:this.top,left:this.left})},toDatalessObject:function(a){a=this.toObject(["sourcePath"].concat(a));a.sourcePath&&delete a.path;return a},toSVG:function(a){for(var c=[],b=this._createBaseSVGMarkup(),f=0,e=this.path.length;f<e;f++)c.push(this.path[f].join(" "));f=c.join(" ");c=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ";b.push("\x3cpath ",this.getSvgId(),'d\x3d"',f,'" style\x3d"',this.getSvgStyles(),'" transform\x3d"',this.getSvgTransform(),c,this.getSvgTransformMatrix(),'" stroke-linecap\x3d"round" ',this.addPaintOrder(),"/\x3e\n");return a?a(b.join("")):b.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],c=[],b,f,e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,d,k=0,u=this.path.length;k<u;k++){b=this.path[k];d=b.slice(1).trim();for(c.length=0;f=e.exec(d);)c.push(f[0]);b=[b.charAt(0)];d=0;for(var y=c.length;d<y;d++)f=parseFloat(c[d]),isNaN(f)||b.push(f);f=b[0];d=g[f.toLowerCase()];y=h[f]||f;if(b.length-1>d)for(var w=1,z=b.length;w<z;w+=d)a.push([f].concat(b.slice(w,w+d))),f=y;else a.push(b)}return a},_parseDimensions:function(){for(var c=[],f=[],d,g=null,k=0,h=0,t=0,u=0,y=0,w=0,z,x,v,D=0,A=this.path.length;D<A;++D){d=this.path[D];switch(d[0]){case "l":t+=d[1];u+=d[2];v=[];break;case "L":t=d[1];u=d[2];v=[];break;case "h":t+=d[1];v=[];break;case "H":t=d[1];v=[];break;case "v":u+=d[1];v=[];break;case "V":u=d[1];v=[];break;case "m":t+=d[1];u+=d[2];k=t;h=u;v=[];break;case "M":t=d[1];u=d[2];k=t;h=u;v=[];break;case "c":z=t+d[5];x=u+d[6];y=t+d[3];w=u+d[4];v=b.util.getBoundsOfCurve(t,u,t+d[1],u+d[2],y,w,z,x);t=z;u=x;break;case "C":y=d[3];w=d[4];v=b.util.getBoundsOfCurve(t,u,d[1],d[2],y,w,d[5],d[6]);t=d[5];u=d[6];break;case "s":z=t+d[3];x=u+d[4];null===g[0].match(/[CcSs]/)?(y=t,w=u):(y=2*t-y,w=2*u-w);v=b.util.getBoundsOfCurve(t,u,y,w,t+d[1],u+d[2],z,x);y=t+d[1];w=u+d[2];t=z;u=x;break;case "S":z=d[3];x=d[4];null===g[0].match(/[CcSs]/)?(y=t,w=u):(y=2*t-y,w=2*u-w);v=b.util.getBoundsOfCurve(t,u,y,w,d[1],d[2],z,x);t=z;u=x;y=d[1];w=d[2];break;case "q":z=t+d[3];x=u+d[4];y=t+d[1];w=u+d[2];v=b.util.getBoundsOfCurve(t,u,y,w,y,w,z,x);t=z;u=x;break;case "Q":y=d[1];w=d[2];v=b.util.getBoundsOfCurve(t,u,y,w,y,w,d[3],d[4]);t=d[3];u=d[4];break;case "t":z=t+d[1];x=u+d[2];null===g[0].match(/[QqTt]/)?(y=t,w=u):(y=2*t-y,w=2*u-w);v=b.util.getBoundsOfCurve(t,u,y,w,y,w,z,x);t=z;u=x;break;case "T":z=d[1];x=d[2];null===g[0].match(/[QqTt]/)?(y=t,w=u):(y=2*t-y,w=2*u-w);v=b.util.getBoundsOfCurve(t,u,y,w,y,w,z,x);t=z;u=x;break;case "a":v=b.util.getBoundsOfArc(t,u,d[1],d[2],d[3],d[4],d[5],d[6]+t,d[7]+u);t+=d[6];u+=d[7];break;case "A":v=b.util.getBoundsOfArc(t,u,d[1],d[2],d[3],d[4],d[5],d[6],d[7]);t=d[6];u=d[7];break;case "z":case "Z":t=k,u=h}g=d;v.forEach(function(a){c.push(a.x);f.push(a.y)});c.push(t);f.push(u)}d=e(c)||0;g=e(f)||0;k=a(c)||0;h=a(f)||0;return{left:d,top:g,width:k-d,height:h-g}}}),b.Path.fromObject=function(a,c){"string"===typeof a.sourcePath?b.loadSVGFromURL(a.sourcePath,function(b){b=b[0];b.setOptions(a);c&&c(b)}):b.Object._fromObject("Path",a,c,"path")},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(a,f,e){a=b.parseAttributes(a,b.Path.ATTRIBUTE_NAMES);f(new b.Path(a.d,c(a,e)))})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=b.util.object.extend,a=b.util.array.min,c=b.util.array.max;b.Group||(b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(a,c,b){c=c||{};this._objects=[];b&&this.callSuper("initialize",c);this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=this;c.originX&&(this.originX=c.originX);c.originY&&(this.originY=c.originY);b?this._updateObjectsACoords():((b=c&&c.centerPoint)||this._calcBounds(),this._updateObjectsCoords(b),delete c.centerPoint,this.callSuper("initialize",c));this.setCoords()},_updateObjectsACoords:function(){for(var a=this._objects.length;a--;)this._objects[a].setCoords(!0,!0)},_updateObjectsCoords:function(a){a=a||this.getCenterPoint();for(var c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],a)},_updateObjectCoords:function(a,c){a.set({left:a.left-c.x,top:a.top-c.y});a.group=this;a.setCoords(!0,!0)},toString:function(){return"#\x3cfabric.Group: ("+this.complexity()+")\x3e"},addWithUpdate:function(a){this._restoreObjectsState();b.util.resetObjectTransform(this);a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas));this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=!0;return this},removeWithUpdate:function(a){this._restoreObjectsState();b.util.resetObjectTransform(this);this.remove(a);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=!0;return this},_onObjectAdded:function(a){this.dirty=!0;a.group=this;a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0;delete a.group},_set:function(a,c){var b=this._objects.length;if(this.useSetOnGroup)for(;b--;)this._objects[b].setOnGroup(a,c);if("canvas"===a)for(b=this._objects.length;b--;)this._objects[b]._set(a,c);this.callSuper("_set",a,c)},toObject:function(a){var c=this.getObjects().map(function(c){var b=c.includeDefaultValues;c.includeDefaultValues=c.group.includeDefaultValues;var f=c.toObject(a);c.includeDefaultValues=b;return f});return e(this.callSuper("toObject",a),{objects:c})},toDatalessObject:function(a){var c;c=(c=this.sourcePath)?c:this.getObjects().map(function(c){var b=c.includeDefaultValues;c.includeDefaultValues=c.group.includeDefaultValues;var f=c.toDatalessObject(a);c.includeDefaultValues=b;return f});return e(this.callSuper("toDatalessObject",a),{objects:c})},render:function(a){this._transformDone=!0;this.callSuper("render",a);this._transformDone=!1},shouldCache:function(){var a=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=a)for(var c=0,b=this._objects.length;c<b;c++)if(this._objects[c].willDrawShadow())return this.ownCaching=!1;return a},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var a=0,c=this._objects.length;a<c;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(a){for(var c=0,b=this._objects.length;c<b;c++)this._objects[c].render(a)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var a=0,c=this._objects.length;a<c;a++)if(this._objects[a].isCacheDirty(!0))return this._cacheCanvas&&(a=this.cacheWidth/this.zoomX,c=this.cacheHeight/this.zoomY,this._cacheContext.clearRect(-a/2,-c/2,a,c)),!0;return!1},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){var c=a.calcTransformMatrix(),c=b.util.qrDecompose(c),f=new b.Point(c.translateX,c.translateY);a.flipX=!1;a.flipY=!1;a.set("scaleX",c.scaleX);a.set("scaleY",c.scaleY);a.skewX=c.skewX;a.skewY=c.skewY;a.angle=c.angle;a.setPositionByOrigin(f,"center","center");return a},_restoreObjectState:function(a){this.realizeTransform(a);a.setCoords();delete a.group;return this},destroy:function(){this._objects.forEach(function(a){a.set("dirty",!0)});return this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var a=this._objects,c=this.canvas;this._objects=[];var e=this.toObject();delete e.objects;var d=new b.ActiveSelection([]);d.set(e);d.type="activeSelection";c.remove(this);a.forEach(function(a){a.group=d;a.dirty=!0;c.add(a)});d.canvas=c;d._objects=a;c._activeObject=d;d.setCoords();return d}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords(!0,!0)});return this},_calcBounds:function(a){for(var c=[],b=[],f,e,d=["tr","br","bl","tl"],n=0,p=this._objects.length,q,r=d.length;n<p;++n)for(f=this._objects[n],f.setCoords(!0),q=0;q<r;q++)e=d[q],c.push(f.oCoords[e].x),b.push(f.oCoords[e].y);this.set(this._getBounds(c,b,a))},_getBounds:function(f,e,d){var g=new b.Point(a(f),a(e));f=new b.Point(c(f),c(e));f={width:f.x-g.x||0,height:f.y-g.y||0};d||(f.left=g.x||0,f.top=g.y||0,"center"===this.originX&&(f.left+=f.width/2),"right"===this.originX&&(f.left+=f.width),"center"===this.originY&&(f.top+=f.height/2),"bottom"===this.originY&&(f.top+=f.height));return f},toSVG:function(a){var c=this._createBaseSVGMarkup();c.push("\x3cg ",this.getSvgId(),'transform\x3d"',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style\x3d"',this.getSvgFilter(),'"\x3e\n');for(var b=0,f=this._objects.length;b<f;b++)c.push("\t",this._objects[b].toSVG(a));c.push("\x3c/g\x3e\n");return a?a(c.join("")):c.join("")}}),b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(f){var e=b.util.object.clone(a,!0);delete e.objects;c&&c(new b.Group(f,e,!0))})})})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={});b.ActiveSelection||(b.ActiveSelection=b.util.createClass(b.Group,{type:"activeSelection",initialize:function(e,a){a=a||{};this._objects=e||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;a.originX&&(this.originX=a.originX);a.originY&&(this.originY=a.originY);this._calcBounds();this._updateObjectsCoords();b.Object.prototype.initialize.call(this,a);this.setCoords()},toGroup:function(){var e=this._objects;this._objects=[];var a=this.toObject(),c=new b.Group([]);delete a.objects;c.set(a);c.type="group";e.forEach(function(a){a.group=c;a.canvas.remove(a)});c._objects=e;if(!this.canvas)return c;e=this.canvas;e.add(c);e._activeObject=c;c.setCoords();return c},onDeselect:function(){this.destroy();return!1},toString:function(){return"#\x3cfabric.ActiveSelection: ("+this.complexity()+")\x3e"},_set:function(e,a){var c=this._objects.length;if("canvas"===e)for(;c--;)this._objects[c].set(e,a);if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(e,a);b.Object.prototype._set.call(this,e,a)},shouldCache:function(){return!1},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var b=0,a=this._objects.length;b<a;b++)if(this._objects[b].willDrawShadow())return!0;return!1},isOnACache:function(){return!1},_renderControls:function(b,a,c){b.save();b.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper("_renderControls",b,a);c=c||{};"undefined"===typeof c.hasControls&&(c.hasControls=!1);"undefined"===typeof c.hasRotatingPoint&&(c.hasRotatingPoint=!1);c.forActiveSelection=!0;a=0;for(var f=this._objects.length;a<f;a++)this._objects[a]._renderControls(b,c);b.restore()}}),b.ActiveSelection.fromObject=function(e,a){b.util.enlivenObjects(e.objects,function(c){delete e.objects;a&&a(new b.ActiveSelection(c,e,!0))})})})("undefined"!==typeof exports?exports:this);(function(d){var b=fabric.util.object.extend;d.fabric||(d.fabric={});d.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),objectCaching:!1,cacheKey:"",cropX:0,cropY:0,initialize:function(b,a){a||(a={});this.filters=[];this.cacheKey="texture"+fabric.Object.__uid++;this.callSuper("initialize",a);this._initElement(b,a)},getElement:function(){return this._element},setElement:function(b,a){var c=fabric.filterBackend;c&&c.evictCachesForKey&&(c.evictCachesForKey(this.cacheKey),c.evictCachesForKey(this.cacheKey+"_filtered"));this._originalElement=this._element=b;this._initConfig(a);this.resizeFilter&&this.applyResizeFilters();0!==this.filters.length&&this.applyFilters();return this},dispose:function(){var b=fabric.filterBackend;b&&b.evictCachesForKey&&(b.evictCachesForKey(this.cacheKey),b.evictCachesForKey(this.cacheKey+"_filtered"));this._filteredEl=this._element=this._originalElement=void 0},setCrossOrigin:function(b){this.crossOrigin=b;this._element.crossOrigin=b;return this},getOriginalSize:function(){var b=this.getElement();return{width:b.width,height:b.height}},_stroke:function(b){if(this.stroke&&0!==this.strokeWidth){var a=this.width/2,c=this.height/2;b.beginPath();b.moveTo(-a,-c);b.lineTo(a,-c);b.lineTo(a,c);b.lineTo(-a,c);b.lineTo(-a,-c);b.closePath()}},_renderDashedStroke:function(b){var a=-this.width/2,c=-this.height/2,f=this.width,e=this.height;b.save();this._setStrokeStyles(b,this);b.beginPath();fabric.util.drawDashedLine(b,a,c,a+f,c,this.strokeDashArray);fabric.util.drawDashedLine(b,a+f,c,a+f,c+e,this.strokeDashArray);fabric.util.drawDashedLine(b,a+f,c+e,a,c+e,this.strokeDashArray);fabric.util.drawDashedLine(b,a,c+e,a,c,this.strokeDashArray);b.closePath();b.restore()},toObject:function(e){var a=[];this.filters.forEach(function(c){c&&a.push(c.toObject())});e=b(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(e)),{src:this.getSrc(),filters:a});this.resizeFilter&&(e.resizeFilter=this.resizeFilter.toObject());return e},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=-this.width/2,f=-this.height/2,e="";this.hasCrop()&&(e=fabric.Object.__uid++,a.push('\x3cclipPath id\x3d"imageCrop_'+e+'"\x3e\n','\t\x3crect x\x3d"'+c+'" y\x3d"'+f+'" width\x3d"'+this.width+'" height\x3d"'+this.height+'" /\x3e\n',"\x3c/clipPath\x3e\n"),e=' clip-path\x3d"url(#imageCrop_'+e+')" ');a.push('\x3cg transform\x3d"',this.getSvgTransform(),this.getSvgTransformMatrix(),'"\x3e\n');e=["\t\x3cimage ",this.getSvgId(),'xlink:href\x3d"',this.getSvgSrc(!0),'" x\x3d"',c-this.cropX,'" y\x3d"',f-this.cropY,'" style\x3d"',this.getSvgStyles(),'" width\x3d"',this._element.width||this._element.naturalWidth,'" height\x3d"',this._element.height||this._element.height,'"',e,"\x3e\x3c/image\x3e\n"];"fill"===this.paintFirst&&Array.prototype.push.apply(a,e);if(this.stroke||this.strokeDashArray){var d=this.fill;this.fill=null;a.push("\t\x3crect ",'x\x3d"',c,'" y\x3d"',f,'" width\x3d"',this.width,'" height\x3d"',this.height,'" style\x3d"',this.getSvgStyles(),'"/\x3e\n');this.fill=d}"fill"!==this.paintFirst&&Array.prototype.push.apply(a,e);a.push("\x3c/g\x3e\n");return b?b(a.join("")):a.join("")},getSrc:function(b){return(b=b?this._element:this._originalElement)?b.toDataURL?b.toDataURL():b.src:this.src||""},setSrc:function(b,a,c){fabric.util.loadImage(b,function(b){this.setElement(b,c);this._setWidthHeight();a(this)},this,c&&c.crossOrigin);return this},toString:function(){return'#\x3cfabric.Image: { src: "'+this.getSrc()+'" }\x3e'},applyResizeFilters:function(){var b=this.resizeFilter,a=this.canvas?this.canvas.getRetinaScaling():1,c=this.minimumScaleTrigger,f=this.scaleX*a,a=this.scaleY*a,d=this._filteredEl||this._originalElement;this.group&&this.set("dirty",!0);if(!b||f>c&&a>c)this._element=d,this._filterScalingY=this._filterScalingX=1;else{fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var c=fabric.util.createCanvasElement(),g=this._filteredEl?this.cacheKey:this.cacheKey+"_filtered",h=d.width,l=d.height;c.width=h;c.height=l;this._element=c;b.scaleX=f;b.scaleY=a;fabric.filterBackend.applyFilters([b],d,h,l,this._element,g);this._filterScalingX=c.width/this._originalElement.width;this._filterScalingY=c.height/this._originalElement.height}},applyFilters:function(b){b=b||this.filters||[];b=b.filter(function(a){return a});this.group&&this.set("dirty",!0);if(0===b.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingY=this._filterScalingX=1,this;var a=this._originalElement,c=a.naturalWidth||a.width,a=a.naturalHeight||a.height;if(this._element===this._originalElement){var f=fabric.util.createCanvasElement();f.width=c;f.height=a;this._filteredEl=this._element=f}else this._element.getContext("2d").clearRect(0,0,c,a);fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());fabric.filterBackend.applyFilters(b,this._originalElement,c,a,this._element,this.cacheKey);if(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height;return this},_render:function(b){!1===this.isMoving&&this.resizeFilter&&this._needsResize()&&(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,this.applyResizeFilters());this._stroke(b);this._renderPaintInOrder(b)},_renderFill:function(b){var a=this.width,c=this.height,f=a*this._filterScalingX,e=c*this._filterScalingY,d=this._element;d&&b.drawImage(d,this.cropX*this._filterScalingX,this.cropY*this._filterScalingY,f,e,-a/2,-c/2,a,c)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_resetWidthHeight:function(){var b=this.getElement();this.set("width",b.width);this.set("height",b.height)},_initElement:function(b,a){this.setElement(fabric.util.getById(b),a);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(b){b||(b={});this.setOptions(b);this._setWidthHeight(b);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(b,a){b&&b.length?fabric.util.enlivenObjects(b,function(c){a&&a(c)},"fabric.Image.filters"):a&&a()},_setWidthHeight:function(b){this.width=b&&"width"in b?b.width:this.getElement()?this.getElement().width||0:0;this.height=b&&"height"in b?b.height:this.getElement()?this.getElement().height||0:0},parsePreserveAspectRatioAttribute:function(){var b=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),a=this._element.width,c=this._element.height,f=1,d=1,g=0,h=0,l=0,m=0,n,p=this.width,q=this.height,r={width:p,height:q};!b||"none"===b.alignX&&"none"===b.alignY?(f=p/a,d=q/c):("meet"===b.meetOrSlice&&(f=d=fabric.util.findScaleToFit(this._element,r),n=(p-a*f)/2,"Min"===b.alignX&&(g=-n),"Max"===b.alignX&&(g=n),n=(q-c*d)/2,"Min"===b.alignY&&(h=-n),"Max"===b.alignY&&(h=n)),"slice"===b.meetOrSlice&&(f=d=fabric.util.findScaleToCover(this._element,r),n=a-p/f,"Mid"===b.alignX&&(l=n/2),"Max"===b.alignX&&(l=n),n=c-q/d,"Mid"===b.alignY&&(m=n/2),"Max"===b.alignY&&(m=n),a=p/f,c=q/d));return{width:a,height:c,scaleX:f,scaleY:d,offsetLeft:g,offsetTop:h,cropX:l,cropY:m}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(b,a){var c=fabric.util.object.clone(b);fabric.util.loadImage(c.src,function(b,e){e?a&&a(null,e):fabric.Image.prototype._initFilters.call(c,c.filters,function(f){c.filters=f||[];fabric.Image.prototype._initFilters.call(c,[c.resizeFilter],function(f){c.resizeFilter=f[0];f=new fabric.Image(b,c);a(f)})})},null,c.crossOrigin)},fabric.Image.fromURL=function(b,a,c){fabric.util.loadImage(b,function(b){a&&a(new fabric.Image(b,c))},null,c&&c.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),fabric.Image.fromElement=function(e,a,c){e=fabric.parseAttributes(e,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],a,b(c?fabric.util.object.clone(c):{},e))})})("undefined"!==typeof exports?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.angle%360;return 0<d?90*Math.round((d-1)/90):90*Math.round(d/90)},straighten:function(){this.rotate(this._getAngleValueForStraighten());return this},fxStraighten:function(d){d=d||{};var b=function(){},e=d.onComplete||b,a=d.onChange||b,c=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(b){c.rotate(b);a()},onComplete:function(){c.setCoords();e()}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(d){d.straighten();this.requestRenderAll();return this},fxStraightenObject:function(d){d.fxStraighten({onChange:this.requestRenderAllBound});return this}});(function(){function d(b){b&&b.tileSize&&(this.tileSize=b.tileSize);this.setupGLContext(this.tileSize,this.tileSize);this.captureGPUInfo()}fabric.isWebglSupported=function(b){if(fabric.isLikelyNode)return!1;b=b||fabric.WebglFilterBackend.prototype.tileSize;var e=document.createElement("canvas"),e=e.getContext("webgl")||e.getContext("experimental-webgl"),a=!1;if(e){fabric.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE);a=fabric.maxTextureSize>=b;b=["highp","mediump","lowp"];for(var c=0;3>c;c++){var f;f=e;var d="precision "+b[c]+" float;\nvoid main(){}",g=f.createShader(f.FRAGMENT_SHADER);f.shaderSource(g,d);f.compileShader(g);f=f.getShaderParameter(g,f.COMPILE_STATUS)?!0:!1;if(f){fabric.webGlPrecision=b[c];break}}}return this.isSupported=a};fabric.WebglFilterBackend=d;d.prototype={tileSize:2048,resources:{},setupGLContext:function(b,e){this.dispose();this.createWebGLCanvas(b,e);this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]);this.chooseFastestCopyGLTo2DMethod(b,e)},chooseFastestCopyGLTo2DMethod:function(b,e){var a="undefined"!==typeof window.performance,c;try{new ImageData(1,1),c=!0}catch(g){c=!1}var f="undefined"!==typeof ArrayBuffer,d="undefined"!==typeof Uint8ClampedArray;a&&c&&f&&d&&(f=fabric.util.createCanvasElement(),a=new ArrayBuffer(b*e*4),c={imageBuffer:a,destinationWidth:b,destinationHeight:e,targetCanvas:f},f.width=b,f.height=e,d=window.performance.now(),copyGLTo2DDrawImage.call(c,this.gl,c),f=window.performance.now()-d,d=window.performance.now(),copyGLTo2DPutImageData.call(c,this.gl,c),c=window.performance.now()-d,f>c?(this.imageBuffer=a,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage)},createWebGLCanvas:function(b,e){var a=fabric.util.createCanvasElement();a.width=b;a.height=e;var c={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},f=a.getContext("webgl",c);f||(f=a.getContext("experimental-webgl",c));f&&(f.clearColor(0,0,0,0),this.canvas=a,this.gl=f)},applyFilters:function(b,e,a,c,f,d){var g=this.gl,k;d&&(k=this.getCachedTexture(d,e));var l={originalWidth:e.width||e.originalWidth,originalHeight:e.height||e.originalHeight,sourceWidth:a,sourceHeight:c,destinationWidth:a,destinationHeight:c,context:g,sourceTexture:this.createTexture(g,a,c,!k&&e),targetTexture:this.createTexture(g,a,c),originalTexture:k||this.createTexture(g,a,c,!k&&e),passes:b.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:f};e=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,e);b.forEach(function(a){a&&a.applyTo(l)});resizeCanvasIfNeeded(l);this.copyGLTo2D(g,l);g.bindTexture(g.TEXTURE_2D,null);g.deleteTexture(l.sourceTexture);g.deleteTexture(l.targetTexture);g.deleteFramebuffer(e);f.getContext("2d").setTransform(1,0,0,1,0,0);return l},applyFiltersDebug:function(b,e,a,c,f,d){var g=this.gl;e=this.applyFilters(b,e,a,c,f,d);b=g.getError();if(b!==g.NO_ERROR)throw g=this.glErrorToString(g,b),g=Error("WebGL Error "+g),g.glErrorCode=b,g;return e},glErrorToString:function(b,e){if(!b)return"Context undefined for error code: "+e;if("number"!==typeof e)return"Error code is not a number";switch(e){case b.NO_ERROR:return"NO_ERROR";case b.INVALID_ENUM:return"INVALID_ENUM";case b.INVALID_VALUE:return"INVALID_VALUE";case b.INVALID_OPERATION:return"INVALID_OPERATION";case b.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case b.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case b.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"UNKNOWN_ERROR"}},dispose:function(){this.canvas&&(this.gl=this.canvas=null);this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={};this.textureCache={}},createTexture:function(b,e,a,c){var f=b.createTexture();b.bindTexture(b.TEXTURE_2D,f);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);c?b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,e,a,0,b.RGBA,b.UNSIGNED_BYTE,null);return f},getCachedTexture:function(b,e){if(this.textureCache[b])return this.textureCache[b];var a=this.createTexture(this.gl,e.width,e.height,e);return this.textureCache[b]=a},evictCachesForKey:function(b){this.textureCache[b]&&(this.gl.deleteTexture(this.textureCache[b]),delete this.textureCache[b])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var b=this.gl,e=b.getExtension("WEBGL_debug_renderer_info"),a={renderer:"",vendor:""};if(e){var c=b.getParameter(e.UNMASKED_RENDERER_WEBGL),b=b.getParameter(e.UNMASKED_VENDOR_WEBGL);c&&(a.renderer=c.toLowerCase());b&&(a.vendor=b.toLowerCase())}return this.gpuInfo=a}}})();function resizeCanvasIfNeeded(d){var b=d.targetCanvas,e=b.height,a=d.destinationWidth;d=d.destinationHeight;if(b.width!==a||e!==d)b.width=a,b.height=d}function copyGLTo2DDrawImage(d,b){var e=d.canvas,a=b.targetCanvas,c=a.getContext("2d");c.translate(0,a.height);c.scale(1,-1);c.drawImage(e,0,e.height-a.height,a.width,a.height,0,0,a.width,a.height)}function copyGLTo2DPutImageData(d,b){var e=b.targetCanvas.getContext("2d"),a=b.destinationWidth,c=b.destinationHeight,f=a*c*4,k=new Uint8Array(this.imageBuffer,0,f),f=new Uint8ClampedArray(this.imageBuffer,0,f);d.readPixels(0,0,a,c,d.RGBA,d.UNSIGNED_BYTE,k);a=new ImageData(f,a,c);e.putImageData(a,0,0)}(function(){function d(){}var b=function(){};fabric.Canvas2dFilterBackend=d;d.prototype={evictCachesForKey:b,dispose:b,clearWebGLCaches:b,resources:{},applyFilters:function(b,a,c,f,d){var e=d.getContext("2d");e.drawImage(a,0,0,c,f);var k=e.getImageData(0,0,c,f),l=e.getImageData(0,0,c,f),m={sourceWidth:c,sourceHeight:f,imageData:k,originalEl:a,originalImageData:l,canvasEl:d,ctx:e,filterBackend:this};b.forEach(function(a){a.applyTo(m)});if(m.imageData.width!==c||m.imageData.height!==f)d.width=m.imageData.width,d.height=m.imageData.height;e.putImageData(m.imageData,0,0);return m}}})();fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord \x3d aPosition;\ngl_Position \x3d vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor \x3d texture2D(uTexture, vTexCoord);\n}",initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var b in d)this[b]=d[b]},createProgram:function(d,b,e){b=b||this.fragmentSource;e=e||this.vertexSource;"highp"!==fabric.webGlPrecision&&(b=b.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var a=d.createShader(d.VERTEX_SHADER);d.shaderSource(a,e);d.compileShader(a);if(!d.getShaderParameter(a,d.COMPILE_STATUS))throw Error("Vertex shader compile error for "+this.type+": "+d.getShaderInfoLog(a));e=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(e,b);d.compileShader(e);if(!d.getShaderParameter(e,d.COMPILE_STATUS))throw Error("Fragment shader compile error for "+this.type+": "+d.getShaderInfoLog(e));b=d.createProgram();d.attachShader(b,a);d.attachShader(b,e);d.linkProgram(b);if(!d.getProgramParameter(b,d.LINK_STATUS))throw Error('Shader link error for "${this.type}" '+d.getProgramInfoLog(b));a=this.getAttributeLocations(d,b);e=this.getUniformLocations(d,b)||{};e.uStepW=d.getUniformLocation(b,"uStepW");e.uStepH=d.getUniformLocation(b,"uStepH");return{program:b,attributeLocations:a,uniformLocations:e}},getAttributeLocations:function(d,b){return{aPosition:d.getAttribLocation(b,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(d,b,e){b=b.aPosition;var a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW)},_setupFrameBuffer:function(d){var b=d.context,e,a;if(1<d.passes){e=d.destinationWidth;a=d.destinationHeight;if(d.sourceWidth!==e||d.sourceHeight!==a)b.deleteTexture(d.targetTexture),d.targetTexture=d.filterBackend.createTexture(b,e,a);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d.targetTexture,0)}else b.bindFramebuffer(b.FRAMEBUFFER,null),b.finish()},_swapTextures:function(d){d.passes--;d.pass++;var b=d.targetTexture;d.targetTexture=d.sourceTexture;d.sourceTexture=b},isNeutralState:function(){return!1},applyTo:function(d){d.webgl?1<d.passes&&this.isNeutralState(d)||(this._setupFrameBuffer(d),this.applyToWebGL(d),this._swapTextures(d)):this.isNeutralState()||this.applyTo2d(d)},retrieveShader:function(d){d.programCache.hasOwnProperty(this.type)||(d.programCache[this.type]=this.createProgram(d.context));return d.programCache[this.type]},applyToWebGL:function(d){var b=d.context,e=this.retrieveShader(d);0===d.pass&&d.originalTexture?b.bindTexture(b.TEXTURE_2D,d.originalTexture):b.bindTexture(b.TEXTURE_2D,d.sourceTexture);b.useProgram(e.program);this.sendAttributeData(b,e.attributeLocations,d.aPosition);b.uniform1f(e.uniformLocations.uStepW,1/d.sourceWidth);b.uniform1f(e.uniformLocations.uStepH,1/d.sourceHeight);this.sendUniformData(b,e.uniformLocations);b.viewport(0,0,d.destinationWidth,d.destinationHeight);b.drawArrays(b.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(d,b,e){d.activeTexture(e);d.bindTexture(d.TEXTURE_2D,b);d.activeTexture(d.TEXTURE0)},unbindAdditionalTexture:function(d,b){d.activeTexture(b);d.bindTexture(d.TEXTURE_2D,null);d.activeTexture(d.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(d){this[this.mainParameter]=d},sendUniformData:function(){},createHelpLayer:function(d){if(!d.helpLayer){var b=document.createElement("canvas");b.width=d.sourceWidth;b.height=d.sourceHeight;d.helpLayer=b}},toObject:function(){var d={type:this.type},b=this.mainParameter;b&&(d[b]=this[b]);return d},toJSON:function(){return this.toObject()}});fabric.Image.filters.BaseFilter.fromObject=function(d,b){var e=new fabric.Image.filters[d.type](d);b&&b(e);return e};(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass;b.ColorMatrix=e(b.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\ncolor *\x3d uColorMatrix;\ncolor +\x3d uConstants;\ngl_FragColor \x3d color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(a){this.callSuper("initialize",a);this.matrix=this.matrix.slice(0)},isNeutralState:function(){for(var a=b.ColorMatrix,c=20;c--;)if(this.matrix[c]!==a.prototype.matrix[c])return!1;return!0},applyTo2d:function(a){a=a.imageData.data;var c=a.length,b=this.matrix,e,d,h,l,m,n=this.colorsOnly;for(m=0;m<c;m+=4)e=a[m],d=a[m+1],h=a[m+2],n?(a[m]=e*b[0]+d*b[1]+h*b[2]+255*b[4],a[m+1]=e*b[5]+d*b[6]+h*b[7]+255*b[9],a[m+2]=e*b[10]+d*b[11]+h*b[12]+255*b[14]):(l=a[m+3],a[m]=e*b[0]+d*b[1]+h*b[2]+l*b[3]+255*b[4],a[m+1]=e*b[5]+d*b[6]+h*b[7]+l*b[8]+255*b[9],a[m+2]=e*b[10]+d*b[11]+h*b[12]+l*b[13]+255*b[14],a[m+3]=e*b[15]+d*b[16]+h*b[17]+l*b[18]+255*b[19])},getUniformLocations:function(a,c){return{uColorMatrix:a.getUniformLocation(c,"uColorMatrix"),uConstants:a.getUniformLocation(c,"uConstants")}},sendUniformData:function(a,c){var b=this.matrix,e=[b[4],b[9],b[14],b[19]];a.uniformMatrix4fv(c.uColorMatrix,!1,[b[0],b[1],b[2],b[3],b[5],b[6],b[7],b[8],b[10],b[11],b[12],b[13],b[15],b[16],b[17],b[18]]);a.uniform4fv(c.uConstants,e)}});d.Image.filters.ColorMatrix.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass;b.Brightness=e(b.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\ncolor.rgb +\x3d uBrightness;\ngl_FragColor \x3d color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(a){if(0!==this.brightness){a=a.imageData.data;var c,b=a.length,e=Math.round(255*this.brightness);for(c=0;c<b;c+=4)a[c]+=e,a[c+1]+=e,a[c+2]+=e}},getUniformLocations:function(a,c){return{uBrightness:a.getUniformLocation(c,"uBrightness")}},sendUniformData:function(a,c){a.uniform1f(c.uBrightness,this.brightness)}});d.Image.filters.Brightness.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.util.object.extend,e=d.Image.filters,a=d.util.createClass;e.Convolute=a(e.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d vec4(0, 0, 0, 0);\nfor (float h \x3d 0.0; h \x3c 3.0; h+\x3d1.0) {\nfor (float w \x3d 0.0; w \x3c 3.0; w+\x3d1.0) {\nvec2 matrixPos \x3d vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor +\x3d texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor \x3d color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d vec4(0, 0, 0, 1);\nfor (float h \x3d 0.0; h \x3c 3.0; h+\x3d1.0) {\nfor (float w \x3d 0.0; w \x3c 3.0; w+\x3d1.0) {\nvec2 matrixPos \x3d vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb +\x3d texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha \x3d texture2D(uTexture, vTexCoord).a;\ngl_FragColor \x3d color;\ngl_FragColor.a \x3d alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d vec4(0, 0, 0, 0);\nfor (float h \x3d 0.0; h \x3c 5.0; h+\x3d1.0) {\nfor (float w \x3d 0.0; w \x3c 5.0; w+\x3d1.0) {\nvec2 matrixPos \x3d vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor +\x3d texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor \x3d color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d vec4(0, 0, 0, 1);\nfor (float h \x3d 0.0; h \x3c 5.0; h+\x3d1.0) {\nfor (float w \x3d 0.0; w \x3c 5.0; w+\x3d1.0) {\nvec2 matrixPos \x3d vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb +\x3d texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha \x3d texture2D(uTexture, vTexCoord).a;\ngl_FragColor \x3d color;\ngl_FragColor.a \x3d alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d vec4(0, 0, 0, 0);\nfor (float h \x3d 0.0; h \x3c 7.0; h+\x3d1.0) {\nfor (float w \x3d 0.0; w \x3c 7.0; w+\x3d1.0) {\nvec2 matrixPos \x3d vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor +\x3d texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor \x3d color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d vec4(0, 0, 0, 1);\nfor (float h \x3d 0.0; h \x3c 7.0; h+\x3d1.0) {\nfor (float w \x3d 0.0; w \x3c 7.0; w+\x3d1.0) {\nvec2 matrixPos \x3d vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb +\x3d texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha \x3d texture2D(uTexture, vTexCoord).a;\ngl_FragColor \x3d color;\ngl_FragColor.a \x3d alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d vec4(0, 0, 0, 0);\nfor (float h \x3d 0.0; h \x3c 9.0; h+\x3d1.0) {\nfor (float w \x3d 0.0; w \x3c 9.0; w+\x3d1.0) {\nvec2 matrixPos \x3d vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor +\x3d texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor \x3d color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d vec4(0, 0, 0, 1);\nfor (float h \x3d 0.0; h \x3c 9.0; h+\x3d1.0) {\nfor (float w \x3d 0.0; w \x3c 9.0; w+\x3d1.0) {\nvec2 matrixPos \x3d vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb +\x3d texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha \x3d texture2D(uTexture, vTexCoord).a;\ngl_FragColor \x3d color;\ngl_FragColor.a \x3d alpha;\n}"},retrieveShader:function(a){var c=this.type+"_"+Math.sqrt(this.matrix.length)+"_"+(this.opaque?1:0),b=this.fragmentSource[c];a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,b));return a.programCache[c]},applyTo2d:function(a){var c=a.imageData,b=c.data,e=this.matrix,d=Math.round(Math.sqrt(e.length)),l=Math.floor(d/2),m=c.width,c=c.height,n=a.ctx.createImageData(m,c),p=n.data,q=this.opaque?1:0,r,t,u,y,w,z,x,v,D,A,B;for(D=0;D<c;D++)for(v=0;v<m;v++){w=4*(D*m+v);for(B=y=u=t=r=0;B<d;B++)for(A=0;A<d;A++)x=D+B-l,z=v+A-l,0>x||x>c||0>z||z>m||(z=4*(x*m+z),x=e[B*d+A],r+=b[z]*x,t+=b[z+1]*x,u+=b[z+2]*x,q||(y+=b[z+3]*x));p[w]=r;p[w+1]=t;p[w+2]=u;p[w+3]=q?b[w+3]:y}a.imageData=n},getUniformLocations:function(a,b){return{uMatrix:a.getUniformLocation(b,"uMatrix"),uOpaque:a.getUniformLocation(b,"uOpaque"),uHalfSize:a.getUniformLocation(b,"uHalfSize"),uSize:a.getUniformLocation(b,"uSize")}},sendUniformData:function(a,b){a.uniform1fv(b.uMatrix,this.matrix)},toObject:function(){return b(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});d.Image.filters.Convolute.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass;b.Grayscale=e(b.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\nfloat average \x3d (color.r + color.b + color.g) / 3.0;\ngl_FragColor \x3d vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col \x3d texture2D(uTexture, vTexCoord);\nfloat average \x3d (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor \x3d vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col \x3d texture2D(uTexture, vTexCoord);\nfloat average \x3d 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor \x3d vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(a){a=a.imageData.data;var c,b=a.length,e,d=this.mode;for(c=0;c<b;c+=4)"average"===d?e=(a[c]+a[c+1]+a[c+2])/3:"lightness"===d?e=(Math.min(a[c],a[c+1],a[c+2])+Math.max(a[c],a[c+1],a[c+2]))/2:"luminosity"===d&&(e=.21*a[c]+.72*a[c+1]+.07*a[c+2]),a[c]=e,a[c+1]=e,a[c+2]=e},retrieveShader:function(a){var c=this.type+"_"+this.mode;a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,this.fragmentSource[this.mode]));return a.programCache[c]},getUniformLocations:function(a,c){return{uMode:a.getUniformLocation(c,"uMode")}},sendUniformData:function(a,c){a.uniform1i(c.uMode,1)}});d.Image.filters.Grayscale.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass;b.Invert=e(b.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\nif (uInvert \x3d\x3d 1) {\ngl_FragColor \x3d vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor \x3d color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(a){if(this.invert){a=a.imageData.data;var c,b=a.length;for(c=0;c<b;c+=4)a[c]=255-a[c],a[c+1]=255-a[c+1],a[c+2]=255-a[c+2]}},getUniformLocations:function(a,c){return{uInvert:a.getUniformLocation(c,"uInvert")}},sendUniformData:function(a,c){a.uniform1i(c.uInvert,this.invert)}});d.Image.filters.Invert.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.util.object.extend,e=d.Image.filters,a=d.util.createClass;e.Noise=a(e.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\ncolor.rgb +\x3d (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor \x3d color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(a){if(0!==this.noise){a=a.imageData.data;var c,b,e=this.noise,d;c=0;for(b=a.length;c<b;c+=4)d=(.5-Math.random())*e,a[c]+=d,a[c+1]+=d,a[c+2]+=d}},getUniformLocations:function(a,b){return{uNoise:a.getUniformLocation(b,"uNoise"),uSeed:a.getUniformLocation(b,"uSeed")}},sendUniformData:function(a,b){a.uniform1f(b.uNoise,this.noise/255);a.uniform1f(b.uSeed,Math.random())},toObject:function(){return b(this.callSuper("toObject"),{noise:this.noise})}});d.Image.filters.Noise.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass;b.Pixelate=e(b.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW \x3d uBlocksize * uStepW;\nfloat blockH \x3d uBlocksize * uStepW;\nint posX \x3d int(vTexCoord.x / blockW);\nint posY \x3d int(vTexCoord.y / blockH);\nfloat fposX \x3d float(posX);\nfloat fposY \x3d float(posY);\nvec2 squareCoords \x3d vec2(fposX * blockW, fposY * blockH);\nvec4 color \x3d texture2D(uTexture, squareCoords);\ngl_FragColor \x3d color;\n}",applyTo2d:function(a){if(1!==this.blocksize){var c=a.imageData;a=c.data;var b=c.height,c=c.width,e,d,h,l,m,n,p,q,r,t,u;for(d=0;d<b;d+=this.blocksize)for(h=0;h<c;h+=this.blocksize)for(e=4*d*c+4*h,l=a[e],m=a[e+1],n=a[e+2],p=a[e+3],t=Math.min(d+this.blocksize,b),u=Math.min(h+this.blocksize,c),q=d;q<t;q++)for(r=h;r<u;r++)e=4*q*c+4*r,a[e]=l,a[e+1]=m,a[e+2]=n,a[e+3]=p}},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(a,c){return{uBlocksize:a.getUniformLocation(c,"uBlocksize"),uStepW:a.getUniformLocation(c,"uStepW"),uStepH:a.getUniformLocation(c,"uStepH")}},sendUniformData:function(a,c){a.uniform1f(c.uBlocksize,this.blocksize)}});d.Image.filters.Pixelate.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=b.util.object.extend;d=b.Image.filters;var a=b.util.createClass;d.RemoveColor=a(d.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor \x3d texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) \x26\x26 all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a \x3d 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(a){a=a.imageData.data;var c;c=255*this.distance;var e,d,h;e=(new b.Color(this.color)).getSource();var l=[e[0]-c,e[1]-c,e[2]-c],m=[e[0]+c,e[1]+c,e[2]+c];for(c=0;c<a.length;c+=4)e=a[c],d=a[c+1],h=a[c+2],e>l[0]&&d>l[1]&&h>l[2]&&e<m[0]&&d<m[1]&&h<m[2]&&(a[c+3]=0)},getUniformLocations:function(a,b){return{uLow:a.getUniformLocation(b,"uLow"),uHigh:a.getUniformLocation(b,"uHigh")}},sendUniformData:function(a,e){var c=(new b.Color(this.color)).getSource(),f=parseFloat(this.distance),d=[c[0]/255+f,c[1]/255+f,c[2]/255+f,1];a.uniform4fv(e.uLow,[0+c[0]/255-f,0+c[1]/255-f,0+c[2]/255-f,1]);a.uniform4fv(e.uHigh,d)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color,distance:this.distance})}});b.Image.filters.RemoveColor.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass,a={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]},c;for(c in a)b[c]=e(b.ColorMatrix,{type:c,matrix:a[c],mainParameter:!1,colorsOnly:!0}),d.Image.filters[c].fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric;d=b.Image.filters;var e=b.util.createClass;d.BlendColor=e(d.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *\x3d uColor.rgb;\n",screen:"gl_FragColor.rgb \x3d 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb +\x3d uColor.rgb;\n",diff:"gl_FragColor.rgb \x3d abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -\x3d uColor.rgb;\n",lighten:"gl_FragColor.rgb \x3d max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb \x3d min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb +\x3d uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r \x3c 0.5) {\ngl_FragColor.r *\x3d 2.0 * uColor.r;\n} else {\ngl_FragColor.r \x3d 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g \x3c 0.5) {\ngl_FragColor.g *\x3d 2.0 * uColor.g;\n} else {\ngl_FragColor.g \x3d 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b \x3c 0.5) {\ngl_FragColor.b *\x3d 2.0 * uColor.b;\n} else {\ngl_FragColor.b \x3d 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *\x3d (1.0 - uColor.a);\ngl_FragColor.rgb +\x3d uColor.rgb;\n"},buildSource:function(a){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\ngl_FragColor \x3d color;\nif (color.a \x3e 0.0) {\n"+this.fragmentSource[a]+"}\n}"},retrieveShader:function(a){var c=this.type+"_"+this.mode,b;a.programCache.hasOwnProperty(c)||(b=this.buildSource(this.mode),a.programCache[c]=this.createProgram(a.context,b));return a.programCache[c]},applyTo2d:function(a){a=a.imageData.data;var c=a.length,e,d,g,h,l,m,n=1-this.alpha;g=(new b.Color(this.color)).getSource();e=g[0]*this.alpha;d=g[1]*this.alpha;g=g[2]*this.alpha;for(var p=0;p<c;p+=4)switch(h=a[p],l=a[p+1],m=a[p+2],this.mode){case "multiply":a[p]=h*e/255;a[p+1]=l*d/255;a[p+2]=m*g/255;break;case "screen":a[p]=255-(255-h)*(255-e)/255;a[p+1]=255-(255-l)*(255-d)/255;a[p+2]=255-(255-m)*(255-g)/255;break;case "add":a[p]=h+e;a[p+1]=l+d;a[p+2]=m+g;break;case "diff":case "difference":a[p]=Math.abs(h-e);a[p+1]=Math.abs(l-d);a[p+2]=Math.abs(m-g);break;case "subtract":a[p]=h-e;a[p+1]=l-d;a[p+2]=m-g;break;case "darken":a[p]=Math.min(h,e);a[p+1]=Math.min(l,d);a[p+2]=Math.min(m,g);break;case "lighten":a[p]=Math.max(h,e);a[p+1]=Math.max(l,d);a[p+2]=Math.max(m,g);break;case "overlay":a[p]=128>e?2*h*e/255:255-2*(255-h)*(255-e)/255;a[p+1]=128>d?2*l*d/255:255-2*(255-l)*(255-d)/255;a[p+2]=128>g?2*m*g/255:255-2*(255-m)*(255-g)/255;break;case "exclusion":a[p]=e+h-2*e*h/255;a[p+1]=d+l-2*d*l/255;a[p+2]=g+m-2*g*m/255;break;case "tint":a[p]=e+h*n,a[p+1]=d+l*n,a[p+2]=g+m*n}},getUniformLocations:function(a,c){return{uColor:a.getUniformLocation(c,"uColor")}},sendUniformData:function(a,c){var e=(new b.Color(this.color)).getSource();e[0]=this.alpha*e[0]/255;e[1]=this.alpha*e[1]/255;e[2]=this.alpha*e[2]/255;e[3]=this.alpha;a.uniform4fv(c.uColor,e)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}});b.Image.filters.BlendColor.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric;d=b.Image.filters;var e=b.util.createClass;d.BlendImage=e(d.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord \x3d aPosition;\nvTexCoord2 \x3d (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position \x3d vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\nvec4 color2 \x3d texture2D(uImage, vTexCoord2);\ncolor.rgba *\x3d color2.rgba;\ngl_FragColor \x3d color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\nvec4 color2 \x3d texture2D(uImage, vTexCoord2);\ncolor.a \x3d color2.a;\ngl_FragColor \x3d color;\n}"},retrieveShader:function(a){var c=this.type+"_"+this.mode,b=this.fragmentSource[this.mode];a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,b));return a.programCache[c]},applyToWebGL:function(a){var c=a.context,b=this.createTexture(a.filterBackend,this.image);this.bindAdditionalTexture(c,b,c.TEXTURE1);this.callSuper("applyToWebGL",a);this.unbindAdditionalTexture(c,c.TEXTURE1)},createTexture:function(a,c){return a.getCachedTexture(c.cacheKey,c._element)},calculateMatrix:function(){var a=this.image;return[1/a.scaleX,0,0,0,1/a.scaleY,0,-a.left/a._element.width,-a.top/a._element.height,1]},applyTo2d:function(a){var c=a.filterBackend.resources,b=a.imageData.data,e=b.length,d=a.imageData.width;a=a.imageData.height;var h,l,m,n,p;h=this.image;var q;c.blendImage||(c.blendImage=document.createElement("canvas"));c=c.blendImage;if(c.width!==d||c.height!==a)c.width=d,c.height=a;c=c.getContext("2d");c.setTransform(h.scaleX,0,0,h.scaleY,h.left,h.top);c.drawImage(h._element,0,0,d,a);q=c.getImageData(0,0,d,a).data;for(var r=0;r<e;r+=4)switch(l=b[r],m=b[r+1],n=b[r+2],p=b[r+3],d=q[r],a=q[r+1],h=q[r+2],c=q[r+3],this.mode){case "multiply":b[r]=l*d/255;b[r+1]=m*a/255;b[r+2]=n*h/255;b[r+3]=p*c/255;break;case "mask":b[r+3]=c}},getUniformLocations:function(a,c){return{uTransformMatrix:a.getUniformLocation(c,"uTransformMatrix"),uImage:a.getUniformLocation(c,"uImage")}},sendUniformData:function(a,c){var b=this.calculateMatrix();a.uniform1i(c.uImage,1);a.uniformMatrix3fv(c.uTransformMatrix,!1,b)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}});b.Image.filters.BlendImage.fromObject=function(a,c){b.Image.fromObject(a.image,function(e){var d=b.util.object.clone(a);d.image=e;c(new b.Image.filters.BlendImage(d))})}})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=Math.pow,a=Math.floor,c=Math.sqrt,f=Math.abs,k=Math.round,g=Math.sin,h=Math.ceil;d=b.Image.filters;var l=b.util.createClass;d.Resize=l(d.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,getUniformLocations:function(a,c){return{uDelta:a.getUniformLocation(c,"uDelta"),uTaps:a.getUniformLocation(c,"uTaps")}},sendUniformData:function(a,c){a.uniform2fv(c.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]);a.uniform1fv(c.uTaps,this.taps)},retrieveShader:function(a){var c=this.getFilterWindow(),b=this.type+"_"+c;a.programCache.hasOwnProperty(b)||(c=this.generateShader(c),a.programCache[b]=this.createProgram(a.context,c));return a.programCache[b]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var a=this.lanczosCreate(this.lanczosLobes),c=this.tempScale,b=this.getFilterWindow(),e=Array(b),d=1;d<=b;d++)e[d-1]=a(d*c);return e},generateShader:function(a){for(var c=Array(a),b=this.fragmentSourceTOP,e=1;e<=a;e++)c[e-1]=e+".0 * uDelta";b+="uniform float uTaps["+a+"];\n";b+="void main() {\n";b+="  vec4 color \x3d texture2D(uTexture, vTexCoord);\n";b+="  float sum \x3d 1.0;\n";c.forEach(function(a,c){b+="  color +\x3d texture2D(uTexture, vTexCoord + "+a+") * uTaps["+c+"];\n";b+="  color +\x3d texture2D(uTexture, vTexCoord - "+a+") * uTaps["+c+"];\n";b+="  sum +\x3d 2.0 * uTaps["+c+"];\n"});b+="  gl_FragColor \x3d color / sum;\n";return b+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(a){a.webgl?1<a.passes&&this.isNeutralState(a)||(a.passes++,this.width=a.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=a.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),a.destinationWidth=this.dW,this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a),a.sourceWidth=a.destinationWidth,this.height=a.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),a.destinationHeight=this.dH,this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a),a.sourceHeight=a.destinationHeight):this.isNeutralState(a)||this.applyTo2d(a)},isNeutralState:function(a){var c=a.scaleY||this.scaleY;return 1===(a.scaleX||this.scaleX)&&1===c},lanczosCreate:function(a){return function(c){if(c>=a||c<=-a)return 0;if(1.1920929E-7>c&&-1.1920929E-7<c)return 1;c*=Math.PI;var b=c/a;return g(c)/c*g(b)/b}},applyTo2d:function(a){var c=a.imageData,b=this.scaleX,e=this.scaleY;this.rcpScaleX=1/b;this.rcpScaleY=1/e;var d=c.width,c=c.height,b=k(d*b),e=k(c*e),f;"sliceHack"===this.resizeType?f=this.sliceByTwo(a,d,c,b,e):"hermite"===this.resizeType?f=this.hermiteFastResize(a,d,c,b,e):"bilinear"===this.resizeType?f=this.bilinearFiltering(a,d,c,b,e):"lanczos"===this.resizeType&&(f=this.lanczosResize(a,d,c,b,e));a.imageData=f},sliceByTwo:function(c,e,d,f,g){c=c.imageData;var k=!1,h=!1,m=.5*e,l=.5*d,n=b.filterBackend.resources,p,q=0,r=0,A=e,B=0;n.sliceByTwo||(n.sliceByTwo=document.createElement("canvas"));n=n.sliceByTwo;if(n.width<1.5*e||n.height<d)n.width=1.5*e,n.height=d;p=n.getContext("2d");p.clearRect(0,0,1.5*e,d);p.putImageData(c,0,0);f=a(f);for(g=a(g);!k||!h;)e=m,d=l,f<a(.5*m)?m=a(.5*m):(m=f,k=!0),g<a(.5*l)?l=a(.5*l):(l=g,h=!0),p.drawImage(n,q,r,e,d,A,B,m,l),q=A,r=B,B+=l;return p.getImageData(q,r,f,g)},lanczosResize:function(b,d,g,k,l){var m,n,p,q;function r(b){var h,t,u,w,z,y,I,P,Q,L;p=(b+.5)*B;m=a(p);for(h=0;h<l;h++){q=(h+.5)*E;n=a(q);Q=P=I=y=z=0;for(t=m-G;t<=m+G;t++)if(!(0>t||t>=d)){L=a(1E3*f(t-p));K[L]||(K[L]={});for(var M=n-J;M<=n+J;M++)0>M||M>=g||(u=a(1E3*f(M-q)),K[L][u]||(K[L][u]=A(c(e(L*C,2)+e(u*F,2))/1E3)),u=K[L][u],0<u&&(w=4*(M*d+t),z+=u,y+=u*x[w],I+=u*x[w+1],P+=u*x[w+2],Q+=u*x[w+3]))}w=4*(h*k+b);D[w]=y/z;D[w+1]=I/z;D[w+2]=P/z;D[w+3]=Q/z}return++b<k?r(b):v}var x=b.imageData.data,v=b.ctx.createImageData(k,l),D=v.data,A=this.lanczosCreate(this.lanczosLobes),B=this.rcpScaleX,E=this.rcpScaleY,C=2/this.rcpScaleX,F=2/this.rcpScaleY,G=h(B*this.lanczosLobes/2),J=h(E*this.lanczosLobes/2),K={};n=m=q=p=void 0;return r(0)},bilinearFiltering:function(c,b,e,d,f){var g,k,h,m,l,n,p,q,r;e=0;var B=this.rcpScaleX,E=this.rcpScaleY,C=4*(b-1),F=c.imageData.data,G=c.ctx.createImageData(d,f),J=G.data;for(c=0;c<f;c++)for(p=0;p<d;p++)for(l=a(B*p),n=a(E*c),q=B*p-l,r=E*c-n,n=4*(n*b+l),l=0;4>l;l++)g=F[n+l],k=F[n+4+l],h=F[n+C+l],m=F[n+C+4+l],g=g*(1-q)*(1-r)+k*q*(1-r)+h*r*(1-q)+m*q*r,J[e++]=g;return G},hermiteFastResize:function(b,e,d,g,k){d=this.rcpScaleX;var l=this.rcpScaleY,m=h(d/2),n=h(l/2),p=b.imageData.data;b=b.ctx.createImageData(g,k);for(var q=b.data,r=0;r<k;r++)for(var v=0;v<g;v++){for(var D=4*(v+r*g),A,B=0,E=0,C=0,F=0,G=0,J=0,K=(r+.5)*l,I=a(r*l);I<(r+1)*l;I++)for(var N=f(K-(I+.5))/n,R=(v+.5)*d,N=N*N,O=a(v*d);O<(v+1)*d;O++){var H=f(R-(O+.5))/m;A=c(N+H*H);1<A&&-1>A||(A=2*A*A*A-3*A*A+1,0<A&&(H=4*(O+I*e),J+=A*p[H+3],E+=A,255>p[H+3]&&(A=A*p[H+3]/250),C+=A*p[H],F+=A*p[H+1],G+=A*p[H+2],B+=A))}q[D]=C/B;q[D+1]=F/B;q[D+2]=G/B;q[D+3]=J/E}return b},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});b.Image.filters.Resize.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass;b.Contrast=e(b.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\nfloat contrastF \x3d 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb \x3d contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor \x3d color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(a){if(0!==this.contrast){var c,b=a.imageData.data;a=b.length;c=Math.floor(255*this.contrast);var e=259*(c+255)/(255*(259-c));for(c=0;c<a;c+=4)b[c]=e*(b[c]-128)+128,b[c+1]=e*(b[c+1]-128)+128,b[c+2]=e*(b[c+2]-128)+128}},getUniformLocations:function(a,c){return{uContrast:a.getUniformLocation(c,"uContrast")}},sendUniformData:function(a,c){a.uniform1f(c.uContrast,this.contrast)}});d.Image.filters.Contrast.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass;b.Saturation=e(b.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\nfloat rgMax \x3d max(color.r, color.g);\nfloat rgbMax \x3d max(rgMax, color.b);\ncolor.r +\x3d rgbMax !\x3d color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g +\x3d rgbMax !\x3d color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b +\x3d rgbMax !\x3d color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor \x3d color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(a){if(0!==this.saturation){a=a.imageData.data;var c=a.length,b=-this.saturation,e,d;for(e=0;e<c;e+=4)d=Math.max(a[e],a[e+1],a[e+2]),a[e]+=d!==a[e]?(d-a[e])*b:0,a[e+1]+=d!==a[e+1]?(d-a[e+1])*b:0,a[e+2]+=d!==a[e+2]?(d-a[e+2])*b:0}},getUniformLocations:function(a,c){return{uSaturation:a.getUniformLocation(c,"uSaturation")}},sendUniformData:function(a,c){a.uniform1f(c.uSaturation,-this.saturation)}});d.Image.filters.Saturation.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={});d=b.Image.filters;var e=b.util.createClass;d.Blur=e(d.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples \x3d 15.0;\nvec3 v3offset \x3d vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color \x3d vec4(0.0);\nfloat total \x3d 0.0;\nfloat offset \x3d random(v3offset);\nfor (float t \x3d -nSamples; t \x3c\x3d nSamples; t++) {\nfloat percent \x3d (t + offset - 0.5) / nSamples;\nfloat weight \x3d 1.0 - abs(percent);\ncolor +\x3d texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal +\x3d weight;\n}\ngl_FragColor \x3d color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(a){a.webgl?(this.aspectRatio=a.sourceWidth/a.sourceHeight,a.passes++,this._setupFrameBuffer(a),this.horizontal=!0,this.applyToWebGL(a),this._swapTextures(a),this._setupFrameBuffer(a),this.horizontal=!1,this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},applyTo2d:function(a){a.imageData=this.simpleBlur(a)},simpleBlur:function(a){var c=a.filterBackend.resources,e,d,g=a.imageData.width,h=a.imageData.height;c.blurLayer1||(c.blurLayer1=b.util.createCanvasElement(),c.blurLayer2=b.util.createCanvasElement());e=c.blurLayer1;d=c.blurLayer2;if(e.width!==g||e.height!==h)d.width=e.width=g,d.height=e.height=h;var c=e.getContext("2d"),l=d.getContext("2d"),m,n,p,q,r=.03*this.blur;c.putImageData(a.imageData,0,0);l.clearRect(0,0,g,h);for(q=-15;15>=q;q++)m=(Math.random()-.5)/4,n=q/15,p=r*n*g+m,l.globalAlpha=1-Math.abs(n),l.drawImage(e,p,m),c.drawImage(d,0,0),l.globalAlpha=1,l.clearRect(0,0,d.width,d.height);for(q=-15;15>=q;q++)m=(Math.random()-.5)/4,n=q/15,p=r*n*h+m,l.globalAlpha=1-Math.abs(n),l.drawImage(e,m,p),c.drawImage(d,0,0),l.globalAlpha=1,l.clearRect(0,0,d.width,d.height);a.ctx.drawImage(e,0,0);a=a.ctx.getImageData(0,0,e.width,e.height);c.globalAlpha=1;c.clearRect(0,0,e.width,e.height);return a},getUniformLocations:function(a,c){return{delta:a.getUniformLocation(c,"uDelta")}},sendUniformData:function(a,c){var b=this.chooseRightDelta();a.uniform2fv(c.delta,b)},chooseRightDelta:function(){var a=1,c=[0,0];this.horizontal?1<this.aspectRatio&&(a=1/this.aspectRatio):1>this.aspectRatio&&(a=this.aspectRatio);a=a*this.blur*.12;this.horizontal?c[0]=a:c[1]=a;return c}});d.Blur.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){d=d.fabric||(d.fabric={});var b=d.Image.filters,e=d.util.createClass;b.Gamma=e(b.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color \x3d texture2D(uTexture, vTexCoord);\nvec3 correction \x3d (1.0 / uGamma);\ncolor.r \x3d pow(color.r, correction.r);\ncolor.g \x3d pow(color.g, correction.g);\ncolor.b \x3d pow(color.b, correction.b);\ngl_FragColor \x3d color;\ngl_FragColor.rgb *\x3d color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",applyTo2d:function(a){a=a.imageData.data;var c=this.gamma,b=1/c[0],e=1/c[1],d=1/c[2],h;this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256));h=0;for(c=256;h<c;h++)this.rVals[h]=255*Math.pow(h/255,b),this.gVals[h]=255*Math.pow(h/255,e),this.bVals[h]=255*Math.pow(h/255,d);h=0;for(c=a.length;h<c;h+=4)a[h]=this.rVals[a[h]],a[h+1]=this.gVals[a[h+1]],a[h+2]=this.bVals[a[h+2]]},getUniformLocations:function(a,c){return{uGamma:a.getUniformLocation(c,"uGamma")}},sendUniformData:function(a,c){a.uniform3fv(c.uGamma,this.gamma)}});d.Image.filters.Gamma.fromObject=d.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={});d=b.Image.filters;var e=b.util.createClass;d.Composed=e(d.BaseFilter,{type:"Composed",subFilters:[],initialize:function(a){this.callSuper("initialize",a);this.subFilters=this.subFilters.slice(0)},applyTo:function(a){a.passes+=this.subFilters.length-1;this.subFilters.forEach(function(c){c.applyTo(a)})},toObject:function(){return b.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(a){return a.toObject()})})}});b.Image.filters.Composed.fromObject=function(a,c){var e=(a.subFilters||[]).map(function(a){return new b.Image.filters[a.type](a)}),e=new b.Image.filters.Composed({subFilters:e});c&&c(e);return e}})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={});d=b.Image.filters;var e=b.util.createClass;d.HueRotation=e(d.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var a=this.rotation*Math.PI,c=b.util.cos(a),e=b.util.sin(a),a=1/3,e=Math.sqrt(a)*e,d=1-c;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this.matrix[0]=c+d/3;this.matrix[1]=a*d-e;this.matrix[2]=a*d+e;this.matrix[5]=a*d+e;this.matrix[6]=c+a*d;this.matrix[7]=a*d-e;this.matrix[10]=a*d-e;this.matrix[11]=a*d+e;this.matrix[12]=c+a*d},applyTo:function(a){this.calculateMatrix();b.Image.filters.BaseFilter.prototype.applyTo.call(this,a)}});b.Image.filters.HueRotation.fromObject=b.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);(function(d){var b=d.fabric||(d.fabric={}),e=b.util.object.clone;b.Text?b.warn("fabric.Text is already defined"):(b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:"fontSize fontWeight fontFamily fontStyle lineHeight text charSpacing textAlign styles".split(" "),_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:b.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:b.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:"stroke strokeWidth fill fontFamily fontSize fontWeight fontStyle underline overline linethrough deltaY textBackgroundColor".split(" "),__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(a,c){this.styles=c?c.styles||{}:{};this.text=a;this.__skipDimension=!0;this.callSuper("initialize",c);this.__skipDimension=!1;this.initDimensions();this.setCoords();this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){b._measuringContext||(b._measuringContext=this.canvas&&this.canvas.contextCache||b.util.createCanvasElement().getContext("2d"));return b._measuringContext},_splitText:function(){var a=this._splitTextIntoLines(this.text);this.textLines=a.lines;this._textLines=a.graphemeLines;this._unwrappedTextLines=a._unwrappedLines;this._text=a.graphemeText;return a},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var a,c,b,e,d,h=0,l=this._textLines.length;h<l;h++)if("justify"===this.textAlign||h!==l-1&&!this.isEndOfWrapping(h))if(b=0,e=this._textLines[h],a=this.getLineWidth(h),a<this.width&&(d=this.textLines[h].match(this._reSpacesAndTabs))){c=d.length;a=(this.width-a)/c;for(var m=0,n=e.length;m<=n;m++)c=this.__charBounds[h][m],this._reSpaceAndTab.test(e[m])?(c.width+=a,c.kernedWidth+=a,c.left+=b,b+=a):c.left+=b}},isEndOfWrapping:function(a){return a===this._textLines.length-1},toString:function(){return"#\x3cfabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }\x3e'},_getCacheCanvasDimensions:function(){var a=this.callSuper("_getCacheCanvasDimensions"),c=this.fontSize;a.width+=c*a.zoomX;a.height+=c*a.zoomY;return a},_render:function(a){this._setTextStyles(a);this._renderTextLinesBackground(a);this._renderTextDecoration(a,"underline");this._renderText(a);this._renderTextDecoration(a,"overline");this._renderTextDecoration(a,"linethrough")},_renderText:function(a){"stroke"===this.paintFirst?(this._renderTextStroke(a),this._renderTextFill(a)):(this._renderTextFill(a),this._renderTextStroke(a))},_setTextStyles:function(a,c,b){a.textBaseline="alphabetic";a.font=this._getFontDeclaration(c,b)},calcTextWidth:function(){for(var a=this.getLineWidth(0),c=1,b=this._textLines.length;c<b;c++){var e=this.getLineWidth(c);e>a&&(a=e)}return a},_renderTextLine:function(a,c,b,e,d,h){this._renderChars(a,c,b,e,d,h)},_renderTextLinesBackground:function(a){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var c=0,b,e,d=a.fillStyle,h,l,m=this._getLeftOffset(),n=this._getTopOffset(),p,q,r,t=0,u=this._textLines.length;t<u;t++){b=this.getHeightOfLine(t);if(this.textBackgroundColor||this.styleHas("textBackgroundColor",t)){h=this._textLines[t];e=this._getLineLeftOffset(t);p=q=0;l=this.getValueOfPropertyAt(t,0,"textBackgroundColor");for(var y=0,w=h.length;y<w;y++)h=this.__charBounds[t][y],r=this.getValueOfPropertyAt(t,y,"textBackgroundColor"),r!==l?((a.fillStyle=l)&&a.fillRect(m+e+p,n+c,q,b/this.lineHeight),p=h.left,q=h.width,l=r):q+=h.kernedWidth;r&&(a.fillStyle=r,a.fillRect(m+e+p,n+c,q,b/this.lineHeight))}c+=b}a.fillStyle=d;this._removeShadow(a)}},getFontCache:function(a){var c=a.fontFamily.toLowerCase();b.charWidthsCache[c]||(b.charWidthsCache[c]={});c=b.charWidthsCache[c];a=a.fontStyle.toLowerCase()+"_"+(a.fontWeight+"").toLowerCase();c[a]||(c[a]={});return c[a]},_applyCharStyles:function(a,c,b,e,d){this._setFillStyles(c,d);this._setStrokeStyles(c,d);c.font=this._getFontDeclaration(d)},_measureChar:function(a,c,b,e){var d=this.getFontCache(c),f=this._getFontDeclaration(c),k=this._getFontDeclaration(e);e=b+a;var f=f===k,m,n,p,k=c.fontSize/this.CACHE_FONT_SIZE,q;b&&d[b]&&(p=d[b]);d[a]&&(q=m=d[a]);f&&d[e]&&(n=d[e],q=n-p);if(!m||!p||!n){var r=this.getMeasuringContext();this._setTextStyles(r,c,!0)}m||(q=m=r.measureText(a).width,d[a]=m);!p&&f&&b&&(p=r.measureText(b).width,d[b]=p);f&&!n&&(n=r.measureText(e).width,d[e]=n,q=n-p);return{width:m*k,kernedWidth:q*k}},getHeightOfChar:function(a,c){return this.getValueOfPropertyAt(a,c,"fontSize")},measureLine:function(a){a=this._measureLine(a);0!==this.charSpacing&&(a.width-=this._getWidthOfCharSpacing());0>a.width&&(a.width=0);return a},_measureLine:function(a){var c=0,b,e,d=this._textLines[a],h,l,m=Array(d.length);this.__charBounds[a]=m;for(b=0;b<d.length;b++)e=d[b],l=this._getGraphemeBox(e,a,b,h),m[b]=l,c+=l.kernedWidth,h=e;m[b]={left:l?l.left+l.width:0,width:0,kernedWidth:0,height:this.fontSize};return{width:c,numOfSpaces:0}},_getGraphemeBox:function(a,c,b,e,d){var f=this.getCompleteStyleDeclaration(c,b),g=e?this.getCompleteStyleDeclaration(c,b-1):{};a=this._measureChar(a,f,e,g);e=a.kernedWidth;var g=a.width,k;0!==this.charSpacing&&(k=this._getWidthOfCharSpacing(),g+=k,e+=k);f={width:g,left:0,height:f.fontSize,kernedWidth:e,deltaY:f.deltaY};0<b&&!d&&(c=this.__charBounds[c][b-1],f.left=c.left+c.width+a.kernedWidth-a.width);return f},getHeightOfLine:function(a){if(this.__lineHeights[a])return this.__lineHeights[a];for(var c=this._textLines[a],b=this.getHeightOfChar(a,0),e=1,c=c.length;e<c;e++)b=Math.max(this.getHeightOfChar(a,e),b);return this.__lineHeights[a]=b*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var a,c=0,b=0,e=this._textLines.length;b<e;b++)a=this.getHeightOfLine(b),c+=b===e-1?a/this.lineHeight:a;return c},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(a,c){a.save();for(var b=0,e=this._getLeftOffset(),d=this._getTopOffset(),h=this._applyPatternGradientTransform(a,"fillText"===c?this.fill:this.stroke),l=0,m=this._textLines.length;l<m;l++){var n=this.getHeightOfLine(l),p=n/this.lineHeight,q=this._getLineLeftOffset(l);this._renderTextLine(c,a,this._textLines[l],e+q-h.offsetX,d+b+p-h.offsetY,l);b+=n}a.restore()},_renderTextFill:function(a){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(a,"fillText")},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore()},_renderChars:function(a,c,b,e,d,h){var f=this.getHeightOfLine(h),g=-1!==this.textAlign.indexOf("justify"),k,p,q="",r,t=0,u;r=!g&&0===this.charSpacing&&this.isEmptyStyles(h);c.save();d-=f*this._fontSizeFraction/this.lineHeight;if(r)this._renderChar(a,c,h,0,this.textLines[h],e,d,f);else for(var y=0,w=b.length-1;y<=w;y++)u=y===w||this.charSpacing,q+=b[y],r=this.__charBounds[h][y],0===t?(e+=r.kernedWidth-r.width,t+=r.width):t+=r.kernedWidth,g&&!u&&this._reSpaceAndTab.test(b[y])&&(u=!0),u||(k=k||this.getCompleteStyleDeclaration(h,y),p=this.getCompleteStyleDeclaration(h,y+1),u=this._hasStyleChanged(k,p)),u&&(this._renderChar(a,c,h,y,q,e,d,f),q="",k=p,e+=t,t=0);c.restore()},_renderChar:function(a,b,e,d,g,h,l){var c=this._getStyleDeclaration(e,d),f=this.getCompleteStyleDeclaration(e,d),k="fillText"===a&&f.fill,q="strokeText"===a&&f.stroke&&f.strokeWidth;if(q||k)c&&b.save(),this._applyCharStyles(a,b,e,d,f),c&&c.textBackgroundColor&&this._removeShadow(b),c&&c.deltaY&&(l+=c.deltaY),k&&b.fillText(g,h,l),q&&b.strokeText(g,h,l),c&&b.restore()},setSuperscript:function(a,b){return this._setScript(a,b,this.superscript)},setSubscript:function(a,b){return this._setScript(a,b,this.subscript)},_setScript:function(a,b,e){var c=this.get2DCursorLocation(a,!0),d=this.getValueOfPropertyAt(c.lineIndex,c.charIndex,"fontSize"),c=this.getValueOfPropertyAt(c.lineIndex,c.charIndex,"deltaY");this.setSelectionStyles({fontSize:d*e.size,deltaY:c+d*e.baseline},a,b);return this},_hasStyleChanged:function(a,b){return a.fill!==b.fill||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth||a.fontSize!==b.fontSize||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle||a.deltaY!==b.deltaY},_hasStyleChangedForSvg:function(a,b){return this._hasStyleChanged(a,b)||a.overline!==b.overline||a.underline!==b.underline||a.linethrough!==b.linethrough},_getLineLeftOffset:function(a){var b=this.getLineWidth(a);return"center"===this.textAlign?(this.width-b)/2:"right"===this.textAlign?this.width-b:"justify-center"===this.textAlign&&this.isEndOfWrapping(a)?(this.width-b)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(a)?this.width-b:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__charBounds=[]},_shouldClearDimensionCache:function(){var a=this._forceClearCache;a||(a=this.hasStateChanged("_dimensionAffectingProps"));a&&(this.dirty=!0,this._forceClearCache=!1);return a},getLineWidth:function(a){if(this.__lineWidths[a])return this.__lineWidths[a];var b;""===this._textLines[a]?b=0:(b=this.measureLine(a),b=b.width);return this.__lineWidths[a]=b},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1E3:0},getValueOfPropertyAt:function(a,b,e){return(a=this._getStyleDeclaration(a,b))&&"undefined"!==typeof a[e]?a[e]:this[e]},_renderTextDecoration:function(a,b){if(this[b]||this.styleHas(b)){for(var c,e,d,h,l,m,n,p=this._getLeftOffset(),q=this._getTopOffset(),r,t,u,y,w,z,x,v=0,D=this._textLines.length;v<D;v++){c=this.getHeightOfLine(v);if(this[b]||this.styleHas(b,v)){d=this._textLines[v];e=c/this.lineHeight;h=this._getLineLeftOffset(v);u=t=0;n=this.getValueOfPropertyAt(v,0,b);x=this.getValueOfPropertyAt(v,0,"fill");r=q+e*(1-this._fontSizeFraction);e=this.getHeightOfChar(v,0);l=this.getValueOfPropertyAt(v,0,"deltaY");for(var A=0,B=d.length;A<B;A++)y=this.__charBounds[v][A],w=this.getValueOfPropertyAt(v,A,b),z=this.getValueOfPropertyAt(v,A,"fill"),d=this.getHeightOfChar(v,A),m=this.getValueOfPropertyAt(v,A,"deltaY"),(w!==n||z!==x||d!==e||m!==l)&&0<u?(a.fillStyle=x,n&&x&&a.fillRect(p+h+t,r+this.offsets[b]*e+l,u,this.fontSize/15),t=y.left,u=y.width,n=w,x=z,e=d,l=m):u+=y.kernedWidth;a.fillStyle=z;w&&z&&a.fillRect(p+h+t,r+this.offsets[b]*e+l,u,this.fontSize/15)}q+=c}this._removeShadow(a)}},_getFontDeclaration:function(a,c){var e=a||this,d=void 0===e.fontFamily||-1<e.fontFamily.indexOf("'")||-1<e.fontFamily.indexOf('"')?e.fontFamily:'"'+e.fontFamily+'"';return[b.isLikelyNode?e.fontWeight:e.fontStyle,b.isLikelyNode?e.fontStyle:e.fontWeight,c?this.CACHE_FONT_SIZE+"px":e.fontSize+"px",d].join(" ")},render:function(a){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",a))},_splitTextIntoLines:function(a){a=a.split(this._reNewline);for(var c=Array(a.length),e=["\n"],d=[],g=0;g<a.length;g++)c[g]=b.util.string.graphemeSplit(a[g]),d=d.concat(c[g],e);d.pop();return{_unwrappedLines:c,lines:a,graphemeText:d,graphemeLines:c}},toObject:function(a){a="text fontSize fontWeight fontFamily fontStyle lineHeight underline overline linethrough textAlign textBackgroundColor charSpacing".split(" ").concat(a);a=this.callSuper("toObject",a);a.styles=e(this.styles,!0);return a},set:function(a,b){this.callSuper("set",a,b);var c=!1;if("object"===typeof a)for(var e in a)c=c||-1!==this._dimensionAffectingProps.indexOf(e);else c=-1!==this._dimensionAffectingProps.indexOf(a);c&&(this.initDimensions(),this.setCoords());return this},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,c,d){if(!a)return c(null);var f=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES),g=f.textAnchor||"left";d=b.util.object.extend(d?e(d):{},f);d.top=d.top||0;d.left=d.left||0;if(f.textDecoration){var h=f.textDecoration;-1!==h.indexOf("underline")&&(d.underline=!0);-1!==h.indexOf("overline")&&(d.overline=!0);-1!==h.indexOf("line-through")&&(d.linethrough=!0);delete d.textDecoration}"dx"in f&&(d.left+=f.dx);"dy"in f&&(d.top+=f.dy);"fontSize"in d||(d.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE);f="";"textContent"in a?f=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(f=a.firstChild.data);f=f.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");a=d.strokeWidth;d.strokeWidth=0;d=new b.Text(f,d);f=d.getScaledHeight()/d.height;f*=(d.height+d.strokeWidth)*d.lineHeight-d.height;f=d.getScaledHeight()+f;h=0;"center"===g&&(h=d.getScaledWidth()/2);"right"===g&&(h=d.getScaledWidth());d.set({left:d.left-h,top:d.top-(f-d.fontSize*(.07+d._fontSizeFraction))/d.lineHeight,strokeWidth:"undefined"!==typeof a?a:1});c(d)},b.Text.fromObject=function(a,c){return b.Object._fromObject("Text",a,c,"text")},b.util.createAccessors&&b.util.createAccessors(b.Text))})("undefined"!==typeof exports?exports:this);(function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(d){if(!this.styles||"undefined"!==typeof d&&!this.styles[d])return!0;d="undefined"===typeof d?this.styles:{line:this.styles[d]};for(var b in d)for(var e in d[b])for(var a in d[b][e])return!1;return!0},styleHas:function(d,b){if(!this.styles||!d||""===d||"undefined"!==typeof b&&!this.styles[b])return!1;var e="undefined"===typeof b?this.styles:{line:this.styles[b]},a;for(a in e)for(var c in e[a])if("undefined"!==typeof e[a][c][d])return!0;return!1},cleanStyle:function(d){if(!this.styles||!d||""===d)return!1;var b=this.styles,e=0,a,c,f=!0,k=0,g,h;for(h in b){a=0;for(var l in b[h]){g=b[h][l];var m=g.hasOwnProperty(d);e++;m?(c?g[d]!==c&&(f=!1):c=g[d],g[d]===this[d]&&delete g[d]):f=!1;0!==Object.keys(g).length?a++:delete b[h][l]}0===a&&delete b[h]}for(b=0;b<this._textLines.length;b++)k+=this._textLines[b].length;f&&e===k&&(this[d]=c,this.removeStyle(d))},removeStyle:function(d){if(this.styles&&d&&""!==d){var b=this.styles,e,a,c;for(a in b){e=b[a];for(c in e)delete e[c][d],0===Object.keys(e[c]).length&&delete e[c];0===Object.keys(e).length&&delete b[a]}}},_extendStyles:function(d,b){var e=this.get2DCursorLocation(d);this._getLineStyle(e.lineIndex)||this._setLineStyle(e.lineIndex,{});this._getStyleDeclaration(e.lineIndex,e.charIndex)||this._setStyleDeclaration(e.lineIndex,e.charIndex,{});fabric.util.object.extend(this._getStyleDeclaration(e.lineIndex,e.charIndex),b)},get2DCursorLocation:function(d,b){"undefined"===typeof d&&(d=this.selectionStart);for(var e=b?this._unwrappedTextLines:this._textLines,a=e.length,c=0;c<a;c++){if(d<=e[c].length)return{lineIndex:c,charIndex:d};d-=e[c].length+1}return{lineIndex:c-1,charIndex:e[c-1].length<d?e[c-1].length:d}},getSelectionStyles:function(d,b,e){"undefined"===typeof d&&(d=this.selectionStart||0);"undefined"===typeof b&&(b=this.selectionEnd||d);for(var a=[];d<b;d++)a.push(this.getStyleAtPosition(d,e));return a},getStyleAtPosition:function(d,b){var e=this.get2DCursorLocation(d);return(b?this.getCompleteStyleDeclaration(e.lineIndex,e.charIndex):this._getStyleDeclaration(e.lineIndex,e.charIndex))||{}},setSelectionStyles:function(d,b,e){"undefined"===typeof b&&(b=this.selectionStart||0);for("undefined"===typeof e&&(e=this.selectionEnd||b);b<e;b++)this._extendStyles(b,d);this._forceClearCache=!0;return this},_getStyleDeclaration:function(d,b){var e=this.styles&&this.styles[d];return e?e[b]:null},getCompleteStyleDeclaration:function(d,b){for(var e=this._getStyleDeclaration(d,b)||{},a={},c,f=0;f<this._styleProperties.length;f++)c=this._styleProperties[f],a[c]="undefined"===typeof e[c]?this[c]:e[c];return a},_setStyleDeclaration:function(d,b,e){this.styles[d][b]=e},_deleteStyleDeclaration:function(d,b){delete this.styles[d][b]},_getLineStyle:function(d){return this.styles[d]},_setLineStyle:function(d,b){this.styles[d]=b},_deleteLineStyle:function(d){delete this.styles[d]}})})();(function(){function d(b){b.textDecoration&&(-1<b.textDecoration.indexOf("underline")&&(b.underline=!0),-1<b.textDecoration.indexOf("line-through")&&(b.linethrough=!0),-1<b.textDecoration.indexOf("overline")&&(b.overline=!0),delete b.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(b,e){this.callSuper("initialize",b,e);this.initBehavior()},setSelectionStart:function(b){b=Math.max(b,0);this._updateAndFire("selectionStart",b)},setSelectionEnd:function(b){b=Math.min(b,this.text.length);this._updateAndFire("selectionEnd",b)},_updateAndFire:function(b,e){this[b]!==e&&(this._fireSelectionChanged(),this[b]=e);this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor();this.clearContextTop();this.callSuper("initDimensions")},render:function(b){this.clearContextTop();this.callSuper("render",b);this.cursorOffsetCache={};this.renderCursorOrSelection()},_render:function(b){this.callSuper("_render",b)},clearContextTop:function(b){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this.canvas.contextTop,a=this.canvas.viewportTransform;e.save();e.transform(a[0],a[1],a[2],a[3],a[4],a[5]);this.transform(e);this.transformMatrix&&e.transform.apply(e,this.transformMatrix);this._clearTextArea(e);b||e.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas){var b=this._getCursorBoundaries(),e;this.canvas&&this.canvas.contextTop?(e=this.canvas.contextTop,this.clearContextTop(!0)):(e=this.canvas.contextContainer,e.save());this.selectionStart===this.selectionEnd?this.renderCursor(b,e):this.renderSelection(b,e);e.restore()}},_clearTextArea:function(b){var e=this.width+4,a=this.height+4;b.clearRect(-e/2,-a/2,e,a)},_getCursorBoundaries:function(b){"undefined"===typeof b&&(b=this.selectionStart);var e=this._getLeftOffset(),a=this._getTopOffset();b=this._getCursorBoundariesOffsets(b);return{left:e,top:a,leftOffset:b.left,topOffset:b.top}},_getCursorBoundariesOffsets:function(b){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var e=0,a=0,c=this.get2DCursorLocation(b);for(b=0;b<c.lineIndex;b++)e+=this.getHeightOfLine(b);b=this._getLineLeftOffset(c.lineIndex);(c=this.__charBounds[c.lineIndex][c.charIndex])&&(a=c.left);0!==this.charSpacing&&0===this._textLines[0].length&&(a-=this._getWidthOfCharSpacing());return this.cursorOffsetCache={top:e,left:b+(0<a?a:0)}},renderCursor:function(b,e){var a=this.get2DCursorLocation(),c=a.lineIndex,a=0<a.charIndex?a.charIndex-1:0,d=this.getValueOfPropertyAt(c,a,"fontSize"),k=this.scaleX*this.canvas.getZoom(),k=this.cursorWidth/k,g=b.topOffset,h=this.getValueOfPropertyAt(c,a,"deltaY"),g=g+((1-this._fontSizeFraction)*this.getHeightOfLine(c)/this.lineHeight-d*(1-this._fontSizeFraction));this.inCompositionMode&&this.renderSelection(b,e);e.fillStyle=this.getValueOfPropertyAt(c,a,"fill");e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;e.fillRect(b.left+b.leftOffset-k/2,g+b.top+h,k,d)},renderSelection:function(b,e){for(var a=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,c=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,d=-1!==this.textAlign.indexOf("justify"),k=this.get2DCursorLocation(a),g=this.get2DCursorLocation(c),c=k.lineIndex,a=g.lineIndex,k=0>k.charIndex?0:k.charIndex,g=0>g.charIndex?0:g.charIndex,h=c;h<=a;h++){var l=this._getLineLeftOffset(h)||0,m=this.getHeightOfLine(h),n,p=0,q=0;h===c&&(p=this.__charBounds[c][k].left);h>=c&&h<a?q=d&&!this.isEndOfWrapping(h)?this.width:this.getLineWidth(h)||5:h===a&&(q=0===g?this.__charBounds[a][g].left:this.__charBounds[a][g-1].left+this.__charBounds[a][g-1].width);n=m;if(1>this.lineHeight||h===a&&1<this.lineHeight)m/=this.lineHeight;this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",e.fillRect(b.left+l+p,b.top+b.topOffset+m,q-p,1)):(e.fillStyle=this.selectionColor,e.fillRect(b.left+l+p,b.top+b.topOffset,q-p,m));b.topOffset+=n}},getCurrentCharFontSize:function(){var b=this._getCurrentCharIndex();return this.getValueOfPropertyAt(b.l,b.c,"fontSize")},getCurrentCharColor:function(){var b=this._getCurrentCharIndex();return this.getValueOfPropertyAt(b.l,b.c,"fill")},_getCurrentCharIndex:function(){var b=this.get2DCursorLocation(this.selectionStart,!0);return{l:b.lineIndex,c:0<b.charIndex?b.charIndex-1:0}}});fabric.IText.fromObject=function(b,e){d(b);if(b.styles)for(var a in b.styles)for(var c in b.styles[a])d(b.styles[a][c]);fabric.Object._fromObject("IText",b,e,"text")}})();(function(){var d=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(b){this.isEditing&&this.exitEditing();this.selected=!1;fabric.Object.prototype.onDeselect.call(this,b)},initAddedHandler:function(){var b=this;this.on("added",function(){var e=b.canvas;e&&(e._hasITextHandlers||(e._hasITextHandlers=!0,b._initCanvasHandlers(e)),e._iTextInstances=e._iTextInstances||[],e._iTextInstances.push(b))})},initRemovedHandler:function(){var b=this;this.on("removed",function(){var e=b.canvas;e&&(e._iTextInstances=e._iTextInstances||[],fabric.util.removeFromArray(e._iTextInstances,b),0===e._iTextInstances.length&&(e._hasITextHandlers=!1,b._removeCanvasHandlers(e)))})},_initCanvasHandlers:function(b){b._mouseUpITextHandler=function(){b._iTextInstances&&b._iTextInstances.forEach(function(b){b.__isMousedown=!1})}.bind(this);b.on("mouse:up",b._mouseUpITextHandler)},_removeCanvasHandlers:function(b){b.off("mouse:up",b._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(b,e,a,c){var d;d={isAborted:!1,abort:function(){this.isAborted=!0}};b.animate("_currentCursorOpacity",e,{duration:a,onComplete:function(){if(!d.isAborted)b[c]()},onChange:function(){b.canvas&&b.selectionStart===b.selectionEnd&&b.renderCursorOrSelection()},abort:function(){return d.isAborted}});return d},_onTickComplete:function(){var b=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){b._currentTickCompleteState=b._animateCursor(b,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(b){var e=this;b=b?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){e._tick()},b)},abortCursorAnimation:function(){var b=this._currentTickState||this._currentTickCompleteState,e=this.canvas;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;b&&e&&e.clearContext(e.contextTop||e.contextContainer)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this._text.length;this._fireSelectionChanged();this._updateTextarea();return this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(b){var e=0,a=b-1;if(this._reSpace.test(this._text[a]))for(;this._reSpace.test(this._text[a]);)e++,a--;for(;/\S/.test(this._text[a])&&-1<a;)e++,a--;return b-e},findWordBoundaryRight:function(b){var e=0,a=b;if(this._reSpace.test(this._text[a]))for(;this._reSpace.test(this._text[a]);)e++,a++;for(;/\S/.test(this._text[a])&&a<this.text.length;)e++,a++;return b+e},findLineBoundaryLeft:function(b){for(var e=0,a=b-1;!/\n/.test(this._text[a])&&-1<a;)e++,a--;return b-e},findLineBoundaryRight:function(b){for(var e=0,a=b;!/\n/.test(this._text[a])&&a<this.text.length;)e++,a++;return b+e},searchWordBoundary:function(b,e){for(var a=this._reSpace.test(this.text.charAt(b))?b-1:b,c=this.text.charAt(a),d=/[ \n\.,;!\?\-]/;!d.test(c)&&0<a&&a<this.text.length;)a+=e,c=this.text.charAt(a);d.test(c)&&"\n"!==c&&(a+=1===e?0:1);return a},selectWord:function(b){b=b||this.selectionStart;var e=this.searchWordBoundary(b,-1);b=this.searchWordBoundary(b,1);this.selectionStart=e;this.selectionEnd=b;this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection()},selectLine:function(b){b=b||this.selectionStart;var e=this.findLineBoundaryLeft(b);b=this.findLineBoundaryRight(b);this.selectionStart=e;this.selectionEnd=b;this._fireSelectionChanged();this._updateTextarea();return this},enterEditing:function(b){if(!this.isEditing&&this.editable){this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas));this.isEditing=!0;this.initHiddenTextarea(b);this.hiddenTextarea.focus();this.hiddenTextarea.value=this.text;this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire("editing:entered");this._fireSelectionChanged();if(!this.canvas)return this;this.canvas.fire("text:editing:entered",{target:this});this.initMouseMoveHandler();this.canvas.requestRenderAll();return this}},exitEditingOnOthers:function(b){b._iTextInstances&&b._iTextInstances.forEach(function(b){b.selected=!1;b.isEditing&&b.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(b){if(this.__isMousedown&&this.isEditing){b=this.getSelectionStartFromPointer(b.e);var e=this.selectionStart,a=this.selectionEnd;if(b===this.__selectionStartOnMouseDown&&e!==a||e!==b&&a!==b)if(b>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=b):(this.selectionStart=b,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart!==e||this.selectionEnd!==a)this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(b,e,a){var c=a.slice(0,b),c=fabric.util.string.graphemeSplit(c).length;if(b===e)return{selectionStart:c,selectionEnd:c};b=a.slice(b,e);b=fabric.util.string.graphemeSplit(b).length;return{selectionStart:c,selectionEnd:c+b}},fromGraphemeToStringSelection:function(b,e,a){var c=a.slice(0,b).join("").length;if(b===e)return{selectionStart:c,selectionEnd:c};b=a.slice(b,e).join("").length;return{selectionStart:c,selectionEnd:c+b}},_updateTextarea:function(){this.cursorOffsetCache={};if(this.hiddenTextarea){if(!this.inCompositionMode){var b=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=b.selectionStart;this.hiddenTextarea.selectionEnd=b.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={};this.text=this.hiddenTextarea.value;this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var b=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=b.selectionEnd;this.inCompositionMode||(this.selectionStart=b.selectionStart);this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var b=this._calcTextareaPosition();this.hiddenTextarea.style.left=b.left;this.hiddenTextarea.style.top=b.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var b=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(b),b=this.get2DCursorLocation(b),b=this.getValueOfPropertyAt(b.lineIndex,b.charIndex,"fontSize")*this.lineHeight,a=e.leftOffset,c=this.calcTransformMatrix(),e={x:e.left+a,y:e.top+e.topOffset+b},d=this.canvas.upperCanvasEl,k=d.width,g=d.height,a=k-b,h=g-b,k=d.clientWidth/k,d=d.clientHeight/g,e=fabric.util.transformPoint(e,c),e=fabric.util.transformPoint(e,this.canvas.viewportTransform);e.x*=k;e.y*=d;0>e.x&&(e.x=0);e.x>a&&(e.x=a);0>e.y&&(e.y=0);e.y>h&&(e.y=h);e.x+=this.canvas._offset.left;e.y+=this.canvas._offset.top;return{left:e.x+"px",top:e.y+"px",fontSize:b+"px",charHeight:b}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var b=this._textBeforeEdit!==this.text;this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null);this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());this.fire("editing:exited");b&&this.fire("modified");this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),b&&this.canvas.fire("object:modified",{target:this}));return this},_removeExtraneousStyles:function(){for(var b in this.styles)this._textLines[b]||delete this.styles[b]},removeStyleFromTo:function(b,e){var a=this.get2DCursorLocation(b,!0),c=this.get2DCursorLocation(e,!0),d=a.lineIndex,a=a.charIndex,k=c.lineIndex,c=c.charIndex,g,h;if(d!==k){if(this.styles[d])for(g=a;g<this._unwrappedTextLines[d].length;g++)delete this.styles[d][g];if(this.styles[k])for(g=c;g<this._unwrappedTextLines[k].length;g++)if(h=this.styles[k][g])this.styles[d]||(this.styles[d]={}),this.styles[d][a+g-c]=h;for(g=d+1;g<=k;g++)delete this.styles[g];this.shiftLineStyles(k,d-k)}else if(this.styles[d]){h=this.styles[d];var k=c-a,l;for(g=a;g<c;g++)delete h[g];for(l in this.styles[d])d=parseInt(l,10),d>=c&&(h[d-k]=h[l],delete h[l])}},shiftLineStyles:function(b,e){var a=d(this.styles),c;for(c in this.styles){var f=parseInt(c,10);f>b&&(this.styles[f+e]=a[f],a[f-e]||delete this.styles[f])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(b,e,a,c){var f,k={},g=!1;a||(a=1);this.shiftLineStyles(b,a);this.styles[b]&&(f=this.styles[b][0===e?e:e-1]);for(var h in this.styles[b]){var l=parseInt(h,10);l>=e&&(g=!0,k[l-e]=this.styles[b][h],delete this.styles[b][h])}for(g?this.styles[b+a]=k:delete this.styles[b+a];1<a;)a--,c&&c[a]?this.styles[b+a]={0:d(c[a])}:f?this.styles[b+a]={0:d(f)}:delete this.styles[b+a];this._forceClearCache=!0},insertCharStyleObject:function(b,e,a,c){this.styles||(this.styles={});var f=this.styles[b],k=f?d(f):{};a||(a=1);for(var g in k){var h=parseInt(g,10);h>=e&&(f[h+a]=k[h],k[h-a]||delete f[h])}this._forceClearCache=!0;if(c)for(;a--;)Object.keys(c[a]).length&&(this.styles[b]||(this.styles[b]={}),this.styles[b][e+a]=d(c[a]));else if(f)for(c=f[e?e-1:1];c&&a--;)this.styles[b][e+a]=d(c)},insertNewStyleBlock:function(b,e,a){e=this.get2DCursorLocation(e,!0);for(var c=[0],d=0,k=0;k<b.length;k++)"\n"===b[k]?(d++,c[d]=0):c[d]++;0<c[0]&&(this.insertCharStyleObject(e.lineIndex,e.charIndex,c[0],a),a=a&&a.slice(c[0]+1));d&&this.insertNewlineStyleObject(e.lineIndex,e.charIndex+c[0],d);for(k=1;k<d;k++)0<c[k]?this.insertCharStyleObject(e.lineIndex+k,0,c[k],a):a&&(this.styles[e.lineIndex+k][0]=a[0]),a=a&&a.slice(c[k]+1);0<c[k]&&this.insertCharStyleObject(e.lineIndex+k,0,c[k],a)},setSelectionStartEndWithShift:function(b,e,a){a<=b?(e===b?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=b),this.selectionStart=a):a>b&&a<e?"right"===this._selectionDirection?this.selectionEnd=a:this.selectionStart=a:(e===b?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=a)},setSelectionInBoundaries:function(){var b=this.text.length;this.selectionStart>b?this.selectionStart=b:0>this.selectionStart&&(this.selectionStart=0);this.selectionEnd>b?this.selectionEnd=b:0>this.selectionEnd&&(this.selectionEnd=0)}})})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(d){if(this.canvas){this.__newClickTime=+new Date;var b=this.canvas.getPointer(d.e);this.isTripleClick(b)&&(this.fire("tripleclick",d),this._stopEvent(d.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=b;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected}},isTripleClick:function(d){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&d.preventDefault();d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("mousedblclick",function(d){this.selectWord(this.getSelectionStartFromPointer(d.e))});this.on("tripleclick",function(d){this.selectLine(this.getSelectionStartFromPointer(d.e))})},_mouseDownHandler:function(d){if(this.canvas&&this.editable&&(!d.e.button||1===d.e.button)){var b=this.canvas.getPointer(d.e);this.__mousedownX=b.x;this.__mousedownY=b.y;this.__isMousedown=!0;this.selected&&this.setCursorByClick(d.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler)},_isObjectMoved:function(d){d=this.canvas.getPointer(d);return this.__mousedownX!==d.x||this.__mousedownY!==d.y},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(d){this.__isMousedown=!1;!this.editable||this._isObjectMoved(d.e)||d.e.button&&1!==d.e.button||(this.__lastSelected&&!this.__corner&&(this.enterEditing(d.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)},setCursorByClick:function(d){var b=this.getSelectionStartFromPointer(d),e=this.selectionStart,a=this.selectionEnd;d.shiftKey?this.setSelectionStartEndWithShift(e,a,b):this.selectionEnd=this.selectionStart=b;this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(d){d=this.getLocalPointer(d);for(var b=0,e,a=e=0,c=0,f=0,k=this._textLines.length;f<k;f++)if(e<=d.y)e+=this.getHeightOfLine(f)*this.scaleY,c=f,0<f&&(a+=this._textLines[f-1].length+1);else break;e=this._getLineLeftOffset(c)*this.scaleX;f=0;for(k=this._textLines[c].length;f<k;f++)if(b=e,e+=this.__charBounds[c][f].kernedWidth*this.scaleX,e<=d.x)a++;else break;return this._getNewSelectionStartFromOffset(d,b,e,a,k)},_getNewSelectionStartFromOffset:function(d,b,e,a,c){e-=d.x;d=a+(e>d.x-b||0>e?0:1);this.flipX&&(d=c-d);d>this._text.length&&(d=this._text.length);return d}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.setAttribute("autocorrect","off");this.hiddenTextarea.setAttribute("autocomplete","off");this.hiddenTextarea.setAttribute("spellcheck","false");this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea","");this.hiddenTextarea.setAttribute("wrap","off");var d=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+d.top+"; left: "+d.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; line-height: 1px; padding\uff70top: "+d.fontSize+";";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(this.isEditing&&!this.inCompositionMode){if(d.keyCode in this.keysMap)this[this.keysMap[d.keyCode]](d);else if(d.keyCode in this.ctrlKeysMapDown&&(d.ctrlKey||d.metaKey))this[this.ctrlKeysMapDown[d.keyCode]](d);else return;d.stopImmediatePropagation();d.preventDefault();33<=d.keyCode&&40>=d.keyCode?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(d){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:d.keyCode in this.ctrlKeysMapUp&&(d.ctrlKey||d.metaKey)&&(this[this.ctrlKeysMapUp[d.keyCode]](d),d.stopImmediatePropagation(),d.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(d){var b=this.fromPaste;this.fromPaste=!1;d&&d.stopPropagation();if(this.isEditing){var e=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,a=this._text.length,c=e.length,f,k=c-a;if(""===this.hiddenTextarea.value)this.styles={};else{var g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);d=this.selectionStart>g.selectionStart;this.selectionStart!==this.selectionEnd?(f=this._text.slice(this.selectionStart,this.selectionEnd),k+=this.selectionEnd-this.selectionStart):c<a&&(f=d?this._text.slice(this.selectionEnd+k,this.selectionEnd):this._text.slice(this.selectionStart,this.selectionStart-k));e=e.slice(g.selectionEnd-k,g.selectionEnd);f&&f.length&&(this.selectionStart!==this.selectionEnd?this.removeStyleFromTo(this.selectionStart,this.selectionEnd):d?this.removeStyleFromTo(this.selectionEnd-f.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+f.length));e.length&&(b&&e.join("")===fabric.copiedText?this.insertNewStyleBlock(e,this.selectionStart,fabric.copiedTextStyle):this.insertNewStyleBlock(e,this.selectionStart))}this.updateFromTextArea();this.fire("changed");this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(d){this.compositionStart=d.target.selectionStart;this.compositionEnd=d.target.selectionEnd;this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(fabric.copiedText=this.getSelectedText(),fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(d){return d&&d.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(d,b){var e=this._getLineLeftOffset(d),a;0<b&&(a=this.__charBounds[d][b-1],e+=a.left+a.width);return e},getDownCursorOffset:function(d,b){var e=this._getSelectionForOffset(d,b),a=this.get2DCursorLocation(e),c=a.lineIndex;if(c===this._textLines.length-1||d.metaKey||34===d.keyCode)return this._text.length-e;e=a.charIndex;a=this._getWidthBeforeCursor(c,e);a=this._getIndexOnLine(c+1,a);return this._textLines[c].slice(e).length+a+2},_getSelectionForOffset:function(d,b){return d.shiftKey&&this.selectionStart!==this.selectionEnd&&b?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(d,b){var e=this._getSelectionForOffset(d,b),a=this.get2DCursorLocation(e),c=a.lineIndex;if(0===c||d.metaKey||33===d.keyCode)return-e;e=a.charIndex;a=this._getWidthBeforeCursor(c,e);a=this._getIndexOnLine(c-1,a);e=this._textLines[c].slice(0,e);return-this._textLines[c-1].length+a-e.length},_getIndexOnLine:function(d,b){for(var e=this._textLines[d],a=this._getLineLeftOffset(d),c=0,f,k,g=0,h=e.length;g<h;g++)if(f=this.__charBounds[d][g].width,a+=f,a>b){k=!0;c=Math.abs(a-b)<Math.abs(a-f-b)?g:g-1;break}k||(c=e.length-1);return c},moveCursorDown:function(d){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",d)},moveCursorUp:function(d){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",d)},_moveCursorUpOrDown:function(d,b){var e=this["get"+d+"CursorOffset"](b,"right"===this._selectionDirection);b.shiftKey?this.moveCursorWithShift(e):this.moveCursorWithoutShift(e);0!==e&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(d){this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+d:this.selectionEnd+d);return 0!==d},moveCursorWithoutShift:function(d){0>d?this.selectionEnd=this.selectionStart+=d:this.selectionStart=this.selectionEnd+=d;return 0!==d},moveCursorLeft:function(d){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",d)},_move:function(d,b,e){if(d.altKey)d=this["findWordBoundary"+e](this[b]);else if(d.metaKey||35===d.keyCode||36===d.keyCode)d=this["findLineBoundary"+e](this[b]);else return this[b]+="Left"===e?-1:1,!0;if(this[b]!==d)return this[b]=d,!0},_moveLeft:function(d,b){return this._move(d,b,"Left")},_moveRight:function(d,b){return this._move(d,b,"Right")},moveCursorLeftWithoutShift:function(d){var b=!0;this._selectionDirection="left";this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(b=this._moveLeft(d,"selectionStart"));this.selectionEnd=this.selectionStart;return b},moveCursorLeftWithShift:function(d){if("right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd)return this._moveLeft(d,"selectionEnd");if(0!==this.selectionStart)return this._selectionDirection="left",this._moveLeft(d,"selectionStart")},moveCursorRight:function(d){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",d)},_moveCursorLeftOrRight:function(d,b){var e="moveCursor"+d+"With";this._currentCursorOpacity=1;e=b.shiftKey?e+"Shift":e+"outShift";this[e](b)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(d){if("left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd)return this._moveRight(d,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(d,"selectionEnd")},moveCursorRightWithoutShift:function(d){var b=!0;this._selectionDirection="right";this.selectionStart===this.selectionEnd?(b=this._moveRight(d,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd;return b},removeChars:function(d,b){"undefined"===typeof b&&(b=d+1);this.removeStyleFromTo(d,b);this._text.splice(d,b-d);this.text=this._text.join("");this.set("dirty",!0);this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());this._removeExtraneousStyles()},insertChars:function(d,b,e,a){"undefined"===typeof a&&(a=e);a>e&&this.removeStyleFromTo(e,a);d=fabric.util.string.graphemeSplit(d);this.insertNewStyleBlock(d,e,b);this._text=[].concat(this._text.slice(0,e),d,this._text.slice(a));this.text=this._text.join("");this.set("dirty",!0);this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());this._removeExtraneousStyles()}});(function(){var d=fabric.util.toFixed,b=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{toSVG:function(b){var a=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(),c=this._getSVGTextAndBg(c.textTop,c.textLeft);this._wrapSVGTextAndBg(a,c);return b?b(a.join("")):a.join("")},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(b,a){var c=this.getSvgFilter(),c=""===c?"":' style\x3d"'+c+'"',e=this.getSvgTextDecoration(this);b.push("\t\x3cg ",this.getSvgId(),'transform\x3d"',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',c,"\x3e\n",a.textBgRects.join(""),'\t\t\x3ctext xml:space\x3d"preserve" ',this.fontFamily?'font-family\x3d"'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size\x3d"'+this.fontSize+'" ':"",this.fontStyle?'font-style\x3d"'+this.fontStyle+'" ':"",this.fontWeight?'font-weight\x3d"'+this.fontWeight+'" ':"",e?'text-decoration\x3d"'+e+'" ':"",'style\x3d"',this.getSvgStyles(!0),'"',this.addPaintOrder()," \x3e",a.textSpans.join(""),"\x3c/text\x3e\n","\t\x3c/g\x3e\n")},_getSVGTextAndBg:function(b,a){var c=[],e=[],d=b,g;this._setSVGBg(e);for(var h=0,l=this._textLines.length;h<l;h++)g=this._getLineLeftOffset(h),(this.textBackgroundColor||this.styleHas("textBackgroundColor",h))&&this._setSVGTextLineBg(e,h,a+g,d),this._setSVGTextLineText(c,h,a+g,d),d+=this.getHeightOfLine(h);return{textSpans:c,textBgRects:e}},_createTextCharSpan:function(e,a,c,f){var k=e!==e.trim()||e.match(b),k=(k=this.getSvgSpanStyles(a,k))?'style\x3d"'+k+'"':"";a=a.deltaY;var g="",h=fabric.Object.NUM_FRACTION_DIGITS;a&&(g=' dy\x3d"'+d(a,h)+'" ');return['\x3ctspan x\x3d"',d(c,h),'" y\x3d"',d(f,h),'" ',g,k,"\x3e",fabric.util.string.escapeXml(e),"\x3c/tspan\x3e"].join("")},_setSVGTextLineText:function(b,a,c,d){var e=this.getHeightOfLine(a),f=-1!==this.textAlign.indexOf("justify"),h,l,m="",n,p=0,q=this._textLines[a],r;d+=e*(1-this._fontSizeFraction)/this.lineHeight;for(var e=0,t=q.length-1;e<=t;e++)r=e===t||this.charSpacing,m+=q[e],n=this.__charBounds[a][e],0===p?(c+=n.kernedWidth-n.width,p+=n.width):p+=n.kernedWidth,f&&!r&&this._reSpaceAndTab.test(q[e])&&(r=!0),r||(h=h||this.getCompleteStyleDeclaration(a,e),l=this.getCompleteStyleDeclaration(a,e+1),r=this._hasStyleChangedForSvg(h,l)),r&&(h=this._getStyleDeclaration(a,e)||{},b.push(this._createTextCharSpan(m,h,c,d)),m="",h=l,c+=p,p=0)},_pushTextBgRect:function(b,a,c,f,k,g){var e=fabric.Object.NUM_FRACTION_DIGITS;b.push("\t\t\x3crect ",this._getFillAttributes(a),' x\x3d"',d(c,e),'" y\x3d"',d(f,e),'" width\x3d"',d(k,e),'" height\x3d"',d(g,e),'"\x3e\x3c/rect\x3e\n')},_setSVGTextLineBg:function(b,a,c,d){for(var e=this._textLines[a],f=this.getHeightOfLine(a)/this.lineHeight,h=0,l=0,m,n=this.getValueOfPropertyAt(a,0,"textBackgroundColor"),p=0,q=e.length;p<q;p++)e=this.__charBounds[a][p],m=this.getValueOfPropertyAt(a,p,"textBackgroundColor"),m!==n?(n&&this._pushTextBgRect(b,n,c+l,d,h,f),l=e.left,h=e.width,n=m):h+=e.kernedWidth;m&&this._pushTextBgRect(b,m,c+l,d,h,f)},_getFillAttributes:function(b){var a=b&&"string"===typeof b?new fabric.Color(b):"";return a&&a.getSource()&&1!==a.getAlpha()?'opacity\x3d"'+a.getAlpha()+'" fill\x3d"'+a.setAlpha(1).toRgb()+'"':'fill\x3d"'+b+'"'},_getSVGLineTopOffset:function(b){for(var a=0,c=0;c<b;c++)a+=this.getHeightOfLine(c);b=this.getHeightOfLine(c);return{lineTop:a,offset:(this._fontSizeMult-this._fontSizeFraction)*b/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(b){return fabric.Object.prototype.getSvgStyles.call(this,b)+" white-space: pre;"}})})();(function(d){var b=d.fabric||(d.fabric={});b.Textbox=b.util.createClass(b.IText,b.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:b.Text.prototype._dimensionAffectingProps.concat("width"),initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(b){for(var a=0,c=0,e=0,d={},g=0;g<b.graphemeLines.length;g++)"\n"===b.graphemeText[e]&&0<g?(c=0,e++,a++):this._reSpaceAndTab.test(b.graphemeText[e])&&0<g&&(c++,e++),d[g]={line:a,offset:c},e+=b.graphemeLines[g].length,c+=b.graphemeLines[g].length;return d},styleHas:function(e,a){if(this._styleMap&&!this.isWrapping){var c=this._styleMap[a];c&&(a=c.line)}return b.Text.prototype.styleHas.call(this,e,a)},isEmptyStyles:function(b){var a=0,c,d=!1,e=this._styleMap[b],g=this._styleMap[b+1];e&&(b=e.line,a=e.offset);g&&(c=g.line,d=c===b,c=g.offset);b="undefined"===typeof b?this.styles:{line:this.styles[b]};for(var h in b)for(var l in b[h])if(l>=a&&(!d||l<c))for(var m in b[h][l])return!1;return!0},_getStyleDeclaration:function(b,a){if(this._styleMap&&!this.isWrapping){var c=this._styleMap[b];if(!c)return null;b=c.line;a=c.offset+a}return this.callSuper("_getStyleDeclaration",b,a)},_setStyleDeclaration:function(b,a,c){var d=this._styleMap[b];b=d.line;a=d.offset+a;this.styles[b][a]=c},_deleteStyleDeclaration:function(b,a){var c=this._styleMap[b];b=c.line;a=c.offset+a;delete this.styles[b][a]},_getLineStyle:function(b){return this.styles[this._styleMap[b].line]},_setLineStyle:function(b,a){this.styles[this._styleMap[b].line]=a},_deleteLineStyle:function(b){delete this.styles[this._styleMap[b].line]},_wrapText:function(b,a){var c=[],d;this.isWrapping=!0;for(d=0;d<b.length;d++)c=c.concat(this._wrapLine(b[d],d,a));this.isWrapping=!1;return c},_measureWord:function(b,a,c){var d=0,e;c=c||0;for(var g=0,h=b.length;g<h;g++)e=this._getGraphemeBox(b[g],a,g+c,e,!0),d+=e.kernedWidth,e=b[g];return d},_wrapLine:function(d,a,c,f){var e=0,g=[],h=[];d=d.split(this._reSpaceAndTab);var l,m=0,n,p=0,q=0,r=!0,t=this._getWidthOfCharSpacing();f=f||0;c-=f;for(var u=0;u<d.length;u++)l=b.util.string.graphemeSplit(d[u]),n=this._measureWord(l,a,m),m+=l.length,e+=p+n-t,e>=c&&!r?(g.push(h),h=[],e=n,r=!0):e+=t,r||h.push(" "),h=h.concat(l),p=this._measureWord([" "],a,m),m++,r=!1,n>q&&(q=n);u&&g.push(h);q+f>this.dynamicMinWidth&&(this.dynamicMinWidth=q-t+f);return g},isEndOfWrapping:function(b){return this._styleMap[b+1]&&this._styleMap[b+1].line===this._styleMap[b].line?!1:!0},_splitTextIntoLines:function(d){d=b.Text.prototype._splitTextIntoLines.call(this,d);for(var a=this._wrapText(d.lines,this.width),c=Array(a.length),e=0;e<a.length;e++)c[e]=a[e].join("");d.lines=c;d.graphemeLines=a;return d},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(b){return this.callSuper("toObject",["minWidth"].concat(b))}});b.Textbox.fromObject=function(d,a){return b.Object._fromObject("Textbox",d,a,"text")}})("undefined"!==typeof exports?exports:this);(function(){var d=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(b,e,a,c,f,k,g){var h=e.target;if("x"===f&&h instanceof fabric.Textbox){if(e=h._getTransformedDimensions().x,b=b.x/e*h.width,b>=h.getMinWidth())return h.set("width",b),!0}else return d.call(fabric.Canvas.prototype,b,e,a,c,f,k,g)};fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var b in this._styleMap)this._textLines[b]||delete this.styles[this._styleMap[b].line]}})})();